"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SigaaAccountUFPB = void 0;

require("source-map-support/register");

var _sigaaTypes = require("../sigaa-types");

var _url = require("url");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Responsible for representing the user account.
 * @category Internal
 */
class SigaaAccountUFPB {
  /**
   * @param homepage homepage (page after login) of user.
   */
  constructor(homepage, http, parser, session, bondFactory) {
    this.http = http;
    this.parser = parser;
    this.session = session;
    this.bondFactory = bondFactory;

    _defineProperty(this, "errorInvalidCredentials", 'SIGAA: Invalid credentials.');

    _defineProperty(this, "errorInsufficientPasswordComplexity", 'SIGAA: Insufficent password complexity.');

    _defineProperty(this, "activeBonds", []);

    _defineProperty(this, "inactiveBonds", []);

    _defineProperty(this, "pagehomeParsePromise", void 0);

    _defineProperty(this, "_name", void 0);

    _defineProperty(this, "_emails", void 0);

    this.parseHomepage(homepage);
  }
  /**
   * Error message when the new password chosen does not meet the security requirements of SIGAA.
   * It is thrown by the changePassword() method
   */


  /**
   * Parse login result page to fill the instance.
   *
   * @param homepage home page to parse.
   */
  parseHomepage(homepage) {
    //Since the login page can vary, we should check the type of page.
    if (homepage.bodyDecoded.includes('O sistema comportou-se de forma inesperada')) {
      throw new Error('SIGAA: Invalid homepage, the system behaved unexpectedly.');
    }

    if (homepage.url.href.includes('/portais/discente/beta/discente.jsf')) {
      //If it is home page student of desktop version.
      this.pagehomeParsePromise = this.parseStudentHomePage(homepage);
    } else if (homepage.url.href.includes('/sigaa/vinculos.jsf') || homepage.url.href.includes('/sigaa/escolhaVinculo.do')) {
      //If it is bond page.
      this.pagehomeParsePromise = this.parseBondPage(homepage);
    } else {
      throw new Error('SIGAA: Unknown homepage format.');
    }
  }
  /**
   * Parse bond page.
   * @param page page to parse.
   */


  async parseBondPage(page) {
    const rows = page.$('table.subFormulario tbody tr').toArray();

    for (const row of rows) {
      const cells = page.$(row).find('td').toArray();
      if (cells.length === 0) continue;
      const bondType = this.parser.removeTagsHtml(page.$(row).find('#tdTipo').html());
      const status = this.parser.removeTagsHtml(page.$(cells[3]).html());
      let bond;

      switch (bondType) {
        case 'Discente':
          {
            const registration = this.parser.removeTagsHtml(page.$(cells[2]).html());
            const url = page.$(row).find('a[href]').attr('href');
            if (!url) throw new Error('SIGAA: Bond switch url could not be found.');
            const bondSwitchUrl = new _url.URL(url, page.url);
            const program = this.parser.removeTagsHtml(page.$(cells[4]).html()).replace(/^Curso: /g, '');
            bond = this.bondFactory.createStudentBond(registration, program, bondSwitchUrl);
            break;
          }

        case 'Docente':
          {
            bond = this.bondFactory.createTeacherBond();
            break;
          }
      }

      if (bond) if (status === 'Sim') {
        this.activeBonds.push(bond);
      } else if (status === 'NÃ£o') {
        this.inactiveBonds.push(bond);
      } else {
        console.log('SIGAA: WARNING invalid status: ' + status);
      }
    }
  }
  /**
   * @inheritdoc
   */


  async getActiveBonds() {
    await this.pagehomeParsePromise;
    return this.activeBonds;
  }
  /**
   * @inheritdoc
   */


  async getInactiveBonds() {
    await this.pagehomeParsePromise;
    return this.inactiveBonds;
  }
  /**
   * Parse desktop version of student home page page.
   */


  async parseStudentHomePage(homepage) {
    const registration = this.parser.removeTagsHtml(homepage.$('.detalhes-usuario-matricula').html());
    const program = this.parser.removeTagsHtml(homepage.$('.painel-usuario-identificacao div').eq(1).html());
    if (!registration) throw new Error('SIGAA: Student bond without registration code.');
    if (!program) throw new Error('SIGAA: Student bond program not found.');
    this.activeBonds.push(this.bondFactory.createStudentBond(registration, program, null));
  }
  /**
   * @inheritdoc
   */


  logoff() {
    return this.http.get('/sigaa/logoff/').then(page => {
      return this.http.followAllRedirect(page);
    }).then(page => {
      if (page.statusCode !== 200) {
        throw new Error('SIGAA: Invalid status code in logoff page.');
      }

      this.session.loginStatus = _sigaaTypes.LoginStatus.Unauthenticated;
      this.http.closeSession();
    });
  }
  /**
   * Get profile picture URL.
   * @retuns Picture url or null if the user has no photo.
   */


  async getProfilePictureURL() {
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');
    const pictureElement = page.$('#fotoUsuario .foto');
    if (pictureElement.length === 0) return null;
    const pictureStyle = pictureElement.attr('style');
    if (!pictureStyle) return null;
    const pictureUrl = (pictureStyle.match(/https?:[^")]+/) || [])[0];
    if (!pictureUrl) return null;
    return new _url.URL(pictureUrl, page.url);
  }
  /**
   * Download profile url and save in basepath.
   * @param destpath It can be a folder or a file name, if it is a directory then it will be saved inside the folder, if it is a file name it will be saved exactly in this place, but if the folder does not exist it will throw an error.
   * @param callback To know the progress of the download, each downloaded part will be called informing how much has already been downloaded.
   * @retuns Full path of the downloaded file, useful if the destpath is a directory, or null if the user has no photo.
   */


  async downloadProfilePicture(destpath, callback) {
    const pictureURL = await this.getProfilePictureURL();
    if (!pictureURL) return null;
    return this.http.downloadFileByGet(pictureURL.href, destpath, callback);
  }
  /**
   * @inheritdoc
   */


  async getName() {
    if (this._name) return this._name;
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');

    if (page.statusCode === 200) {
      const username = this.parser.removeTagsHtml(page.$('.detalhes-usuario-nome').html());
      this._name = username;
      return username;
    } else {
      throw new Error('SIGAA: Unexpected status code at student profile page.');
    }
  }
  /**
   * @inheritdoc
   */


  async getEmails() {
    if (this._emails) return this._emails;
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');

    if (page.statusCode === 200) {
      this._emails = [];
      const rows = page.$('.detalhes-usuario table').eq(0).find('tr').toArray();

      for (const row of rows) {
        const cells = page.$(row).find('td');

        if (this.parser.removeTagsHtml(cells.eq(0).html()) === 'E-mail:') {
          const email = this.parser.removeTagsHtml(cells.eq(1).html());
          if (email) this._emails.push(email);
          break;
        }
      }

      return this._emails;
    } else {
      throw new Error('SIGAA: Unexpected status code at student profile page.');
    }
  }
  /**
   * Change the password of account.
   * @param oldPassword current password.
   * @param newPassword new password.
   * @throws {errorInvalidCredentials} If current password is not correct.
   * @throws {errorInsufficientPasswordComplexity} If the new password does not have the complexity requirement.
   */


  async changePassword(oldPassword, newPassword) {
    const formPage = await this.http.get('/sigaa/alterar_dados.jsf');
    if (formPage.statusCode !== 302) throw new Error('SIGAA: Unexpected status code at change password form.');
    const prePage = await this.http.followAllRedirect(formPage);
    if (prePage.statusCode !== 200 || !prePage.url.href.includes('usuario/alterar_dados.jsf')) throw new Error('SIGAA: Invalid pre page at change password.');
    const preFormElement = prePage.$('form[name="form"]');
    const preAction = preFormElement.attr('action');
    if (!preAction) throw new Error('SIGAA: Form without action at change password pre page.');
    const preActionUrl = new _url.URL(preAction, prePage.url.href);
    const prePostValues = {};
    const preInputs = preFormElement.find("input[name]:not([type='submit'])").toArray();

    for (const input of preInputs) {
      const name = prePage.$(input).attr('name');

      if (name) {
        prePostValues[name] = prePage.$(input).val();
      }
    }

    prePostValues['form:alterarSenha'] = 'form:alterarSenha';
    const page = await this.http.post(preActionUrl.href, prePostValues);
    const formElement = page.$('form[name="form"]');
    const action = formElement.attr('action');
    if (!action) throw new Error('SIGAA: Form without action at change password page.');
    const formAction = new _url.URL(action, page.url.href);
    const postValues = {};
    const inputs = formElement.find("input[name]:not([type='submit'])").toArray();

    for (const input of inputs) {
      const name = page.$(input).attr('name');

      if (name) {
        postValues[name] = prePage.$(input).val();
      }
    }

    postValues['form:senhaAtual'] = oldPassword;
    postValues['form:novaSenha'] = newPassword;
    postValues['form:repetnNovaSenha'] = newPassword;
    postValues['form:alterarDados'] = 'Alterar Dados';
    const resultPage = await this.http.post(formAction.href, postValues);

    if (resultPage.statusCode === 200) {
      const errorMsg = this.parser.removeTagsHtml(resultPage.$('.erros li').html());

      if (errorMsg.includes('A senha digitada Ã© muito simples.')) {
        throw new Error(this.errorInsufficientPasswordComplexity);
      }

      if (errorMsg.includes('Senha Atual digitada nÃ£o confere')) {
        throw new Error(this.errorInvalidCredentials);
      }
    }

    if (resultPage.statusCode !== 302) {
      throw new Error('SIGAA: The change password page status code is different than expected.');
    }
  }

}

exports.SigaaAccountUFPB = SigaaAccountUFPB;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY2NvdW50L3NpZ2FhLWFjY291bnQtdWZwYi50cyJdLCJuYW1lcyI6WyJTaWdhYUFjY291bnRVRlBCIiwiY29uc3RydWN0b3IiLCJob21lcGFnZSIsImh0dHAiLCJwYXJzZXIiLCJzZXNzaW9uIiwiYm9uZEZhY3RvcnkiLCJwYXJzZUhvbWVwYWdlIiwiYm9keURlY29kZWQiLCJpbmNsdWRlcyIsIkVycm9yIiwidXJsIiwiaHJlZiIsInBhZ2Vob21lUGFyc2VQcm9taXNlIiwicGFyc2VTdHVkZW50SG9tZVBhZ2UiLCJwYXJzZUJvbmRQYWdlIiwicGFnZSIsInJvd3MiLCIkIiwidG9BcnJheSIsInJvdyIsImNlbGxzIiwiZmluZCIsImxlbmd0aCIsImJvbmRUeXBlIiwicmVtb3ZlVGFnc0h0bWwiLCJodG1sIiwic3RhdHVzIiwiYm9uZCIsInJlZ2lzdHJhdGlvbiIsImF0dHIiLCJib25kU3dpdGNoVXJsIiwiVVJMIiwicHJvZ3JhbSIsInJlcGxhY2UiLCJjcmVhdGVTdHVkZW50Qm9uZCIsImNyZWF0ZVRlYWNoZXJCb25kIiwiYWN0aXZlQm9uZHMiLCJwdXNoIiwiaW5hY3RpdmVCb25kcyIsImNvbnNvbGUiLCJsb2ciLCJnZXRBY3RpdmVCb25kcyIsImdldEluYWN0aXZlQm9uZHMiLCJlcSIsImxvZ29mZiIsImdldCIsInRoZW4iLCJmb2xsb3dBbGxSZWRpcmVjdCIsInN0YXR1c0NvZGUiLCJsb2dpblN0YXR1cyIsIkxvZ2luU3RhdHVzIiwiVW5hdXRoZW50aWNhdGVkIiwiY2xvc2VTZXNzaW9uIiwiZ2V0UHJvZmlsZVBpY3R1cmVVUkwiLCJwaWN0dXJlRWxlbWVudCIsInBpY3R1cmVTdHlsZSIsInBpY3R1cmVVcmwiLCJtYXRjaCIsImRvd25sb2FkUHJvZmlsZVBpY3R1cmUiLCJkZXN0cGF0aCIsImNhbGxiYWNrIiwicGljdHVyZVVSTCIsImRvd25sb2FkRmlsZUJ5R2V0IiwiZ2V0TmFtZSIsIl9uYW1lIiwidXNlcm5hbWUiLCJnZXRFbWFpbHMiLCJfZW1haWxzIiwiZW1haWwiLCJjaGFuZ2VQYXNzd29yZCIsIm9sZFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJmb3JtUGFnZSIsInByZVBhZ2UiLCJwcmVGb3JtRWxlbWVudCIsInByZUFjdGlvbiIsInByZUFjdGlvblVybCIsInByZVBvc3RWYWx1ZXMiLCJwcmVJbnB1dHMiLCJpbnB1dCIsIm5hbWUiLCJ2YWwiLCJwb3N0IiwiZm9ybUVsZW1lbnQiLCJhY3Rpb24iLCJmb3JtQWN0aW9uIiwicG9zdFZhbHVlcyIsImlucHV0cyIsInJlc3VsdFBhZ2UiLCJlcnJvck1zZyIsImVycm9ySW5zdWZmaWNpZW50UGFzc3dvcmRDb21wbGV4aXR5IiwiZXJyb3JJbnZhbGlkQ3JlZGVudGlhbHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUdBOztBQUlBOzs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQSxnQkFBTixDQUEwQztBQUMvQztBQUNGO0FBQ0E7QUFDRUMsRUFBQUEsV0FBVyxDQUNUQyxRQURTLEVBRURDLElBRkMsRUFHREMsTUFIQyxFQUlEQyxPQUpDLEVBS0RDLFdBTEMsRUFNVDtBQUFBLFNBSlFILElBSVIsR0FKUUEsSUFJUjtBQUFBLFNBSFFDLE1BR1IsR0FIUUEsTUFHUjtBQUFBLFNBRlFDLE9BRVIsR0FGUUEsT0FFUjtBQUFBLFNBRFFDLFdBQ1IsR0FEUUEsV0FDUjs7QUFBQSxxREFRaUMsNkJBUmpDOztBQUFBLGlFQWVBLHlDQWZBOztBQUFBLHlDQW9CZ0MsRUFwQmhDOztBQUFBLDJDQXlCa0MsRUF6QmxDOztBQUFBOztBQUFBOztBQUFBOztBQUNBLFNBQUtDLGFBQUwsQ0FBbUJMLFFBQW5CO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTs7O0FBbUNFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDVUssRUFBQUEsYUFBYSxDQUFDTCxRQUFELEVBQXVCO0FBQzFDO0FBQ0EsUUFDRUEsUUFBUSxDQUFDTSxXQUFULENBQXFCQyxRQUFyQixDQUNFLDRDQURGLENBREYsRUFJRTtBQUNBLFlBQU0sSUFBSUMsS0FBSixDQUNKLDJEQURJLENBQU47QUFHRDs7QUFDRCxRQUFJUixRQUFRLENBQUNTLEdBQVQsQ0FBYUMsSUFBYixDQUFrQkgsUUFBbEIsQ0FBMkIscUNBQTNCLENBQUosRUFBdUU7QUFDckU7QUFDQSxXQUFLSSxvQkFBTCxHQUE0QixLQUFLQyxvQkFBTCxDQUEwQlosUUFBMUIsQ0FBNUI7QUFDRCxLQUhELE1BR08sSUFDTEEsUUFBUSxDQUFDUyxHQUFULENBQWFDLElBQWIsQ0FBa0JILFFBQWxCLENBQTJCLHFCQUEzQixLQUNBUCxRQUFRLENBQUNTLEdBQVQsQ0FBYUMsSUFBYixDQUFrQkgsUUFBbEIsQ0FBMkIsMEJBQTNCLENBRkssRUFHTDtBQUNBO0FBQ0EsV0FBS0ksb0JBQUwsR0FBNEIsS0FBS0UsYUFBTCxDQUFtQmIsUUFBbkIsQ0FBNUI7QUFDRCxLQU5NLE1BTUE7QUFDTCxZQUFNLElBQUlRLEtBQUosQ0FBVSxpQ0FBVixDQUFOO0FBQ0Q7QUFDRjtBQUVEO0FBQ0Y7QUFDQTtBQUNBOzs7QUFDNkIsUUFBYkssYUFBYSxDQUFDQyxJQUFELEVBQWE7QUFDdEMsVUFBTUMsSUFBSSxHQUFHRCxJQUFJLENBQUNFLENBQUwsQ0FBTyw4QkFBUCxFQUF1Q0MsT0FBdkMsRUFBYjs7QUFDQSxTQUFLLE1BQU1DLEdBQVgsSUFBa0JILElBQWxCLEVBQXdCO0FBQ3RCLFlBQU1JLEtBQUssR0FBR0wsSUFBSSxDQUFDRSxDQUFMLENBQU9FLEdBQVAsRUFBWUUsSUFBWixDQUFpQixJQUFqQixFQUF1QkgsT0FBdkIsRUFBZDtBQUNBLFVBQUlFLEtBQUssQ0FBQ0UsTUFBTixLQUFpQixDQUFyQixFQUF3QjtBQUV4QixZQUFNQyxRQUFRLEdBQUcsS0FBS3BCLE1BQUwsQ0FBWXFCLGNBQVosQ0FDZlQsSUFBSSxDQUFDRSxDQUFMLENBQU9FLEdBQVAsRUFBWUUsSUFBWixDQUFpQixTQUFqQixFQUE0QkksSUFBNUIsRUFEZSxDQUFqQjtBQUdBLFlBQU1DLE1BQU0sR0FBRyxLQUFLdkIsTUFBTCxDQUFZcUIsY0FBWixDQUEyQlQsSUFBSSxDQUFDRSxDQUFMLENBQU9HLEtBQUssQ0FBQyxDQUFELENBQVosRUFBaUJLLElBQWpCLEVBQTNCLENBQWY7QUFDQSxVQUFJRSxJQUFKOztBQUNBLGNBQVFKLFFBQVI7QUFDRSxhQUFLLFVBQUw7QUFBaUI7QUFDZixrQkFBTUssWUFBWSxHQUFHLEtBQUt6QixNQUFMLENBQVlxQixjQUFaLENBQ25CVCxJQUFJLENBQUNFLENBQUwsQ0FBT0csS0FBSyxDQUFDLENBQUQsQ0FBWixFQUFpQkssSUFBakIsRUFEbUIsQ0FBckI7QUFJQSxrQkFBTWYsR0FBRyxHQUFHSyxJQUFJLENBQUNFLENBQUwsQ0FBT0UsR0FBUCxFQUFZRSxJQUFaLENBQWlCLFNBQWpCLEVBQTRCUSxJQUE1QixDQUFpQyxNQUFqQyxDQUFaO0FBQ0EsZ0JBQUksQ0FBQ25CLEdBQUwsRUFDRSxNQUFNLElBQUlELEtBQUosQ0FBVSw0Q0FBVixDQUFOO0FBQ0Ysa0JBQU1xQixhQUFhLEdBQUcsSUFBSUMsUUFBSixDQUFRckIsR0FBUixFQUFhSyxJQUFJLENBQUNMLEdBQWxCLENBQXRCO0FBRUEsa0JBQU1zQixPQUFPLEdBQUcsS0FBSzdCLE1BQUwsQ0FDYnFCLGNBRGEsQ0FDRVQsSUFBSSxDQUFDRSxDQUFMLENBQU9HLEtBQUssQ0FBQyxDQUFELENBQVosRUFBaUJLLElBQWpCLEVBREYsRUFFYlEsT0FGYSxDQUVMLFdBRkssRUFFUSxFQUZSLENBQWhCO0FBR0FOLFlBQUFBLElBQUksR0FBRyxLQUFLdEIsV0FBTCxDQUFpQjZCLGlCQUFqQixDQUNMTixZQURLLEVBRUxJLE9BRkssRUFHTEYsYUFISyxDQUFQO0FBS0E7QUFDRDs7QUFDRCxhQUFLLFNBQUw7QUFBZ0I7QUFDZEgsWUFBQUEsSUFBSSxHQUFHLEtBQUt0QixXQUFMLENBQWlCOEIsaUJBQWpCLEVBQVA7QUFDQTtBQUNEO0FBeEJIOztBQTBCQSxVQUFJUixJQUFKLEVBQ0UsSUFBSUQsTUFBTSxLQUFLLEtBQWYsRUFBc0I7QUFDcEIsYUFBS1UsV0FBTCxDQUFpQkMsSUFBakIsQ0FBc0JWLElBQXRCO0FBQ0QsT0FGRCxNQUVPLElBQUlELE1BQU0sS0FBSyxLQUFmLEVBQXNCO0FBQzNCLGFBQUtZLGFBQUwsQ0FBbUJELElBQW5CLENBQXdCVixJQUF4QjtBQUNELE9BRk0sTUFFQTtBQUNMWSxRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvQ0FBb0NkLE1BQWhEO0FBQ0Q7QUFDSjtBQUNGO0FBRUQ7QUFDRjtBQUNBOzs7QUFDc0IsUUFBZGUsY0FBYyxHQUF3QjtBQUMxQyxVQUFNLEtBQUs3QixvQkFBWDtBQUNBLFdBQU8sS0FBS3dCLFdBQVo7QUFDRDtBQUVEO0FBQ0Y7QUFDQTs7O0FBQ3dCLFFBQWhCTSxnQkFBZ0IsR0FBd0I7QUFDNUMsVUFBTSxLQUFLOUIsb0JBQVg7QUFDQSxXQUFPLEtBQUswQixhQUFaO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7OztBQUNvQyxRQUFwQnpCLG9CQUFvQixDQUFDWixRQUFELEVBQWlCO0FBQ2pELFVBQU0yQixZQUFZLEdBQUcsS0FBS3pCLE1BQUwsQ0FBWXFCLGNBQVosQ0FDbkJ2QixRQUFRLENBQUNnQixDQUFULENBQVcsNkJBQVgsRUFBMENRLElBQTFDLEVBRG1CLENBQXJCO0FBR0EsVUFBTU8sT0FBTyxHQUFHLEtBQUs3QixNQUFMLENBQVlxQixjQUFaLENBQ2R2QixRQUFRLENBQUNnQixDQUFULENBQVcsbUNBQVgsRUFBZ0QwQixFQUFoRCxDQUFtRCxDQUFuRCxFQUFzRGxCLElBQXRELEVBRGMsQ0FBaEI7QUFJQSxRQUFJLENBQUNHLFlBQUwsRUFDRSxNQUFNLElBQUluQixLQUFKLENBQVUsZ0RBQVYsQ0FBTjtBQUVGLFFBQUksQ0FBQ3VCLE9BQUwsRUFBYyxNQUFNLElBQUl2QixLQUFKLENBQVUsd0NBQVYsQ0FBTjtBQUVkLFNBQUsyQixXQUFMLENBQWlCQyxJQUFqQixDQUNFLEtBQUtoQyxXQUFMLENBQWlCNkIsaUJBQWpCLENBQW1DTixZQUFuQyxFQUFpREksT0FBakQsRUFBMEQsSUFBMUQsQ0FERjtBQUdEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDRVksRUFBQUEsTUFBTSxHQUFrQjtBQUN0QixXQUFPLEtBQUsxQyxJQUFMLENBQ0oyQyxHQURJLENBQ0EsZ0JBREEsRUFFSkMsSUFGSSxDQUVFL0IsSUFBRCxJQUFVO0FBQ2QsYUFBTyxLQUFLYixJQUFMLENBQVU2QyxpQkFBVixDQUE0QmhDLElBQTVCLENBQVA7QUFDRCxLQUpJLEVBS0orQixJQUxJLENBS0UvQixJQUFELElBQVU7QUFDZCxVQUFJQSxJQUFJLENBQUNpQyxVQUFMLEtBQW9CLEdBQXhCLEVBQTZCO0FBQzNCLGNBQU0sSUFBSXZDLEtBQUosQ0FBVSw0Q0FBVixDQUFOO0FBQ0Q7O0FBQ0QsV0FBS0wsT0FBTCxDQUFhNkMsV0FBYixHQUEyQkMsd0JBQVlDLGVBQXZDO0FBQ0EsV0FBS2pELElBQUwsQ0FBVWtELFlBQVY7QUFDRCxLQVhJLENBQVA7QUFZRDtBQUVEO0FBQ0Y7QUFDQTtBQUNBOzs7QUFDNEIsUUFBcEJDLG9CQUFvQixHQUF3QjtBQUNoRCxVQUFNdEMsSUFBSSxHQUFHLE1BQU0sS0FBS2IsSUFBTCxDQUFVMkMsR0FBVixDQUNqQiwyQ0FEaUIsQ0FBbkI7QUFJQSxVQUFNUyxjQUFjLEdBQUd2QyxJQUFJLENBQUNFLENBQUwsQ0FBTyxvQkFBUCxDQUF2QjtBQUNBLFFBQUlxQyxjQUFjLENBQUNoQyxNQUFmLEtBQTBCLENBQTlCLEVBQWlDLE9BQU8sSUFBUDtBQUNqQyxVQUFNaUMsWUFBWSxHQUFHRCxjQUFjLENBQUN6QixJQUFmLENBQW9CLE9BQXBCLENBQXJCO0FBQ0EsUUFBSSxDQUFDMEIsWUFBTCxFQUFtQixPQUFPLElBQVA7QUFDbkIsVUFBTUMsVUFBVSxHQUFHLENBQUNELFlBQVksQ0FBQ0UsS0FBYixDQUFtQixlQUFuQixLQUF1QyxFQUF4QyxFQUE0QyxDQUE1QyxDQUFuQjtBQUNBLFFBQUksQ0FBQ0QsVUFBTCxFQUFpQixPQUFPLElBQVA7QUFDakIsV0FBTyxJQUFJekIsUUFBSixDQUFReUIsVUFBUixFQUFvQnpDLElBQUksQ0FBQ0wsR0FBekIsQ0FBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDOEIsUUFBdEJnRCxzQkFBc0IsQ0FDMUJDLFFBRDBCLEVBRTFCQyxRQUYwQixFQUdGO0FBQ3hCLFVBQU1DLFVBQVUsR0FBRyxNQUFNLEtBQUtSLG9CQUFMLEVBQXpCO0FBQ0EsUUFBSSxDQUFDUSxVQUFMLEVBQWlCLE9BQU8sSUFBUDtBQUNqQixXQUFPLEtBQUszRCxJQUFMLENBQVU0RCxpQkFBVixDQUE0QkQsVUFBVSxDQUFDbEQsSUFBdkMsRUFBNkNnRCxRQUE3QyxFQUF1REMsUUFBdkQsQ0FBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDZSxRQUFQRyxPQUFPLEdBQW9CO0FBQy9CLFFBQUksS0FBS0MsS0FBVCxFQUFnQixPQUFPLEtBQUtBLEtBQVo7QUFDaEIsVUFBTWpELElBQUksR0FBRyxNQUFNLEtBQUtiLElBQUwsQ0FBVTJDLEdBQVYsQ0FDakIsMkNBRGlCLENBQW5COztBQUdBLFFBQUk5QixJQUFJLENBQUNpQyxVQUFMLEtBQW9CLEdBQXhCLEVBQTZCO0FBQzNCLFlBQU1pQixRQUFRLEdBQUcsS0FBSzlELE1BQUwsQ0FBWXFCLGNBQVosQ0FDZlQsSUFBSSxDQUFDRSxDQUFMLENBQU8sd0JBQVAsRUFBaUNRLElBQWpDLEVBRGUsQ0FBakI7QUFHQSxXQUFLdUMsS0FBTCxHQUFhQyxRQUFiO0FBQ0EsYUFBT0EsUUFBUDtBQUNELEtBTkQsTUFNTztBQUNMLFlBQU0sSUFBSXhELEtBQUosQ0FBVSx3REFBVixDQUFOO0FBQ0Q7QUFDRjtBQUVEO0FBQ0Y7QUFDQTs7O0FBQ2lCLFFBQVR5RCxTQUFTLEdBQXNCO0FBQ25DLFFBQUksS0FBS0MsT0FBVCxFQUFrQixPQUFPLEtBQUtBLE9BQVo7QUFDbEIsVUFBTXBELElBQUksR0FBRyxNQUFNLEtBQUtiLElBQUwsQ0FBVTJDLEdBQVYsQ0FDakIsMkNBRGlCLENBQW5COztBQUdBLFFBQUk5QixJQUFJLENBQUNpQyxVQUFMLEtBQW9CLEdBQXhCLEVBQTZCO0FBQzNCLFdBQUttQixPQUFMLEdBQWUsRUFBZjtBQUNBLFlBQU1uRCxJQUFJLEdBQUdELElBQUksQ0FBQ0UsQ0FBTCxDQUFPLHlCQUFQLEVBQWtDMEIsRUFBbEMsQ0FBcUMsQ0FBckMsRUFBd0N0QixJQUF4QyxDQUE2QyxJQUE3QyxFQUFtREgsT0FBbkQsRUFBYjs7QUFDQSxXQUFLLE1BQU1DLEdBQVgsSUFBa0JILElBQWxCLEVBQXdCO0FBQ3RCLGNBQU1JLEtBQUssR0FBR0wsSUFBSSxDQUFDRSxDQUFMLENBQU9FLEdBQVAsRUFBWUUsSUFBWixDQUFpQixJQUFqQixDQUFkOztBQUNBLFlBQUksS0FBS2xCLE1BQUwsQ0FBWXFCLGNBQVosQ0FBMkJKLEtBQUssQ0FBQ3VCLEVBQU4sQ0FBUyxDQUFULEVBQVlsQixJQUFaLEVBQTNCLE1BQW1ELFNBQXZELEVBQWtFO0FBQ2hFLGdCQUFNMkMsS0FBSyxHQUFHLEtBQUtqRSxNQUFMLENBQVlxQixjQUFaLENBQTJCSixLQUFLLENBQUN1QixFQUFOLENBQVMsQ0FBVCxFQUFZbEIsSUFBWixFQUEzQixDQUFkO0FBQ0EsY0FBSTJDLEtBQUosRUFBVyxLQUFLRCxPQUFMLENBQWE5QixJQUFiLENBQWtCK0IsS0FBbEI7QUFDWDtBQUNEO0FBQ0Y7O0FBQ0QsYUFBTyxLQUFLRCxPQUFaO0FBQ0QsS0FaRCxNQVlPO0FBQ0wsWUFBTSxJQUFJMUQsS0FBSixDQUFVLHdEQUFWLENBQU47QUFDRDtBQUNGO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNzQixRQUFkNEQsY0FBYyxDQUNsQkMsV0FEa0IsRUFFbEJDLFdBRmtCLEVBR0g7QUFDZixVQUFNQyxRQUFRLEdBQUcsTUFBTSxLQUFLdEUsSUFBTCxDQUFVMkMsR0FBVixDQUFjLDBCQUFkLENBQXZCO0FBQ0EsUUFBSTJCLFFBQVEsQ0FBQ3hCLFVBQVQsS0FBd0IsR0FBNUIsRUFDRSxNQUFNLElBQUl2QyxLQUFKLENBQVUsd0RBQVYsQ0FBTjtBQUVGLFVBQU1nRSxPQUFPLEdBQUcsTUFBTSxLQUFLdkUsSUFBTCxDQUFVNkMsaUJBQVYsQ0FBNEJ5QixRQUE1QixDQUF0QjtBQUNBLFFBQ0VDLE9BQU8sQ0FBQ3pCLFVBQVIsS0FBdUIsR0FBdkIsSUFDQSxDQUFDeUIsT0FBTyxDQUFDL0QsR0FBUixDQUFZQyxJQUFaLENBQWlCSCxRQUFqQixDQUEwQiwyQkFBMUIsQ0FGSCxFQUlFLE1BQU0sSUFBSUMsS0FBSixDQUFVLDZDQUFWLENBQU47QUFFRixVQUFNaUUsY0FBYyxHQUFHRCxPQUFPLENBQUN4RCxDQUFSLENBQVUsbUJBQVYsQ0FBdkI7QUFFQSxVQUFNMEQsU0FBUyxHQUFHRCxjQUFjLENBQUM3QyxJQUFmLENBQW9CLFFBQXBCLENBQWxCO0FBQ0EsUUFBSSxDQUFDOEMsU0FBTCxFQUNFLE1BQU0sSUFBSWxFLEtBQUosQ0FDSix5REFESSxDQUFOO0FBSUYsVUFBTW1FLFlBQVksR0FBRyxJQUFJN0MsUUFBSixDQUFRNEMsU0FBUixFQUFtQkYsT0FBTyxDQUFDL0QsR0FBUixDQUFZQyxJQUEvQixDQUFyQjtBQUVBLFVBQU1rRSxhQUFxQyxHQUFHLEVBQTlDO0FBRUEsVUFBTUMsU0FBUyxHQUFHSixjQUFjLENBQzdCckQsSUFEZSxDQUNWLGtDQURVLEVBRWZILE9BRmUsRUFBbEI7O0FBR0EsU0FBSyxNQUFNNkQsS0FBWCxJQUFvQkQsU0FBcEIsRUFBK0I7QUFDN0IsWUFBTUUsSUFBSSxHQUFHUCxPQUFPLENBQUN4RCxDQUFSLENBQVU4RCxLQUFWLEVBQWlCbEQsSUFBakIsQ0FBc0IsTUFBdEIsQ0FBYjs7QUFDQSxVQUFJbUQsSUFBSixFQUFVO0FBQ1JILFFBQUFBLGFBQWEsQ0FBQ0csSUFBRCxDQUFiLEdBQXNCUCxPQUFPLENBQUN4RCxDQUFSLENBQVU4RCxLQUFWLEVBQWlCRSxHQUFqQixFQUF0QjtBQUNEO0FBQ0Y7O0FBQ0RKLElBQUFBLGFBQWEsQ0FBQyxtQkFBRCxDQUFiLEdBQXFDLG1CQUFyQztBQUNBLFVBQU05RCxJQUFJLEdBQUcsTUFBTSxLQUFLYixJQUFMLENBQVVnRixJQUFWLENBQWVOLFlBQVksQ0FBQ2pFLElBQTVCLEVBQWtDa0UsYUFBbEMsQ0FBbkI7QUFDQSxVQUFNTSxXQUFXLEdBQUdwRSxJQUFJLENBQUNFLENBQUwsQ0FBTyxtQkFBUCxDQUFwQjtBQUVBLFVBQU1tRSxNQUFNLEdBQUdELFdBQVcsQ0FBQ3RELElBQVosQ0FBaUIsUUFBakIsQ0FBZjtBQUNBLFFBQUksQ0FBQ3VELE1BQUwsRUFDRSxNQUFNLElBQUkzRSxLQUFKLENBQVUscURBQVYsQ0FBTjtBQUNGLFVBQU00RSxVQUFVLEdBQUcsSUFBSXRELFFBQUosQ0FBUXFELE1BQVIsRUFBZ0JyRSxJQUFJLENBQUNMLEdBQUwsQ0FBU0MsSUFBekIsQ0FBbkI7QUFFQSxVQUFNMkUsVUFBa0MsR0FBRyxFQUEzQztBQUNBLFVBQU1DLE1BQU0sR0FBR0osV0FBVyxDQUN2QjlELElBRFksQ0FDUCxrQ0FETyxFQUVaSCxPQUZZLEVBQWY7O0FBR0EsU0FBSyxNQUFNNkQsS0FBWCxJQUFvQlEsTUFBcEIsRUFBNEI7QUFDMUIsWUFBTVAsSUFBSSxHQUFHakUsSUFBSSxDQUFDRSxDQUFMLENBQU84RCxLQUFQLEVBQWNsRCxJQUFkLENBQW1CLE1BQW5CLENBQWI7O0FBQ0EsVUFBSW1ELElBQUosRUFBVTtBQUNSTSxRQUFBQSxVQUFVLENBQUNOLElBQUQsQ0FBVixHQUFtQlAsT0FBTyxDQUFDeEQsQ0FBUixDQUFVOEQsS0FBVixFQUFpQkUsR0FBakIsRUFBbkI7QUFDRDtBQUNGOztBQUVESyxJQUFBQSxVQUFVLENBQUMsaUJBQUQsQ0FBVixHQUFnQ2hCLFdBQWhDO0FBQ0FnQixJQUFBQSxVQUFVLENBQUMsZ0JBQUQsQ0FBVixHQUErQmYsV0FBL0I7QUFDQWUsSUFBQUEsVUFBVSxDQUFDLHNCQUFELENBQVYsR0FBcUNmLFdBQXJDO0FBQ0FlLElBQUFBLFVBQVUsQ0FBQyxtQkFBRCxDQUFWLEdBQWtDLGVBQWxDO0FBRUEsVUFBTUUsVUFBVSxHQUFHLE1BQU0sS0FBS3RGLElBQUwsQ0FBVWdGLElBQVYsQ0FBZUcsVUFBVSxDQUFDMUUsSUFBMUIsRUFBZ0MyRSxVQUFoQyxDQUF6Qjs7QUFFQSxRQUFJRSxVQUFVLENBQUN4QyxVQUFYLEtBQTBCLEdBQTlCLEVBQW1DO0FBQ2pDLFlBQU15QyxRQUFRLEdBQUcsS0FBS3RGLE1BQUwsQ0FBWXFCLGNBQVosQ0FDZmdFLFVBQVUsQ0FBQ3ZFLENBQVgsQ0FBYSxXQUFiLEVBQTBCUSxJQUExQixFQURlLENBQWpCOztBQUdBLFVBQUlnRSxRQUFRLENBQUNqRixRQUFULENBQWtCLG1DQUFsQixDQUFKLEVBQTREO0FBQzFELGNBQU0sSUFBSUMsS0FBSixDQUFVLEtBQUtpRixtQ0FBZixDQUFOO0FBQ0Q7O0FBQ0QsVUFBSUQsUUFBUSxDQUFDakYsUUFBVCxDQUFrQixrQ0FBbEIsQ0FBSixFQUEyRDtBQUN6RCxjQUFNLElBQUlDLEtBQUosQ0FBVSxLQUFLa0YsdUJBQWYsQ0FBTjtBQUNEO0FBQ0Y7O0FBRUQsUUFBSUgsVUFBVSxDQUFDeEMsVUFBWCxLQUEwQixHQUE5QixFQUFtQztBQUNqQyxZQUFNLElBQUl2QyxLQUFKLENBQ0oseUVBREksQ0FBTjtBQUdEO0FBQ0Y7O0FBalc4QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhcnNlciB9IGZyb20gJ0BoZWxwZXJzL3NpZ2FhLXBhcnNlcic7XG5pbXBvcnQgeyBIVFRQLCBQcm9ncmVzc0NhbGxiYWNrIH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtaHR0cCc7XG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtc2Vzc2lvbic7XG5pbXBvcnQgeyBMb2dpblN0YXR1cyB9IGZyb20gJy4uL3NpZ2FhLXR5cGVzJztcbmltcG9ydCB7IEJvbmRGYWN0b3J5LCBCb25kVHlwZSB9IGZyb20gJ0Bib25kcy9zaWdhYS1ib25kLWZhY3RvcnknO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ0BzZXNzaW9uL3NpZ2FhLXBhZ2UnO1xuaW1wb3J0IHsgQWNjb3VudCB9IGZyb20gJy4vc2lnYWEtYWNjb3VudCc7XG5pbXBvcnQgeyBVUkwgfSBmcm9tICd1cmwnO1xuXG4vKipcbiAqIFJlc3BvbnNpYmxlIGZvciByZXByZXNlbnRpbmcgdGhlIHVzZXIgYWNjb3VudC5cbiAqIEBjYXRlZ29yeSBJbnRlcm5hbFxuICovXG5leHBvcnQgY2xhc3MgU2lnYWFBY2NvdW50VUZQQiBpbXBsZW1lbnRzIEFjY291bnQge1xuICAvKipcbiAgICogQHBhcmFtIGhvbWVwYWdlIGhvbWVwYWdlIChwYWdlIGFmdGVyIGxvZ2luKSBvZiB1c2VyLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgaG9tZXBhZ2U6IFBhZ2UsXG4gICAgcHJpdmF0ZSBodHRwOiBIVFRQLFxuICAgIHByaXZhdGUgcGFyc2VyOiBQYXJzZXIsXG4gICAgcHJpdmF0ZSBzZXNzaW9uOiBTZXNzaW9uLFxuICAgIHByaXZhdGUgYm9uZEZhY3Rvcnk6IEJvbmRGYWN0b3J5XG4gICkge1xuICAgIHRoaXMucGFyc2VIb21lcGFnZShob21lcGFnZSk7XG4gIH1cblxuICAvKipcbiAgICogRXJyb3IgbWVzc2FnZSB3aGVuIHRoZSBuZXcgcGFzc3dvcmQgY2hvc2VuIGRvZXMgbm90IG1lZXQgdGhlIHNlY3VyaXR5IHJlcXVpcmVtZW50cyBvZiBTSUdBQS5cbiAgICogSXQgaXMgdGhyb3duIGJ5IHRoZSBjaGFuZ2VQYXNzd29yZCgpIG1ldGhvZFxuICAgKi9cbiAgcmVhZG9ubHkgZXJyb3JJbnZhbGlkQ3JlZGVudGlhbHMgPSAnU0lHQUE6IEludmFsaWQgY3JlZGVudGlhbHMuJztcblxuICAvKipcbiAgICogRXJyb3IgbWVzc2FnZSB3aGVuIHRoZSBvbGQgcGFzc3dvcmQgaXMgbm90IHRoZSBjdXJyZW50IHBhc3N3b3JkLlxuICAgKiBJdCBpcyB0aHJvd24gYnkgdGhlIGNoYW5nZVBhc3N3b3JkKCkgbWV0aG9kLlxuICAgKi9cbiAgcmVhZG9ubHkgZXJyb3JJbnN1ZmZpY2llbnRQYXNzd29yZENvbXBsZXhpdHkgPVxuICAgICdTSUdBQTogSW5zdWZmaWNlbnQgcGFzc3dvcmQgY29tcGxleGl0eS4nO1xuXG4gIC8qKlxuICAgKiBBcnJheSBvZiBhY3RpdmUgYm9uZHMuXG4gICAqL1xuICBwcml2YXRlIGFjdGl2ZUJvbmRzOiBCb25kVHlwZVtdID0gW107XG5cbiAgLyoqXG4gICAqIEFycmF5IG9mIGluYWN0aXZlIGJvbmRzLlxuICAgKi9cbiAgcHJpdmF0ZSBpbmFjdGl2ZUJvbmRzOiBCb25kVHlwZVtdID0gW107XG5cbiAgLyoqXG4gICAqIEl0IGlzIGEgcHJvbWlzZSB0aGF0IHN0b3JlcyBpZiB0aGUgcGFnZSBwYXJzZXIgaGFzIGFscmVhZHkgY29tcGxldGVkXG4gICAqL1xuICBwcml2YXRlIHBhZ2Vob21lUGFyc2VQcm9taXNlPzogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogU3R1ZGVudCBuYW1lIGNhY2hlXG4gICAqL1xuICBwcml2YXRlIF9uYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTdHVkZW50IGUtbWFpbCBjYWNoZVxuICAgKi9cbiAgcHJpdmF0ZSBfZW1haWxzPzogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIFBhcnNlIGxvZ2luIHJlc3VsdCBwYWdlIHRvIGZpbGwgdGhlIGluc3RhbmNlLlxuICAgKlxuICAgKiBAcGFyYW0gaG9tZXBhZ2UgaG9tZSBwYWdlIHRvIHBhcnNlLlxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUhvbWVwYWdlKGhvbWVwYWdlOiBQYWdlKTogdm9pZCB7XG4gICAgLy9TaW5jZSB0aGUgbG9naW4gcGFnZSBjYW4gdmFyeSwgd2Ugc2hvdWxkIGNoZWNrIHRoZSB0eXBlIG9mIHBhZ2UuXG4gICAgaWYgKFxuICAgICAgaG9tZXBhZ2UuYm9keURlY29kZWQuaW5jbHVkZXMoXG4gICAgICAgICdPIHNpc3RlbWEgY29tcG9ydG91LXNlIGRlIGZvcm1hIGluZXNwZXJhZGEnXG4gICAgICApXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdTSUdBQTogSW52YWxpZCBob21lcGFnZSwgdGhlIHN5c3RlbSBiZWhhdmVkIHVuZXhwZWN0ZWRseS4nXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoaG9tZXBhZ2UudXJsLmhyZWYuaW5jbHVkZXMoJy9wb3J0YWlzL2Rpc2NlbnRlL2JldGEvZGlzY2VudGUuanNmJykpIHtcbiAgICAgIC8vSWYgaXQgaXMgaG9tZSBwYWdlIHN0dWRlbnQgb2YgZGVza3RvcCB2ZXJzaW9uLlxuICAgICAgdGhpcy5wYWdlaG9tZVBhcnNlUHJvbWlzZSA9IHRoaXMucGFyc2VTdHVkZW50SG9tZVBhZ2UoaG9tZXBhZ2UpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBob21lcGFnZS51cmwuaHJlZi5pbmNsdWRlcygnL3NpZ2FhL3ZpbmN1bG9zLmpzZicpIHx8XG4gICAgICBob21lcGFnZS51cmwuaHJlZi5pbmNsdWRlcygnL3NpZ2FhL2VzY29saGFWaW5jdWxvLmRvJylcbiAgICApIHtcbiAgICAgIC8vSWYgaXQgaXMgYm9uZCBwYWdlLlxuICAgICAgdGhpcy5wYWdlaG9tZVBhcnNlUHJvbWlzZSA9IHRoaXMucGFyc2VCb25kUGFnZShob21lcGFnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFVua25vd24gaG9tZXBhZ2UgZm9ybWF0LicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSBib25kIHBhZ2UuXG4gICAqIEBwYXJhbSBwYWdlIHBhZ2UgdG8gcGFyc2UuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHBhcnNlQm9uZFBhZ2UocGFnZTogUGFnZSkge1xuICAgIGNvbnN0IHJvd3MgPSBwYWdlLiQoJ3RhYmxlLnN1YkZvcm11bGFyaW8gdGJvZHkgdHInKS50b0FycmF5KCk7XG4gICAgZm9yIChjb25zdCByb3cgb2Ygcm93cykge1xuICAgICAgY29uc3QgY2VsbHMgPSBwYWdlLiQocm93KS5maW5kKCd0ZCcpLnRvQXJyYXkoKTtcbiAgICAgIGlmIChjZWxscy5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuXG4gICAgICBjb25zdCBib25kVHlwZSA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgICBwYWdlLiQocm93KS5maW5kKCcjdGRUaXBvJykuaHRtbCgpXG4gICAgICApO1xuICAgICAgY29uc3Qgc3RhdHVzID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwocGFnZS4kKGNlbGxzWzNdKS5odG1sKCkpO1xuICAgICAgbGV0IGJvbmQ7XG4gICAgICBzd2l0Y2ggKGJvbmRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ0Rpc2NlbnRlJzoge1xuICAgICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgICAgICAgcGFnZS4kKGNlbGxzWzJdKS5odG1sKClcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgY29uc3QgdXJsID0gcGFnZS4kKHJvdykuZmluZCgnYVtocmVmXScpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICBpZiAoIXVybClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IEJvbmQgc3dpdGNoIHVybCBjb3VsZCBub3QgYmUgZm91bmQuJyk7XG4gICAgICAgICAgY29uc3QgYm9uZFN3aXRjaFVybCA9IG5ldyBVUkwodXJsLCBwYWdlLnVybCk7XG5cbiAgICAgICAgICBjb25zdCBwcm9ncmFtID0gdGhpcy5wYXJzZXJcbiAgICAgICAgICAgIC5yZW1vdmVUYWdzSHRtbChwYWdlLiQoY2VsbHNbNF0pLmh0bWwoKSlcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eQ3Vyc286IC9nLCAnJyk7XG4gICAgICAgICAgYm9uZCA9IHRoaXMuYm9uZEZhY3RvcnkuY3JlYXRlU3R1ZGVudEJvbmQoXG4gICAgICAgICAgICByZWdpc3RyYXRpb24sXG4gICAgICAgICAgICBwcm9ncmFtLFxuICAgICAgICAgICAgYm9uZFN3aXRjaFVybFxuICAgICAgICAgICk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnRG9jZW50ZSc6IHtcbiAgICAgICAgICBib25kID0gdGhpcy5ib25kRmFjdG9yeS5jcmVhdGVUZWFjaGVyQm9uZCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYm9uZClcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ1NpbScpIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUJvbmRzLnB1c2goYm9uZCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSAnTsOjbycpIHtcbiAgICAgICAgICB0aGlzLmluYWN0aXZlQm9uZHMucHVzaChib25kKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnU0lHQUE6IFdBUk5JTkcgaW52YWxpZCBzdGF0dXM6ICcgKyBzdGF0dXMpO1xuICAgICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBhc3luYyBnZXRBY3RpdmVCb25kcygpOiBQcm9taXNlPEJvbmRUeXBlW10+IHtcbiAgICBhd2FpdCB0aGlzLnBhZ2Vob21lUGFyc2VQcm9taXNlO1xuICAgIHJldHVybiB0aGlzLmFjdGl2ZUJvbmRzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBhc3luYyBnZXRJbmFjdGl2ZUJvbmRzKCk6IFByb21pc2U8Qm9uZFR5cGVbXT4ge1xuICAgIGF3YWl0IHRoaXMucGFnZWhvbWVQYXJzZVByb21pc2U7XG4gICAgcmV0dXJuIHRoaXMuaW5hY3RpdmVCb25kcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSBkZXNrdG9wIHZlcnNpb24gb2Ygc3R1ZGVudCBob21lIHBhZ2UgcGFnZS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcGFyc2VTdHVkZW50SG9tZVBhZ2UoaG9tZXBhZ2U6IFBhZ2UpIHtcbiAgICBjb25zdCByZWdpc3RyYXRpb24gPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChcbiAgICAgIGhvbWVwYWdlLiQoJy5kZXRhbGhlcy11c3VhcmlvLW1hdHJpY3VsYScpLmh0bWwoKVxuICAgICk7XG4gICAgY29uc3QgcHJvZ3JhbSA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgaG9tZXBhZ2UuJCgnLnBhaW5lbC11c3VhcmlvLWlkZW50aWZpY2FjYW8gZGl2JykuZXEoMSkuaHRtbCgpXG4gICAgKTtcblxuICAgIGlmICghcmVnaXN0cmF0aW9uKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogU3R1ZGVudCBib25kIHdpdGhvdXQgcmVnaXN0cmF0aW9uIGNvZGUuJyk7XG5cbiAgICBpZiAoIXByb2dyYW0pIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFN0dWRlbnQgYm9uZCBwcm9ncmFtIG5vdCBmb3VuZC4nKTtcblxuICAgIHRoaXMuYWN0aXZlQm9uZHMucHVzaChcbiAgICAgIHRoaXMuYm9uZEZhY3RvcnkuY3JlYXRlU3R1ZGVudEJvbmQocmVnaXN0cmF0aW9uLCBwcm9ncmFtLCBudWxsKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIGxvZ29mZigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAuZ2V0KCcvc2lnYWEvbG9nb2ZmLycpXG4gICAgICAudGhlbigocGFnZSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmZvbGxvd0FsbFJlZGlyZWN0KHBhZ2UpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKChwYWdlKSA9PiB7XG4gICAgICAgIGlmIChwYWdlLnN0YXR1c0NvZGUgIT09IDIwMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IEludmFsaWQgc3RhdHVzIGNvZGUgaW4gbG9nb2ZmIHBhZ2UuJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXNzaW9uLmxvZ2luU3RhdHVzID0gTG9naW5TdGF0dXMuVW5hdXRoZW50aWNhdGVkO1xuICAgICAgICB0aGlzLmh0dHAuY2xvc2VTZXNzaW9uKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcHJvZmlsZSBwaWN0dXJlIFVSTC5cbiAgICogQHJldHVucyBQaWN0dXJlIHVybCBvciBudWxsIGlmIHRoZSB1c2VyIGhhcyBubyBwaG90by5cbiAgICovXG4gIGFzeW5jIGdldFByb2ZpbGVQaWN0dXJlVVJMKCk6IFByb21pc2U8VVJMIHwgbnVsbD4ge1xuICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCB0aGlzLmh0dHAuZ2V0KFxuICAgICAgJy9zaWdhYS9wb3J0YWlzL2Rpc2NlbnRlL2JldGEvZGlzY2VudGUuanNmJ1xuICAgICk7XG5cbiAgICBjb25zdCBwaWN0dXJlRWxlbWVudCA9IHBhZ2UuJCgnI2ZvdG9Vc3VhcmlvIC5mb3RvJyk7XG4gICAgaWYgKHBpY3R1cmVFbGVtZW50Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgcGljdHVyZVN0eWxlID0gcGljdHVyZUVsZW1lbnQuYXR0cignc3R5bGUnKTtcbiAgICBpZiAoIXBpY3R1cmVTdHlsZSkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgcGljdHVyZVVybCA9IChwaWN0dXJlU3R5bGUubWF0Y2goL2h0dHBzPzpbXlwiKV0rLykgfHwgW10pWzBdO1xuICAgIGlmICghcGljdHVyZVVybCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIG5ldyBVUkwocGljdHVyZVVybCwgcGFnZS51cmwpO1xuICB9XG5cbiAgLyoqXG4gICAqIERvd25sb2FkIHByb2ZpbGUgdXJsIGFuZCBzYXZlIGluIGJhc2VwYXRoLlxuICAgKiBAcGFyYW0gZGVzdHBhdGggSXQgY2FuIGJlIGEgZm9sZGVyIG9yIGEgZmlsZSBuYW1lLCBpZiBpdCBpcyBhIGRpcmVjdG9yeSB0aGVuIGl0IHdpbGwgYmUgc2F2ZWQgaW5zaWRlIHRoZSBmb2xkZXIsIGlmIGl0IGlzIGEgZmlsZSBuYW1lIGl0IHdpbGwgYmUgc2F2ZWQgZXhhY3RseSBpbiB0aGlzIHBsYWNlLCBidXQgaWYgdGhlIGZvbGRlciBkb2VzIG5vdCBleGlzdCBpdCB3aWxsIHRocm93IGFuIGVycm9yLlxuICAgKiBAcGFyYW0gY2FsbGJhY2sgVG8ga25vdyB0aGUgcHJvZ3Jlc3Mgb2YgdGhlIGRvd25sb2FkLCBlYWNoIGRvd25sb2FkZWQgcGFydCB3aWxsIGJlIGNhbGxlZCBpbmZvcm1pbmcgaG93IG11Y2ggaGFzIGFscmVhZHkgYmVlbiBkb3dubG9hZGVkLlxuICAgKiBAcmV0dW5zIEZ1bGwgcGF0aCBvZiB0aGUgZG93bmxvYWRlZCBmaWxlLCB1c2VmdWwgaWYgdGhlIGRlc3RwYXRoIGlzIGEgZGlyZWN0b3J5LCBvciBudWxsIGlmIHRoZSB1c2VyIGhhcyBubyBwaG90by5cbiAgICovXG4gIGFzeW5jIGRvd25sb2FkUHJvZmlsZVBpY3R1cmUoXG4gICAgZGVzdHBhdGg6IHN0cmluZyxcbiAgICBjYWxsYmFjaz86IFByb2dyZXNzQ2FsbGJhY2tcbiAgKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgY29uc3QgcGljdHVyZVVSTCA9IGF3YWl0IHRoaXMuZ2V0UHJvZmlsZVBpY3R1cmVVUkwoKTtcbiAgICBpZiAoIXBpY3R1cmVVUkwpIHJldHVybiBudWxsO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZG93bmxvYWRGaWxlQnlHZXQocGljdHVyZVVSTC5ocmVmLCBkZXN0cGF0aCwgY2FsbGJhY2spO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBhc3luYyBnZXROYW1lKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKHRoaXMuX25hbWUpIHJldHVybiB0aGlzLl9uYW1lO1xuICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCB0aGlzLmh0dHAuZ2V0KFxuICAgICAgJy9zaWdhYS9wb3J0YWlzL2Rpc2NlbnRlL2JldGEvZGlzY2VudGUuanNmJ1xuICAgICk7XG4gICAgaWYgKHBhZ2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICBjb25zdCB1c2VybmFtZSA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgICBwYWdlLiQoJy5kZXRhbGhlcy11c3VhcmlvLW5vbWUnKS5odG1sKClcbiAgICAgICk7XG4gICAgICB0aGlzLl9uYW1lID0gdXNlcm5hbWU7XG4gICAgICByZXR1cm4gdXNlcm5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFVuZXhwZWN0ZWQgc3RhdHVzIGNvZGUgYXQgc3R1ZGVudCBwcm9maWxlIHBhZ2UuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBhc3luYyBnZXRFbWFpbHMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGlmICh0aGlzLl9lbWFpbHMpIHJldHVybiB0aGlzLl9lbWFpbHM7XG4gICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5nZXQoXG4gICAgICAnL3NpZ2FhL3BvcnRhaXMvZGlzY2VudGUvYmV0YS9kaXNjZW50ZS5qc2YnXG4gICAgKTtcbiAgICBpZiAocGFnZS5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgIHRoaXMuX2VtYWlscyA9IFtdO1xuICAgICAgY29uc3Qgcm93cyA9IHBhZ2UuJCgnLmRldGFsaGVzLXVzdWFyaW8gdGFibGUnKS5lcSgwKS5maW5kKCd0cicpLnRvQXJyYXkoKTtcbiAgICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICAgICAgY29uc3QgY2VsbHMgPSBwYWdlLiQocm93KS5maW5kKCd0ZCcpO1xuICAgICAgICBpZiAodGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoY2VsbHMuZXEoMCkuaHRtbCgpKSA9PT0gJ0UtbWFpbDonKSB7XG4gICAgICAgICAgY29uc3QgZW1haWwgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChjZWxscy5lcSgxKS5odG1sKCkpO1xuICAgICAgICAgIGlmIChlbWFpbCkgdGhpcy5fZW1haWxzLnB1c2goZW1haWwpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5fZW1haWxzO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBVbmV4cGVjdGVkIHN0YXR1cyBjb2RlIGF0IHN0dWRlbnQgcHJvZmlsZSBwYWdlLicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGhlIHBhc3N3b3JkIG9mIGFjY291bnQuXG4gICAqIEBwYXJhbSBvbGRQYXNzd29yZCBjdXJyZW50IHBhc3N3b3JkLlxuICAgKiBAcGFyYW0gbmV3UGFzc3dvcmQgbmV3IHBhc3N3b3JkLlxuICAgKiBAdGhyb3dzIHtlcnJvckludmFsaWRDcmVkZW50aWFsc30gSWYgY3VycmVudCBwYXNzd29yZCBpcyBub3QgY29ycmVjdC5cbiAgICogQHRocm93cyB7ZXJyb3JJbnN1ZmZpY2llbnRQYXNzd29yZENvbXBsZXhpdHl9IElmIHRoZSBuZXcgcGFzc3dvcmQgZG9lcyBub3QgaGF2ZSB0aGUgY29tcGxleGl0eSByZXF1aXJlbWVudC5cbiAgICovXG4gIGFzeW5jIGNoYW5nZVBhc3N3b3JkKFxuICAgIG9sZFBhc3N3b3JkOiBzdHJpbmcsXG4gICAgbmV3UGFzc3dvcmQ6IHN0cmluZ1xuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBmb3JtUGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5nZXQoJy9zaWdhYS9hbHRlcmFyX2RhZG9zLmpzZicpO1xuICAgIGlmIChmb3JtUGFnZS5zdGF0dXNDb2RlICE9PSAzMDIpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBVbmV4cGVjdGVkIHN0YXR1cyBjb2RlIGF0IGNoYW5nZSBwYXNzd29yZCBmb3JtLicpO1xuXG4gICAgY29uc3QgcHJlUGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5mb2xsb3dBbGxSZWRpcmVjdChmb3JtUGFnZSk7XG4gICAgaWYgKFxuICAgICAgcHJlUGFnZS5zdGF0dXNDb2RlICE9PSAyMDAgfHxcbiAgICAgICFwcmVQYWdlLnVybC5ocmVmLmluY2x1ZGVzKCd1c3VhcmlvL2FsdGVyYXJfZGFkb3MuanNmJylcbiAgICApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBJbnZhbGlkIHByZSBwYWdlIGF0IGNoYW5nZSBwYXNzd29yZC4nKTtcblxuICAgIGNvbnN0IHByZUZvcm1FbGVtZW50ID0gcHJlUGFnZS4kKCdmb3JtW25hbWU9XCJmb3JtXCJdJyk7XG5cbiAgICBjb25zdCBwcmVBY3Rpb24gPSBwcmVGb3JtRWxlbWVudC5hdHRyKCdhY3Rpb24nKTtcbiAgICBpZiAoIXByZUFjdGlvbilcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1NJR0FBOiBGb3JtIHdpdGhvdXQgYWN0aW9uIGF0IGNoYW5nZSBwYXNzd29yZCBwcmUgcGFnZS4nXG4gICAgICApO1xuXG4gICAgY29uc3QgcHJlQWN0aW9uVXJsID0gbmV3IFVSTChwcmVBY3Rpb24sIHByZVBhZ2UudXJsLmhyZWYpO1xuXG4gICAgY29uc3QgcHJlUG9zdFZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuXG4gICAgY29uc3QgcHJlSW5wdXRzID0gcHJlRm9ybUVsZW1lbnRcbiAgICAgIC5maW5kKFwiaW5wdXRbbmFtZV06bm90KFt0eXBlPSdzdWJtaXQnXSlcIilcbiAgICAgIC50b0FycmF5KCk7XG4gICAgZm9yIChjb25zdCBpbnB1dCBvZiBwcmVJbnB1dHMpIHtcbiAgICAgIGNvbnN0IG5hbWUgPSBwcmVQYWdlLiQoaW5wdXQpLmF0dHIoJ25hbWUnKTtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHByZVBvc3RWYWx1ZXNbbmFtZV0gPSBwcmVQYWdlLiQoaW5wdXQpLnZhbCgpO1xuICAgICAgfVxuICAgIH1cbiAgICBwcmVQb3N0VmFsdWVzWydmb3JtOmFsdGVyYXJTZW5oYSddID0gJ2Zvcm06YWx0ZXJhclNlbmhhJztcbiAgICBjb25zdCBwYWdlID0gYXdhaXQgdGhpcy5odHRwLnBvc3QocHJlQWN0aW9uVXJsLmhyZWYsIHByZVBvc3RWYWx1ZXMpO1xuICAgIGNvbnN0IGZvcm1FbGVtZW50ID0gcGFnZS4kKCdmb3JtW25hbWU9XCJmb3JtXCJdJyk7XG5cbiAgICBjb25zdCBhY3Rpb24gPSBmb3JtRWxlbWVudC5hdHRyKCdhY3Rpb24nKTtcbiAgICBpZiAoIWFjdGlvbilcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IEZvcm0gd2l0aG91dCBhY3Rpb24gYXQgY2hhbmdlIHBhc3N3b3JkIHBhZ2UuJyk7XG4gICAgY29uc3QgZm9ybUFjdGlvbiA9IG5ldyBVUkwoYWN0aW9uLCBwYWdlLnVybC5ocmVmKTtcblxuICAgIGNvbnN0IHBvc3RWYWx1ZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICBjb25zdCBpbnB1dHMgPSBmb3JtRWxlbWVudFxuICAgICAgLmZpbmQoXCJpbnB1dFtuYW1lXTpub3QoW3R5cGU9J3N1Ym1pdCddKVwiKVxuICAgICAgLnRvQXJyYXkoKTtcbiAgICBmb3IgKGNvbnN0IGlucHV0IG9mIGlucHV0cykge1xuICAgICAgY29uc3QgbmFtZSA9IHBhZ2UuJChpbnB1dCkuYXR0cignbmFtZScpO1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcG9zdFZhbHVlc1tuYW1lXSA9IHByZVBhZ2UuJChpbnB1dCkudmFsKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcG9zdFZhbHVlc1snZm9ybTpzZW5oYUF0dWFsJ10gPSBvbGRQYXNzd29yZDtcbiAgICBwb3N0VmFsdWVzWydmb3JtOm5vdmFTZW5oYSddID0gbmV3UGFzc3dvcmQ7XG4gICAgcG9zdFZhbHVlc1snZm9ybTpyZXBldG5Ob3ZhU2VuaGEnXSA9IG5ld1Bhc3N3b3JkO1xuICAgIHBvc3RWYWx1ZXNbJ2Zvcm06YWx0ZXJhckRhZG9zJ10gPSAnQWx0ZXJhciBEYWRvcyc7XG5cbiAgICBjb25zdCByZXN1bHRQYWdlID0gYXdhaXQgdGhpcy5odHRwLnBvc3QoZm9ybUFjdGlvbi5ocmVmLCBwb3N0VmFsdWVzKTtcblxuICAgIGlmIChyZXN1bHRQYWdlLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChcbiAgICAgICAgcmVzdWx0UGFnZS4kKCcuZXJyb3MgbGknKS5odG1sKClcbiAgICAgICk7XG4gICAgICBpZiAoZXJyb3JNc2cuaW5jbHVkZXMoJ0Egc2VuaGEgZGlnaXRhZGEgw6kgbXVpdG8gc2ltcGxlcy4nKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5lcnJvckluc3VmZmljaWVudFBhc3N3b3JkQ29tcGxleGl0eSk7XG4gICAgICB9XG4gICAgICBpZiAoZXJyb3JNc2cuaW5jbHVkZXMoJ1NlbmhhIEF0dWFsIGRpZ2l0YWRhIG7Do28gY29uZmVyZScpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmVycm9ySW52YWxpZENyZWRlbnRpYWxzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVzdWx0UGFnZS5zdGF0dXNDb2RlICE9PSAzMDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1NJR0FBOiBUaGUgY2hhbmdlIHBhc3N3b3JkIHBhZ2Ugc3RhdHVzIGNvZGUgaXMgZGlmZmVyZW50IHRoYW4gZXhwZWN0ZWQuJ1xuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==