"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SigaaAccountUFFS = void 0;

require("source-map-support/register");

var _sigaaTypes = require("../sigaa-types");

var _url = require("url");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Responsible for representing the user account.
 * @category Internal
 */
class SigaaAccountUFFS {
  /**
   * @param homepage homepage (page after login) of user.
   */
  constructor(homepage, http, parser, session, bondFactory) {
    this.http = http;
    this.parser = parser;
    this.session = session;
    this.bondFactory = bondFactory;

    _defineProperty(this, "errorInvalidCredentials", 'SIGAA: Invalid credentials.');

    _defineProperty(this, "errorInsufficientPasswordComplexity", 'SIGAA: Insufficent password complexity.');

    _defineProperty(this, "activeBonds", []);

    _defineProperty(this, "inactiveBonds", []);

    _defineProperty(this, "pagehomeParsePromise", void 0);

    _defineProperty(this, "_name", void 0);

    _defineProperty(this, "_emails", void 0);

    this.parseHomepage(homepage);
  }
  /**
   * Error message when the new password chosen does not meet the security requirements of SIGAA.
   * It is thrown by the changePassword() method
   */


  /**
   * Parse login result page to fill the instance.
   *
   * @param homepage home page to parse.
   */
  parseHomepage(homepage) {
    // Imprima a URL da página para fins de depuração
    console.log('Homepage URL:', homepage.url.href); // Since the login page can vary, we should check the type of page.

    if (homepage.bodyDecoded.includes('O sistema comportou-se de forma inesperada')) {
      throw new Error('SIGAA: Invalid homepage, the system behaved unexpectedly.');
    }

    if (homepage.url.href.includes('/portais/discente/beta/discente.jsf')) {
      // If it is the home page of the student desktop version.
      this.pagehomeParsePromise = this.parseStudentHomePage(homepage);
    } else if (homepage.url.href.includes('/sigaa/vinculos.jsf') || homepage.url.href.includes('/sigaa/escolhaVinculo.do')) {
      // If it is a bond page.
      this.pagehomeParsePromise = this.parseBondPage(homepage);
    } else {
      // Log adicional para identificar a URL desconhecida
      console.log('Unknown homepage URL:', homepage.url.href);
      throw new Error('SIGAA: Unknown homepage format.');
    }
  }
  /**
   * Parse bond page.
   * @param page page to parse.
   */


  async parseBondPage(page) {
    const rows = page.$('table.subFormulario tbody tr').toArray();

    for (const row of rows) {
      const cells = page.$(row).find('td').toArray();
      if (cells.length === 0) continue;
      const bondType = this.parser.removeTagsHtml(page.$(row).find('#tdTipo').html());
      const status = this.parser.removeTagsHtml(page.$(cells[3]).html());
      let bond;

      switch (bondType) {
        case 'Discente':
          {
            const registration = this.parser.removeTagsHtml(page.$(cells[2]).html());
            const url = page.$(row).find('a[href]').attr('href');
            if (!url) throw new Error('SIGAA: Bond switch url could not be found.');
            const bondSwitchUrl = new _url.URL(url, page.url);
            const program = this.parser.removeTagsHtml(page.$(cells[4]).html()).replace(/^Curso: /g, '');
            bond = this.bondFactory.createStudentBond(registration, program, bondSwitchUrl);
            break;
          }

        case 'Docente':
          {
            bond = this.bondFactory.createTeacherBond();
            break;
          }
      }

      if (bond) if (status === 'Sim') {
        this.activeBonds.push(bond);
      } else if (status === 'Não') {
        this.inactiveBonds.push(bond);
      } else {
        console.log('SIGAA: WARNING invalid status: ' + status);
      }
    }
  }
  /**
   * @inheritdoc
   */


  async getActiveBonds() {
    await this.pagehomeParsePromise;
    return this.activeBonds;
  }
  /**
   * @inheritdoc
   */


  async getInactiveBonds() {
    await this.pagehomeParsePromise;
    return this.inactiveBonds;
  }
  /**
   * Parse desktop version of student home page page.
   */


  async parseStudentHomePage(homepage) {
    const registration = this.parser.removeTagsHtml(homepage.$('.detalhes-usuario-matricula').html());
    const program = this.parser.removeTagsHtml(homepage.$('.painel-usuario-identificacao div').eq(1).html());
    if (!registration) throw new Error('SIGAA: Student bond without registration code.');
    if (!program) throw new Error('SIGAA: Student bond program not found.');
    this.activeBonds.push(this.bondFactory.createStudentBond(registration, program, null));
  }
  /**
   * @inheritdoc
   */


  logoff() {
    return this.http.get('/sigaa/logoff/').then(page => {
      return this.http.followAllRedirect(page);
    }).then(page => {
      if (page.statusCode !== 200) {
        throw new Error('SIGAA: Invalid status code in logoff page.');
      }

      this.session.loginStatus = _sigaaTypes.LoginStatus.Unauthenticated;
      this.http.closeSession();
    });
  }
  /**
   * Get profile picture URL.
   * @retuns Picture url or null if the user has no photo.
   */


  async getProfilePictureURL() {
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');
    const pictureElement = page.$('#fotoUsuario .foto');
    if (pictureElement.length === 0) return null;
    const pictureStyle = pictureElement.attr('style');
    if (!pictureStyle) return null;
    const pictureUrl = (pictureStyle.match(/https?:[^")]+/) || [])[0];
    if (!pictureUrl) return null;
    return new _url.URL(pictureUrl, page.url);
  }
  /**
   * Download profile url and save in basepath.
   * @param destpath It can be a folder or a file name, if it is a directory then it will be saved inside the folder, if it is a file name it will be saved exactly in this place, but if the folder does not exist it will throw an error.
   * @param callback To know the progress of the download, each downloaded part will be called informing how much has already been downloaded.
   * @retuns Full path of the downloaded file, useful if the destpath is a directory, or null if the user has no photo.
   */


  async downloadProfilePicture(destpath, callback) {
    const pictureURL = await this.getProfilePictureURL();
    if (!pictureURL) return null;
    return this.http.downloadFileByGet(pictureURL.href, destpath, callback);
  }
  /**
   * @inheritdoc
   */


  async getName() {
    if (this._name) return this._name;
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');

    if (page.statusCode === 200) {
      const username = this.parser.removeTagsHtml(page.$('.detalhes-usuario-nome').html());
      this._name = username;
      return username;
    } else {
      throw new Error('SIGAA: Unexpected status code at student profile page.');
    }
  }
  /**
   * @inheritdoc
   */


  async getEmails() {
    if (this._emails) return this._emails;
    const page = await this.http.get('/sigaa/portais/discente/beta/discente.jsf');

    if (page.statusCode === 200) {
      this._emails = [];
      const rows = page.$('.detalhes-usuario table').eq(0).find('tr').toArray();

      for (const row of rows) {
        const cells = page.$(row).find('td');

        if (this.parser.removeTagsHtml(cells.eq(0).html()) === 'E-mail:') {
          const email = this.parser.removeTagsHtml(cells.eq(1).html());
          if (email) this._emails.push(email);
          break;
        }
      }

      return this._emails;
    } else {
      throw new Error('SIGAA: Unexpected status code at student profile page.');
    }
  }
  /**
   * Change the password of account.
   * @param oldPassword current password.
   * @param newPassword new password.
   * @throws {errorInvalidCredentials} If current password is not correct.
   * @throws {errorInsufficientPasswordComplexity} If the new password does not have the complexity requirement.
   */


  async changePassword(oldPassword, newPassword) {
    const formPage = await this.http.get('/sigaa/alterar_dados.jsf');
    if (formPage.statusCode !== 302) throw new Error('SIGAA: Unexpected status code at change password form.');
    const prePage = await this.http.followAllRedirect(formPage);
    if (prePage.statusCode !== 200 || !prePage.url.href.includes('usuario/alterar_dados.jsf')) throw new Error('SIGAA: Invalid pre page at change password.');
    const preFormElement = prePage.$('form[name="form"]');
    const preAction = preFormElement.attr('action');
    if (!preAction) throw new Error('SIGAA: Form without action at change password pre page.');
    const preActionUrl = new _url.URL(preAction, prePage.url.href);
    const prePostValues = {};
    const preInputs = preFormElement.find("input[name]:not([type='submit'])").toArray();

    for (const input of preInputs) {
      const name = prePage.$(input).attr('name');

      if (name) {
        prePostValues[name] = prePage.$(input).val();
      }
    }

    prePostValues['form:alterarSenha'] = 'form:alterarSenha';
    const page = await this.http.post(preActionUrl.href, prePostValues);
    const formElement = page.$('form[name="form"]');
    const action = formElement.attr('action');
    if (!action) throw new Error('SIGAA: Form without action at change password page.');
    const formAction = new _url.URL(action, page.url.href);
    const postValues = {};
    const inputs = formElement.find("input[name]:not([type='submit'])").toArray();

    for (const input of inputs) {
      const name = page.$(input).attr('name');

      if (name) {
        postValues[name] = prePage.$(input).val();
      }
    }

    postValues['form:senhaAtual'] = oldPassword;
    postValues['form:novaSenha'] = newPassword;
    postValues['form:repetnNovaSenha'] = newPassword;
    postValues['form:alterarDados'] = 'Alterar Dados';
    const resultPage = await this.http.post(formAction.href, postValues);

    if (resultPage.statusCode === 200) {
      const errorMsg = this.parser.removeTagsHtml(resultPage.$('.erros li').html());

      if (errorMsg.includes('A senha digitada é muito simples.')) {
        throw new Error(this.errorInsufficientPasswordComplexity);
      }

      if (errorMsg.includes('Senha Atual digitada não confere')) {
        throw new Error(this.errorInvalidCredentials);
      }
    }

    if (resultPage.statusCode !== 302) {
      throw new Error('SIGAA: The change password page status code is different than expected.');
    }
  }

}

exports.SigaaAccountUFFS = SigaaAccountUFFS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY2NvdW50L3NpZ2FhLWFjY291bnQtdWZmcy50cyJdLCJuYW1lcyI6WyJTaWdhYUFjY291bnRVRkZTIiwiY29uc3RydWN0b3IiLCJob21lcGFnZSIsImh0dHAiLCJwYXJzZXIiLCJzZXNzaW9uIiwiYm9uZEZhY3RvcnkiLCJwYXJzZUhvbWVwYWdlIiwiY29uc29sZSIsImxvZyIsInVybCIsImhyZWYiLCJib2R5RGVjb2RlZCIsImluY2x1ZGVzIiwiRXJyb3IiLCJwYWdlaG9tZVBhcnNlUHJvbWlzZSIsInBhcnNlU3R1ZGVudEhvbWVQYWdlIiwicGFyc2VCb25kUGFnZSIsInBhZ2UiLCJyb3dzIiwiJCIsInRvQXJyYXkiLCJyb3ciLCJjZWxscyIsImZpbmQiLCJsZW5ndGgiLCJib25kVHlwZSIsInJlbW92ZVRhZ3NIdG1sIiwiaHRtbCIsInN0YXR1cyIsImJvbmQiLCJyZWdpc3RyYXRpb24iLCJhdHRyIiwiYm9uZFN3aXRjaFVybCIsIlVSTCIsInByb2dyYW0iLCJyZXBsYWNlIiwiY3JlYXRlU3R1ZGVudEJvbmQiLCJjcmVhdGVUZWFjaGVyQm9uZCIsImFjdGl2ZUJvbmRzIiwicHVzaCIsImluYWN0aXZlQm9uZHMiLCJnZXRBY3RpdmVCb25kcyIsImdldEluYWN0aXZlQm9uZHMiLCJlcSIsImxvZ29mZiIsImdldCIsInRoZW4iLCJmb2xsb3dBbGxSZWRpcmVjdCIsInN0YXR1c0NvZGUiLCJsb2dpblN0YXR1cyIsIkxvZ2luU3RhdHVzIiwiVW5hdXRoZW50aWNhdGVkIiwiY2xvc2VTZXNzaW9uIiwiZ2V0UHJvZmlsZVBpY3R1cmVVUkwiLCJwaWN0dXJlRWxlbWVudCIsInBpY3R1cmVTdHlsZSIsInBpY3R1cmVVcmwiLCJtYXRjaCIsImRvd25sb2FkUHJvZmlsZVBpY3R1cmUiLCJkZXN0cGF0aCIsImNhbGxiYWNrIiwicGljdHVyZVVSTCIsImRvd25sb2FkRmlsZUJ5R2V0IiwiZ2V0TmFtZSIsIl9uYW1lIiwidXNlcm5hbWUiLCJnZXRFbWFpbHMiLCJfZW1haWxzIiwiZW1haWwiLCJjaGFuZ2VQYXNzd29yZCIsIm9sZFBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJmb3JtUGFnZSIsInByZVBhZ2UiLCJwcmVGb3JtRWxlbWVudCIsInByZUFjdGlvbiIsInByZUFjdGlvblVybCIsInByZVBvc3RWYWx1ZXMiLCJwcmVJbnB1dHMiLCJpbnB1dCIsIm5hbWUiLCJ2YWwiLCJwb3N0IiwiZm9ybUVsZW1lbnQiLCJhY3Rpb24iLCJmb3JtQWN0aW9uIiwicG9zdFZhbHVlcyIsImlucHV0cyIsInJlc3VsdFBhZ2UiLCJlcnJvck1zZyIsImVycm9ySW5zdWZmaWNpZW50UGFzc3dvcmRDb21wbGV4aXR5IiwiZXJyb3JJbnZhbGlkQ3JlZGVudGlhbHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUlBOztBQUlBOzs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQSxnQkFBTixDQUEwQztBQUMvQztBQUNGO0FBQ0E7QUFDRUMsRUFBQUEsV0FBVyxDQUNUQyxRQURTLEVBRURDLElBRkMsRUFHREMsTUFIQyxFQUlEQyxPQUpDLEVBS0RDLFdBTEMsRUFNVDtBQUFBLFNBSlFILElBSVIsR0FKUUEsSUFJUjtBQUFBLFNBSFFDLE1BR1IsR0FIUUEsTUFHUjtBQUFBLFNBRlFDLE9BRVIsR0FGUUEsT0FFUjtBQUFBLFNBRFFDLFdBQ1IsR0FEUUEsV0FDUjs7QUFBQSxxREFRaUMsNkJBUmpDOztBQUFBLGlFQWVBLHlDQWZBOztBQUFBLHlDQW9CZ0MsRUFwQmhDOztBQUFBLDJDQXlCa0MsRUF6QmxDOztBQUFBOztBQUFBOztBQUFBOztBQUNBLFNBQUtDLGFBQUwsQ0FBbUJMLFFBQW5CO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTs7O0FBbUNFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDVUssRUFBQUEsYUFBYSxDQUFDTCxRQUFELEVBQXVCO0FBQzFDO0FBQ0FNLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGVBQVosRUFBNkJQLFFBQVEsQ0FBQ1EsR0FBVCxDQUFh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QUFBLFVBQVUsQ0FBQyxzQkFBRCxDQUFWLEdBQXFDZixXQUFyQztBQUNBZSxJQUFBQSxVQUFVLENBQUMsbUJBQUQsQ0FBVixHQUFrQyxlQUFsQztBQUVBLFVBQU1FLFVBQVUsR0FBRyxNQUFNLEtBQUt0RixJQUFMLENBQVVnRixJQUFWLENBQWVHLFVBQVUsQ0FBQzNFLElBQTFCLEVBQWdDNEUsVUFBaEMsQ0FBekI7O0FBRUEsUUFBSUUsVUFBVSxDQUFDeEMsVUFBWCxLQUEwQixHQUE5QixFQUFtQztBQUNqQyxZQUFNeUMsUUFBUSxHQUFHLEtBQUt0RixNQUFMLENBQVl1QixjQUFaLENBQ2Y4RCxVQUFVLENBQUNyRSxDQUFYLENBQWEsV0FBYixFQUEwQlEsSUFBMUIsRUFEZSxDQUFqQjs7QUFHQSxVQUFJOEQsUUFBUSxDQUFDN0UsUUFBVCxDQUFrQixtQ0FBbEIsQ0FBSixFQUE0RDtBQUMxRCxjQUFNLElBQUlDLEtBQUosQ0FBVSxLQUFLNkUsbUNBQWYsQ0FBTjtBQUNEOztBQUNELFVBQUlELFFBQVEsQ0FBQzdFLFFBQVQsQ0FBa0Isa0NBQWxCLENBQUosRUFBMkQ7QUFDekQsY0FBTSxJQUFJQyxLQUFKLENBQVUsS0FBSzhFLHVCQUFmLENBQU47QUFDRDtBQUNGOztBQUVELFFBQUlILFVBQVUsQ0FBQ3hDLFVBQVgsS0FBMEIsR0FBOUIsRUFBbUM7QUFDakMsWUFBTSxJQUFJbkMsS0FBSixDQUNKLHlFQURJLENBQU47QUFHRDtBQUNGOztBQW5XOEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBwcmV0dGllci9wcmV0dGllciAqL1xuaW1wb3J0IHsgUGFyc2VyIH0gZnJvbSAnQGhlbHBlcnMvc2lnYWEtcGFyc2VyJztcbmltcG9ydCB7IEhUVFAsIFByb2dyZXNzQ2FsbGJhY2sgfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1odHRwJztcbmltcG9ydCB7IFNlc3Npb24gfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1zZXNzaW9uJztcbmltcG9ydCB7IExvZ2luU3RhdHVzIH0gZnJvbSAnLi4vc2lnYWEtdHlwZXMnO1xuaW1wb3J0IHsgQm9uZEZhY3RvcnksIEJvbmRUeXBlIH0gZnJvbSAnQGJvbmRzL3NpZ2FhLWJvbmQtZmFjdG9yeSc7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtcGFnZSc7XG5pbXBvcnQgeyBBY2NvdW50IH0gZnJvbSAnLi9zaWdhYS1hY2NvdW50JztcbmltcG9ydCB7IFVSTCB9IGZyb20gJ3VybCc7XG5cbi8qKlxuICogUmVzcG9uc2libGUgZm9yIHJlcHJlc2VudGluZyB0aGUgdXNlciBhY2NvdW50LlxuICogQGNhdGVnb3J5IEludGVybmFsXG4gKi9cbmV4cG9ydCBjbGFzcyBTaWdhYUFjY291bnRVRkZTIGltcGxlbWVudHMgQWNjb3VudCB7XG4gIC8qKlxuICAgKiBAcGFyYW0gaG9tZXBhZ2UgaG9tZXBhZ2UgKHBhZ2UgYWZ0ZXIgbG9naW4pIG9mIHVzZXIuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBob21lcGFnZTogUGFnZSxcbiAgICBwcml2YXRlIGh0dHA6IEhUVFAsXG4gICAgcHJpdmF0ZSBwYXJzZXI6IFBhcnNlcixcbiAgICBwcml2YXRlIHNlc3Npb246IFNlc3Npb24sXG4gICAgcHJpdmF0ZSBib25kRmFjdG9yeTogQm9uZEZhY3RvcnlcbiAgKSB7XG4gICAgdGhpcy5wYXJzZUhvbWVwYWdlKGhvbWVwYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFcnJvciBtZXNzYWdlIHdoZW4gdGhlIG5ldyBwYXNzd29yZCBjaG9zZW4gZG9lcyBub3QgbWVldCB0aGUgc2VjdXJpdHkgcmVxdWlyZW1lbnRzIG9mIFNJR0FBLlxuICAgKiBJdCBpcyB0aHJvd24gYnkgdGhlIGNoYW5nZVBhc3N3b3JkKCkgbWV0aG9kXG4gICAqL1xuICByZWFkb25seSBlcnJvckludmFsaWRDcmVkZW50aWFscyA9ICdTSUdBQTogSW52YWxpZCBjcmVkZW50aWFscy4nO1xuXG4gIC8qKlxuICAgKiBFcnJvciBtZXNzYWdlIHdoZW4gdGhlIG9sZCBwYXNzd29yZCBpcyBub3QgdGhlIGN1cnJlbnQgcGFzc3dvcmQuXG4gICAqIEl0IGlzIHRocm93biBieSB0aGUgY2hhbmdlUGFzc3dvcmQoKSBtZXRob2QuXG4gICAqL1xuICByZWFkb25seSBlcnJvckluc3VmZmljaWVudFBhc3N3b3JkQ29tcGxleGl0eSA9XG4gICAgJ1NJR0FBOiBJbnN1ZmZpY2VudCBwYXNzd29yZCBjb21wbGV4aXR5Lic7XG5cbiAgLyoqXG4gICAqIEFycmF5IG9mIGFjdGl2ZSBib25kcy5cbiAgICovXG4gIHByaXZhdGUgYWN0aXZlQm9uZHM6IEJvbmRUeXBlW10gPSBbXTtcblxuICAvKipcbiAgICogQXJyYXkgb2YgaW5hY3RpdmUgYm9uZHMuXG4gICAqL1xuICBwcml2YXRlIGluYWN0aXZlQm9uZHM6IEJvbmRUeXBlW10gPSBbXTtcblxuICAvKipcbiAgICogSXQgaXMgYSBwcm9taXNlIHRoYXQgc3RvcmVzIGlmIHRoZSBwYWdlIHBhcnNlciBoYXMgYWxyZWFkeSBjb21wbGV0ZWRcbiAgICovXG4gIHByaXZhdGUgcGFnZWhvbWVQYXJzZVByb21pc2U/OiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBTdHVkZW50IG5hbWUgY2FjaGVcbiAgICovXG4gIHByaXZhdGUgX25hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFN0dWRlbnQgZS1tYWlsIGNhY2hlXG4gICAqL1xuICBwcml2YXRlIF9lbWFpbHM/OiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogUGFyc2UgbG9naW4gcmVzdWx0IHBhZ2UgdG8gZmlsbCB0aGUgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBob21lcGFnZSBob21lIHBhZ2UgdG8gcGFyc2UuXG4gICAqL1xuICBwcml2YXRlIHBhcnNlSG9tZXBhZ2UoaG9tZXBhZ2U6IFBhZ2UpOiB2b2lkIHtcbiAgICAvLyBJbXByaW1hIGEgVVJMIGRhIHDDoWdpbmEgcGFyYSBmaW5zIGRlIGRlcHVyYcOnw6NvXG4gICAgY29uc29sZS5sb2coJ0hvbWVwYWdlIFVSTDonLCBob21lcGFnZS51cmwuaHJlZik7XG5cbiAgICAvLyBTaW5jZSB0aGUgbG9naW4gcGFnZSBjYW4gdmFyeSwgd2Ugc2hvdWxkIGNoZWNrIHRoZSB0eXBlIG9mIHBhZ2UuXG4gICAgaWYgKGhvbWVwYWdlLmJvZHlEZWNvZGVkLmluY2x1ZGVzKCdPIHNpc3RlbWEgY29tcG9ydG91LXNlIGRlIGZvcm1hIGluZXNwZXJhZGEnKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBJbnZhbGlkIGhvbWVwYWdlLCB0aGUgc3lzdGVtIGJlaGF2ZWQgdW5leHBlY3RlZGx5LicpO1xuICAgIH1cblxuICAgIGlmIChob21lcGFnZS51cmwuaHJlZi5pbmNsdWRlcygnL3BvcnRhaXMvZGlzY2VudGUvYmV0YS9kaXNjZW50ZS5qc2YnKSkge1xuICAgICAgICAvLyBJZiBpdCBpcyB0aGUgaG9tZSBwYWdlIG9mIHRoZSBzdHVkZW50IGRlc2t0b3AgdmVyc2lvbi5cbiAgICAgICAgdGhpcy5wYWdlaG9tZVBhcnNlUHJvbWlzZSA9IHRoaXMucGFyc2VTdHVkZW50SG9tZVBhZ2UoaG9tZXBhZ2UpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGhvbWVwYWdlLnVybC5ocmVmLmluY2x1ZGVzKCcvc2lnYWEvdmluY3Vsb3MuanNmJykgfHxcbiAgICAgICAgaG9tZXBhZ2UudXJsLmhyZWYuaW5jbHVkZXMoJy9zaWdhYS9lc2NvbGhhVmluY3Vsby5kbycpXG4gICAgKSB7XG4gICAgICAgIC8vIElmIGl0IGlzIGEgYm9uZCBwYWdlLlxuICAgICAgICB0aGlzLnBhZ2Vob21lUGFyc2VQcm9taXNlID0gdGhpcy5wYXJzZUJvbmRQYWdlKGhvbWVwYWdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBMb2cgYWRpY2lvbmFsIHBhcmEgaWRlbnRpZmljYXIgYSBVUkwgZGVzY29uaGVjaWRhXG4gICAgICAgIGNvbnNvbGUubG9nKCdVbmtub3duIGhvbWVwYWdlIFVSTDonLCBob21lcGFnZS51cmwuaHJlZik7XG5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogVW5rbm93biBob21lcGFnZSBmb3JtYXQuJyk7XG4gICAgfVxufVxuXG5cbiAgLyoqXG4gICAqIFBhcnNlIGJvbmQgcGFnZS5cbiAgICogQHBhcmFtIHBhZ2UgcGFnZSB0byBwYXJzZS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcGFyc2VCb25kUGFnZShwYWdlOiBQYWdlKSB7XG4gICAgY29uc3Qgcm93cyA9IHBhZ2UuJCgndGFibGUuc3ViRm9ybXVsYXJpbyB0Ym9keSB0cicpLnRvQXJyYXkoKTtcbiAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICBjb25zdCBjZWxscyA9IHBhZ2UuJChyb3cpLmZpbmQoJ3RkJykudG9BcnJheSgpO1xuICAgICAgaWYgKGNlbGxzLmxlbmd0aCA9PT0gMCkgY29udGludWU7XG5cbiAgICAgIGNvbnN0IGJvbmRUeXBlID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoXG4gICAgICAgIHBhZ2UuJChyb3cpLmZpbmQoJyN0ZFRpcG8nKS5odG1sKClcbiAgICAgICk7XG4gICAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChwYWdlLiQoY2VsbHNbM10pLmh0bWwoKSk7XG4gICAgICBsZXQgYm9uZDtcbiAgICAgIHN3aXRjaCAoYm9uZFR5cGUpIHtcbiAgICAgICAgY2FzZSAnRGlzY2VudGUnOiB7XG4gICAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoXG4gICAgICAgICAgICBwYWdlLiQoY2VsbHNbMl0pLmh0bWwoKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBjb25zdCB1cmwgPSBwYWdlLiQocm93KS5maW5kKCdhW2hyZWZdJykuYXR0cignaHJlZicpO1xuICAgICAgICAgIGlmICghdXJsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogQm9uZCBzd2l0Y2ggdXJsIGNvdWxkIG5vdCBiZSBmb3VuZC4nKTtcbiAgICAgICAgICBjb25zdCBib25kU3dpdGNoVXJsID0gbmV3IFVSTCh1cmwsIHBhZ2UudXJsKTtcblxuICAgICAgICAgIGNvbnN0IHByb2dyYW0gPSB0aGlzLnBhcnNlclxuICAgICAgICAgICAgLnJlbW92ZVRhZ3NIdG1sKHBhZ2UuJChjZWxsc1s0XSkuaHRtbCgpKVxuICAgICAgICAgICAgLnJlcGxhY2UoL15DdXJzbzogL2csICcnKTtcbiAgICAgICAgICBib25kID0gdGhpcy5ib25kRmFjdG9yeS5jcmVhdGVTdHVkZW50Qm9uZChcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbixcbiAgICAgICAgICAgIHByb2dyYW0sXG4gICAgICAgICAgICBib25kU3dpdGNoVXJsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdEb2NlbnRlJzoge1xuICAgICAgICAgIGJvbmQgPSB0aGlzLmJvbmRGYWN0b3J5LmNyZWF0ZVRlYWNoZXJCb25kKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChib25kKVxuICAgICAgICBpZiAoc3RhdHVzID09PSAnU2ltJykge1xuICAgICAgICAgIHRoaXMuYWN0aXZlQm9uZHMucHVzaChib25kKTtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdOw6NvJykge1xuICAgICAgICAgIHRoaXMuaW5hY3RpdmVCb25kcy5wdXNoKGJvbmQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTSUdBQTogV0FSTklORyBpbnZhbGlkIHN0YXR1czogJyArIHN0YXR1cyk7XG4gICAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIGFzeW5jIGdldEFjdGl2ZUJvbmRzKCk6IFByb21pc2U8Qm9uZFR5cGVbXT4ge1xuICAgIGF3YWl0IHRoaXMucGFnZWhvbWVQYXJzZVByb21pc2U7XG4gICAgcmV0dXJuIHRoaXMuYWN0aXZlQm9uZHM7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIGFzeW5jIGdldEluYWN0aXZlQm9uZHMoKTogUHJvbWlzZTxCb25kVHlwZVtdPiB7XG4gICAgYXdhaXQgdGhpcy5wYWdlaG9tZVBhcnNlUHJvbWlzZTtcbiAgICByZXR1cm4gdGhpcy5pbmFjdGl2ZUJvbmRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIGRlc2t0b3AgdmVyc2lvbiBvZiBzdHVkZW50IGhvbWUgcGFnZSBwYWdlLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwYXJzZVN0dWRlbnRIb21lUGFnZShob21lcGFnZTogUGFnZSkge1xuICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgaG9tZXBhZ2UuJCgnLmRldGFsaGVzLXVzdWFyaW8tbWF0cmljdWxhJykuaHRtbCgpXG4gICAgKTtcbiAgICBjb25zdCBwcm9ncmFtID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoXG4gICAgICBob21lcGFnZS4kKCcucGFpbmVsLXVzdWFyaW8taWRlbnRpZmljYWNhbyBkaXYnKS5lcSgxKS5odG1sKClcbiAgICApO1xuXG4gICAgaWYgKCFyZWdpc3RyYXRpb24pXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBTdHVkZW50IGJvbmQgd2l0aG91dCByZWdpc3RyYXRpb24gY29kZS4nKTtcblxuICAgIGlmICghcHJvZ3JhbSkgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogU3R1ZGVudCBib25kIHByb2dyYW0gbm90IGZvdW5kLicpO1xuXG4gICAgdGhpcy5hY3RpdmVCb25kcy5wdXNoKFxuICAgICAgdGhpcy5ib25kRmFjdG9yeS5jcmVhdGVTdHVkZW50Qm9uZChyZWdpc3RyYXRpb24sIHByb2dyYW0sIG51bGwpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdGRvY1xuICAgKi9cbiAgbG9nb2ZmKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5nZXQoJy9zaWdhYS9sb2dvZmYvJylcbiAgICAgIC50aGVuKChwYWdlKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZm9sbG93QWxsUmVkaXJlY3QocGFnZSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKHBhZ2UpID0+IHtcbiAgICAgICAgaWYgKHBhZ2Uuc3RhdHVzQ29kZSAhPT0gMjAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogSW52YWxpZCBzdGF0dXMgY29kZSBpbiBsb2dvZmYgcGFnZS4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlc3Npb24ubG9naW5TdGF0dXMgPSBMb2dpblN0YXR1cy5VbmF1dGhlbnRpY2F0ZWQ7XG4gICAgICAgIHRoaXMuaHR0cC5jbG9zZVNlc3Npb24oKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwcm9maWxlIHBpY3R1cmUgVVJMLlxuICAgKiBAcmV0dW5zIFBpY3R1cmUgdXJsIG9yIG51bGwgaWYgdGhlIHVzZXIgaGFzIG5vIHBob3RvLlxuICAgKi9cbiAgYXN5bmMgZ2V0UHJvZmlsZVBpY3R1cmVVUkwoKTogUHJvbWlzZTxVUkwgfCBudWxsPiB7XG4gICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5nZXQoXG4gICAgICAnL3NpZ2FhL3BvcnRhaXMvZGlzY2VudGUvYmV0YS9kaXNjZW50ZS5qc2YnXG4gICAgKTtcblxuICAgIGNvbnN0IHBpY3R1cmVFbGVtZW50ID0gcGFnZS4kKCcjZm90b1VzdWFyaW8gLmZvdG8nKTtcbiAgICBpZiAocGljdHVyZUVsZW1lbnQubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBwaWN0dXJlU3R5bGUgPSBwaWN0dXJlRWxlbWVudC5hdHRyKCdzdHlsZScpO1xuICAgIGlmICghcGljdHVyZVN0eWxlKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBwaWN0dXJlVXJsID0gKHBpY3R1cmVTdHlsZS5tYXRjaCgvaHR0cHM/OlteXCIpXSsvKSB8fCBbXSlbMF07XG4gICAgaWYgKCFwaWN0dXJlVXJsKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gbmV3IFVSTChwaWN0dXJlVXJsLCBwYWdlLnVybCk7XG4gIH1cblxuICAvKipcbiAgICogRG93bmxvYWQgcHJvZmlsZSB1cmwgYW5kIHNhdmUgaW4gYmFzZXBhdGguXG4gICAqIEBwYXJhbSBkZXN0cGF0aCBJdCBjYW4gYmUgYSBmb2xkZXIgb3IgYSBmaWxlIG5hbWUsIGlmIGl0IGlzIGEgZGlyZWN0b3J5IHRoZW4gaXQgd2lsbCBiZSBzYXZlZCBpbnNpZGUgdGhlIGZvbGRlciwgaWYgaXQgaXMgYSBmaWxlIG5hbWUgaXQgd2lsbCBiZSBzYXZlZCBleGFjdGx5IGluIHRoaXMgcGxhY2UsIGJ1dCBpZiB0aGUgZm9sZGVyIGRvZXMgbm90IGV4aXN0IGl0IHdpbGwgdGhyb3cgYW4gZXJyb3IuXG4gICAqIEBwYXJhbSBjYWxsYmFjayBUbyBrbm93IHRoZSBwcm9ncmVzcyBvZiB0aGUgZG93bmxvYWQsIGVhY2ggZG93bmxvYWRlZCBwYXJ0IHdpbGwgYmUgY2FsbGVkIGluZm9ybWluZyBob3cgbXVjaCBoYXMgYWxyZWFkeSBiZWVuIGRvd25sb2FkZWQuXG4gICAqIEByZXR1bnMgRnVsbCBwYXRoIG9mIHRoZSBkb3dubG9hZGVkIGZpbGUsIHVzZWZ1bCBpZiB0aGUgZGVzdHBhdGggaXMgYSBkaXJlY3RvcnksIG9yIG51bGwgaWYgdGhlIHVzZXIgaGFzIG5vIHBob3RvLlxuICAgKi9cbiAgYXN5bmMgZG93bmxvYWRQcm9maWxlUGljdHVyZShcbiAgICBkZXN0cGF0aDogc3RyaW5nLFxuICAgIGNhbGxiYWNrPzogUHJvZ3Jlc3NDYWxsYmFja1xuICApOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICBjb25zdCBwaWN0dXJlVVJMID0gYXdhaXQgdGhpcy5nZXRQcm9maWxlUGljdHVyZVVSTCgpO1xuICAgIGlmICghcGljdHVyZVVSTCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kb3dubG9hZEZpbGVCeUdldChwaWN0dXJlVVJMLmhyZWYsIGRlc3RwYXRoLCBjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIGFzeW5jIGdldE5hbWUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBpZiAodGhpcy5fbmFtZSkgcmV0dXJuIHRoaXMuX25hbWU7XG4gICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5nZXQoXG4gICAgICAnL3NpZ2FhL3BvcnRhaXMvZGlzY2VudGUvYmV0YS9kaXNjZW50ZS5qc2YnXG4gICAgKTtcbiAgICBpZiAocGFnZS5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHVzZXJuYW1lID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoXG4gICAgICAgIHBhZ2UuJCgnLmRldGFsaGVzLXVzdWFyaW8tbm9tZScpLmh0bWwoKVxuICAgICAgKTtcbiAgICAgIHRoaXMuX25hbWUgPSB1c2VybmFtZTtcbiAgICAgIHJldHVybiB1c2VybmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogVW5leHBlY3RlZCBzdGF0dXMgY29kZSBhdCBzdHVkZW50IHByb2ZpbGUgcGFnZS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIGFzeW5jIGdldEVtYWlscygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgaWYgKHRoaXMuX2VtYWlscykgcmV0dXJuIHRoaXMuX2VtYWlscztcbiAgICBjb25zdCBwYWdlID0gYXdhaXQgdGhpcy5odHRwLmdldChcbiAgICAgICcvc2lnYWEvcG9ydGFpcy9kaXNjZW50ZS9iZXRhL2Rpc2NlbnRlLmpzZidcbiAgICApO1xuICAgIGlmIChwYWdlLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgdGhpcy5fZW1haWxzID0gW107XG4gICAgICBjb25zdCByb3dzID0gcGFnZS4kKCcuZGV0YWxoZXMtdXN1YXJpbyB0YWJsZScpLmVxKDApLmZpbmQoJ3RyJykudG9BcnJheSgpO1xuICAgICAgZm9yIChjb25zdCByb3cgb2Ygcm93cykge1xuICAgICAgICBjb25zdCBjZWxscyA9IHBhZ2UuJChyb3cpLmZpbmQoJ3RkJyk7XG4gICAgICAgIGlmICh0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChjZWxscy5lcSgwKS5odG1sKCkpID09PSAnRS1tYWlsOicpIHtcbiAgICAgICAgICBjb25zdCBlbWFpbCA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKGNlbGxzLmVxKDEpLmh0bWwoKSk7XG4gICAgICAgICAgaWYgKGVtYWlsKSB0aGlzLl9lbWFpbHMucHVzaChlbWFpbCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9lbWFpbHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFVuZXhwZWN0ZWQgc3RhdHVzIGNvZGUgYXQgc3R1ZGVudCBwcm9maWxlIHBhZ2UuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgcGFzc3dvcmQgb2YgYWNjb3VudC5cbiAgICogQHBhcmFtIG9sZFBhc3N3b3JkIGN1cnJlbnQgcGFzc3dvcmQuXG4gICAqIEBwYXJhbSBuZXdQYXNzd29yZCBuZXcgcGFzc3dvcmQuXG4gICAqIEB0aHJvd3Mge2Vycm9ySW52YWxpZENyZWRlbnRpYWxzfSBJZiBjdXJyZW50IHBhc3N3b3JkIGlzIG5vdCBjb3JyZWN0LlxuICAgKiBAdGhyb3dzIHtlcnJvckluc3VmZmljaWVudFBhc3N3b3JkQ29tcGxleGl0eX0gSWYgdGhlIG5ldyBwYXNzd29yZCBkb2VzIG5vdCBoYXZlIHRoZSBjb21wbGV4aXR5IHJlcXVpcmVtZW50LlxuICAgKi9cbiAgYXN5bmMgY2hhbmdlUGFzc3dvcmQoXG4gICAgb2xkUGFzc3dvcmQ6IHN0cmluZyxcbiAgICBuZXdQYXNzd29yZDogc3RyaW5nXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGZvcm1QYWdlID0gYXdhaXQgdGhpcy5odHRwLmdldCgnL3NpZ2FhL2FsdGVyYXJfZGFkb3MuanNmJyk7XG4gICAgaWYgKGZvcm1QYWdlLnN0YXR1c0NvZGUgIT09IDMwMilcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFVuZXhwZWN0ZWQgc3RhdHVzIGNvZGUgYXQgY2hhbmdlIHBhc3N3b3JkIGZvcm0uJyk7XG5cbiAgICBjb25zdCBwcmVQYWdlID0gYXdhaXQgdGhpcy5odHRwLmZvbGxvd0FsbFJlZGlyZWN0KGZvcm1QYWdlKTtcbiAgICBpZiAoXG4gICAgICBwcmVQYWdlLnN0YXR1c0NvZGUgIT09IDIwMCB8fFxuICAgICAgIXByZVBhZ2UudXJsLmhyZWYuaW5jbHVkZXMoJ3VzdWFyaW8vYWx0ZXJhcl9kYWRvcy5qc2YnKVxuICAgIClcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IEludmFsaWQgcHJlIHBhZ2UgYXQgY2hhbmdlIHBhc3N3b3JkLicpO1xuXG4gICAgY29uc3QgcHJlRm9ybUVsZW1lbnQgPSBwcmVQYWdlLiQoJ2Zvcm1bbmFtZT1cImZvcm1cIl0nKTtcblxuICAgIGNvbnN0IHByZUFjdGlvbiA9IHByZUZvcm1FbGVtZW50LmF0dHIoJ2FjdGlvbicpO1xuICAgIGlmICghcHJlQWN0aW9uKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnU0lHQUE6IEZvcm0gd2l0aG91dCBhY3Rpb24gYXQgY2hhbmdlIHBhc3N3b3JkIHByZSBwYWdlLidcbiAgICAgICk7XG5cbiAgICBjb25zdCBwcmVBY3Rpb25VcmwgPSBuZXcgVVJMKHByZUFjdGlvbiwgcHJlUGFnZS51cmwuaHJlZik7XG5cbiAgICBjb25zdCBwcmVQb3N0VmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG5cbiAgICBjb25zdCBwcmVJbnB1dHMgPSBwcmVGb3JtRWxlbWVudFxuICAgICAgLmZpbmQoXCJpbnB1dFtuYW1lXTpub3QoW3R5cGU9J3N1Ym1pdCddKVwiKVxuICAgICAgLnRvQXJyYXkoKTtcbiAgICBmb3IgKGNvbnN0IGlucHV0IG9mIHByZUlucHV0cykge1xuICAgICAgY29uc3QgbmFtZSA9IHByZVBhZ2UuJChpbnB1dCkuYXR0cignbmFtZScpO1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcHJlUG9zdFZhbHVlc1tuYW1lXSA9IHByZVBhZ2UuJChpbnB1dCkudmFsKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHByZVBvc3RWYWx1ZXNbJ2Zvcm06YWx0ZXJhclNlbmhhJ10gPSAnZm9ybTphbHRlcmFyU2VuaGEnO1xuICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCB0aGlzLmh0dHAucG9zdChwcmVBY3Rpb25VcmwuaHJlZiwgcHJlUG9zdFZhbHVlcyk7XG4gICAgY29uc3QgZm9ybUVsZW1lbnQgPSBwYWdlLiQoJ2Zvcm1bbmFtZT1cImZvcm1cIl0nKTtcblxuICAgIGNvbnN0IGFjdGlvbiA9IGZvcm1FbGVtZW50LmF0dHIoJ2FjdGlvbicpO1xuICAgIGlmICghYWN0aW9uKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogRm9ybSB3aXRob3V0IGFjdGlvbiBhdCBjaGFuZ2UgcGFzc3dvcmQgcGFnZS4nKTtcbiAgICBjb25zdCBmb3JtQWN0aW9uID0gbmV3IFVSTChhY3Rpb24sIHBhZ2UudXJsLmhyZWYpO1xuXG4gICAgY29uc3QgcG9zdFZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgIGNvbnN0IGlucHV0cyA9IGZvcm1FbGVtZW50XG4gICAgICAuZmluZChcImlucHV0W25hbWVdOm5vdChbdHlwZT0nc3VibWl0J10pXCIpXG4gICAgICAudG9BcnJheSgpO1xuICAgIGZvciAoY29uc3QgaW5wdXQgb2YgaW5wdXRzKSB7XG4gICAgICBjb25zdCBuYW1lID0gcGFnZS4kKGlucHV0KS5hdHRyKCduYW1lJyk7XG4gICAgICBpZiAobmFtZSkge1xuICAgICAgICBwb3N0VmFsdWVzW25hbWVdID0gcHJlUGFnZS4kKGlucHV0KS52YWwoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwb3N0VmFsdWVzWydmb3JtOnNlbmhhQXR1YWwnXSA9IG9sZFBhc3N3b3JkO1xuICAgIHBvc3RWYWx1ZXNbJ2Zvcm06bm92YVNlbmhhJ10gPSBuZXdQYXNzd29yZDtcbiAgICBwb3N0VmFsdWVzWydmb3JtOnJlcGV0bk5vdmFTZW5oYSddID0gbmV3UGFzc3dvcmQ7XG4gICAgcG9zdFZhbHVlc1snZm9ybTphbHRlcmFyRGFkb3MnXSA9ICdBbHRlcmFyIERhZG9zJztcblxuICAgIGNvbnN0IHJlc3VsdFBhZ2UgPSBhd2FpdCB0aGlzLmh0dHAucG9zdChmb3JtQWN0aW9uLmhyZWYsIHBvc3RWYWx1ZXMpO1xuXG4gICAgaWYgKHJlc3VsdFBhZ2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICBjb25zdCBlcnJvck1zZyA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKFxuICAgICAgICByZXN1bHRQYWdlLiQoJy5lcnJvcyBsaScpLmh0bWwoKVxuICAgICAgKTtcbiAgICAgIGlmIChlcnJvck1zZy5pbmNsdWRlcygnQSBzZW5oYSBkaWdpdGFkYSDDqSBtdWl0byBzaW1wbGVzLicpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih0aGlzLmVycm9ySW5zdWZmaWNpZW50UGFzc3dvcmRDb21wbGV4aXR5KTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnJvck1zZy5pbmNsdWRlcygnU2VuaGEgQXR1YWwgZGlnaXRhZGEgbsOjbyBjb25mZXJlJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMuZXJyb3JJbnZhbGlkQ3JlZGVudGlhbHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXN1bHRQYWdlLnN0YXR1c0NvZGUgIT09IDMwMikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnU0lHQUE6IFRoZSBjaGFuZ2UgcGFzc3dvcmQgcGFnZSBzdGF0dXMgY29kZSBpcyBkaWZmZXJlbnQgdGhhbiBleHBlY3RlZC4nXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl19