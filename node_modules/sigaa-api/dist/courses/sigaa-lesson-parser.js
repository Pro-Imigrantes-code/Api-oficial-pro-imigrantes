"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SigaaLessonParser = void 0;

require("source-map-support/register");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * @category Internal
 */
class SigaaLessonParser {
  constructor(parser, resources) {
    this.parser = parser;
    this.resources = resources;

    _defineProperty(this, "forumsIdIndex", 0);
  }

  /**
   * Parse the page and retrieves the HTML elements that are the topics of the lesson
   * @param page
   */
  getElements(page) {
    return page.$('#conteudo .topico-aula').toArray();
  }

  parsePagedPage(page) {
    const lessonOptionElements = page.$('#formAva\\:escolherTopico option').toArray();
    const lessonIdsWithReferences = [];

    for (let index = 0; index < lessonOptionElements.length; index++) {
      const optionElement = page.$(lessonOptionElements[index]);
      const lessonId = optionElement.attr('value');
      if (!lessonId) throw new Error('SIGAA: cannot find the lesson id.');
      const titleFull = this.parser.removeTagsHtml(optionElement.html());
      const lessonDatesString = titleFull.slice(titleFull.indexOf('(') + 1, titleFull.indexOf(')'));
      const title = titleFull.slice(titleFull.indexOf(')') + 1).trim();
      const [startDate, endDate] = this.parserDate(lessonDatesString);
      lessonIdsWithReferences.push({
        title,
        index,
        id: lessonId,
        startDate,
        endDate
      });
    }

    return lessonIdsWithReferences;
  }

  parseLessonPages(pageLessonsList, pageLessonsPaged) {
    const lessonsElements = this.getElements(pageLessonsList);
    const lessonIdsWithReferences = this.parsePagedPage(pageLessonsPaged);
    this.resources.lessons.keepOnly(lessonsElements.map((lessonElement, index) => this.resources.lessons.upsert(this.parseLesson(pageLessonsList, lessonIdsWithReferences[index], lessonElement))._instanceIndentifier));
  }

  parserDate(lessonDatesString) {
    let startDateListPage, endDateListPage;

    try {
      const lessonDate = this.parser.parseDates(lessonDatesString, 2);
      startDateListPage = lessonDate[0];
      endDateListPage = lessonDate[1];
    } catch (err) {
      const lessonDate = this.parser.parseDates(lessonDatesString, 1);
      startDateListPage = lessonDate[0];
      endDateListPage = lessonDate[0];
    }

    return [startDateListPage, endDateListPage];
  }
  /**
   * Parse each lesson topic HTML element
   */


  parseLesson(page, lessonIdWithReference, lessonElement) {
    const titleElement = page.$(lessonElement).find('.titulo');
    const titleFull = this.parser.removeTagsHtml(titleElement.html());
    const lessonDatesString = titleFull.slice(titleFull.lastIndexOf('(') + 1, titleFull.lastIndexOf(')'));
    const [startDate, endDate] = this.parserDate(lessonDatesString);
    const title = titleFull.slice(0, titleFull.lastIndexOf('(')).trim();
    if (lessonIdWithReference.startDate.valueOf() !== startDate.valueOf() && lessonIdWithReference.endDate.valueOf() !== endDate.valueOf() && lessonIdWithReference.title != title) console.error(new Error('SIGAA: The result of the lesson list parser is different than expected because the title or date does not match.'));
    const lessonContentElement = page.$(lessonElement).find('.conteudotopico');
    const id = lessonIdWithReference.id;
    const lessonHTML = lessonContentElement.html();
    if (!lessonHTML) throw new Error('SIGAA: Lesson without content.');
    const lessonContent = this.parser.removeTagsHtml(lessonHTML.replace(/<div([\S\s]*?)div>/gm, ''));
    const attachments = this.parseAttachmentsFromLesson(page, lessonContentElement);
    const contentText = attachments.reduce((reducer, attachment) => {
      if (attachment.type === 'text') return `${reducer}\n${attachment.body}`;
      return reducer;
    }, lessonContent);
    const lesson = {
      title,
      contentText,
      startDate: startDate,
      id,
      instanceIndentifier: id,
      endDate: endDate,
      attachments: attachments.filter(attachment => attachment.type !== 'text')
    };
    return lesson;
  }
  /**
   * Receive each class topic and parse each attachment in them
   * @param page
   * @param lessonContentElement
   */


  parseAttachmentsFromLesson(page, lessonContentElement) {
    const lessonAttachments = [];
    const attachmentElements = lessonContentElement.find('span[id] > div.item').toArray();

    if (attachmentElements.length !== 0) {
      for (const attachmentElement of attachmentElements) {
        const iconElement = page.$(attachmentElement).find('img');
        const iconSrc = iconElement.attr('src');

        try {
          if (iconSrc === undefined) {
            const attachmentText = {
              type: 'text',
              body: this.parser.removeTagsHtml(page.$(attachmentElement).html())
            };
            lessonAttachments.push(attachmentText);
          } else if (iconSrc.includes('questionario.png')) {
            const quiz = this.parseAttachmentQuiz(page, attachmentElement);
            lessonAttachments.push(quiz);
          } else if (iconSrc.includes('video.png')) {
            const video = this.parseAttachmentVideo(page, attachmentElement);
            lessonAttachments.push(video);
          } else if (iconSrc.includes('tarefa.png')) {
            const homework = this.parseAttachmentHomework(page, attachmentElement);
            lessonAttachments.push(homework);
          } else if (iconSrc.includes('pesquisa.png')) {
            const survey = this.parseAttachmentSurvey(page, attachmentElement);
            lessonAttachments.push(survey);
          } else if (iconSrc.includes('conteudo.png')) {
            const webContents = this.parseAttachmentWebContent(page, attachmentElement);
            lessonAttachments.push(webContents);
          } else if (iconSrc.includes('forumava.png')) {
            const genericOptions = this.parseAttachmentGeneric(page, attachmentElement);
            const forumOptions = { ...genericOptions,
              instanceIndentifier: this.forumsIdIndex.toString()
            };
            this.forumsIdIndex++;
            const forum = this.resources.forums.upsert(forumOptions);
            lessonAttachments.push(forum);
          } else if (iconSrc.includes('portal_turma/site_add.png')) {
            const link = this.parseAttachmentLink(page, attachmentElement);
            lessonAttachments.push(link);
          } else {
            const file = this.parseAttachmentFile(page, attachmentElement);
            lessonAttachments.push(file);
          }
        } catch (error) {
          error.iconSrc = iconSrc;
          error.htmlAttachment = page.$(attachmentElement).html();
          throw error;
        }
      }
    }

    return lessonAttachments;
  }
  /**
   * Parse the file attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentFile(page, attachmentElement) {
    const fileData = this.parseAttachmentGeneric(page, attachmentElement);
    return this.resources.files.upsert(fileData);
  }
  /**
   * Parse the web content attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentWebContent(page, attachmentElement) {
    const webContentOptions = this.parseAttachmentGeneric(page, attachmentElement);
    return this.resources.webContents.upsert(webContentOptions);
  }
  /**
   * Parse a generic attachment (a link) attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentGeneric(page, attachmentElement) {
    const titleElement = page.$(attachmentElement).find('span').children().first();
    const title = this.parser.removeTagsHtml(titleElement.html());
    const titleOnClick = titleElement.attr('onclick');
    if (!titleOnClick) throw new Error('SIGAA: Attachment title without onclick event.');
    const form = page.parseJSFCLJS(titleOnClick);
    const id = form.postValues.id;
    const descriptionElement = page.$(attachmentElement).find('div.descricao-item');
    const description = this.parser.removeTagsHtml(descriptionElement.html());
    return {
      title,
      form,
      id,
      instanceIndentifier: id,
      description
    };
  }
  /**
   * Parse the survey (Enquete) attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentSurvey(page, attachmentElement) {
    const titleElement = page.$(attachmentElement).find('span > a');
    const title = this.parser.removeTagsHtml(titleElement.html());
    const titleOnClick = titleElement.attr('onclick');
    if (!titleOnClick) throw new Error('SIGAA: Survey title without onclick event.');
    const form = page.parseJSFCLJS(titleOnClick);
    const surveyOptions = {
      title,
      form,
      id: form.postValues.id,
      instanceIndentifier: form.postValues.id
    };
    return this.resources.survey.upsert(surveyOptions);
  }
  /**
   * Parse the homework attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentHomework(page, attachmentElement) {
    const titleElement = page.$(attachmentElement).find('span > a');
    const titleOnClick = titleElement.attr('onclick');
    if (!titleOnClick) throw new Error('SIGAA: Homework title without onclick event.');
    const form = page.parseJSFCLJS(titleOnClick);
    const id = form.postValues.id;
    const title = this.parser.removeTagsHtml(titleElement.html());
    const descriptionElement = page.$(attachmentElement).find('div.descricao-item');
    const description = this.parser.removeTagsHtml(descriptionElement.html());
    const dates = this.parser.parseDates(description, 2);
    const startDate = dates[0];
    const endDate = dates[1];
    const homeworkOptions = {
      id,
      title,
      instanceIndentifier: id,
      startDate,
      endDate
    };
    return this.resources.homework.upsert(homeworkOptions);
  }
  /**
   * Parse the video attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentVideo(page, attachmentElement) {
    const titleElement = page.$(attachmentElement).find('span[id] > span[id] a');
    const href = titleElement.attr('href');
    const descriptionElement = page.$(attachmentElement).find('div.descricao-item');
    const description = this.parser.removeTagsHtml(descriptionElement.html());
    let title = this.parser.removeTagsHtml(titleElement.html());
    let src;

    if (href) {
      title = title.replace(/\(Link Externo\)$/g, '');
      src = href;
    } else {
      const titleElement = page.$(attachmentElement).find('span[id] > span[id]');
      title = this.parser.removeTagsHtml(titleElement.html());
      const srcIframe = page.$(attachmentElement).find('iframe').attr('src');
      if (!srcIframe) throw new Error('SIGAA: Video iframe without url.');
      src = srcIframe;
    }

    return {
      type: 'video',
      title,
      src,
      description
    };
  }
  /**
   * Parse the external link attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentLink(page, attachmentElement) {
    const type = 'link';
    const titleElement = page.$(attachmentElement).find('span[id] > a');
    const title = this.parser.removeTagsHtml(titleElement.html());
    const href = titleElement.attr('href');
    if (!href) throw new Error('SIGAA: Link attachment does not have href.');
    const descriptionElement = page.$(attachmentElement).find('div.descricao-item');
    const description = this.parser.removeTagsHtml(descriptionElement.html());
    return {
      type,
      title,
      href,
      description
    };
  }
  /**
   * Parse the quiz (questionÃ¡rio) attached to the lesson topic
   * @param page
   * @param attachmentElement
   */


  parseAttachmentQuiz(page, attachmentElement) {
    const titleElement = page.$(attachmentElement).find('span > a');
    const title = this.parser.removeTagsHtml(titleElement.html());
    const onClick = titleElement.attr('onclick');
    if (!onClick) throw new Error('SIGAA: Quiz attachment without onclick event.');
    const form = page.parseJSFCLJS(onClick);
    const id = form.postValues.id;
    const descriptionElement = page.$(attachmentElement).find('div.descricao-item');
    const description = this.parser.removeTagsHtml(descriptionElement.html());
    const dates = this.parser.parseDates(description, 2);
    const startDate = dates[0];
    const endDate = dates[1];
    const quizOptions = {
      title,
      id,
      instanceIndentifier: id,
      startDate,
      endDate
    };
    return this.resources.quizzes.upsert(quizOptions);
  }

}

exports.SigaaLessonParser = SigaaLessonParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb3Vyc2VzL3NpZ2FhLWxlc3Nvbi1wYXJzZXIudHMiXSwibmFtZXMiOlsiU2lnYWFMZXNzb25QYXJzZXIiLCJjb25zdHJ1Y3RvciIsInBhcnNlciIsInJlc291cmNlcyIsImdldEVsZW1lbnRzIiwicGFnZSIsIiQiLCJ0b0FycmF5IiwicGFyc2VQYWdlZFBhZ2UiLCJsZXNzb25PcHRpb25FbGVtZW50cyIsImxlc3Nvbklkc1dpdGhSZWZlcmVuY2VzIiwiaW5kZXgiLCJsZW5ndGgiLCJvcHRpb25FbGVtZW50IiwibGVzc29uSWQiLCJhdHRyIiwiRXJyb3IiLCJ0aXRsZUZ1bGwiLCJyZW1vdmVUYWdzSHRtbCIsImh0bWwiLCJsZXNzb25EYXRlc1N0cmluZyIsInNsaWNlIiwiaW5kZXhPZiIsInRpdGxlIiwidHJpbSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJwYXJzZXJEYXRlIiwicHVzaCIsImlkIiwicGFyc2VMZXNzb25QYWdlcyIsInBhZ2VMZXNzb25zTGlzdCIsInBhZ2VMZXNzb25zUGFnZWQiLCJsZXNzb25zRWxlbWVudHMiLCJsZXNzb25zIiwia2VlcE9ubHkiLCJtYXAiLCJsZXNzb25FbGVtZW50IiwidXBzZXJ0IiwicGFyc2VMZXNzb24iLCJfaW5zdGFuY2VJbmRlbnRpZmllciIsInN0YXJ0RGF0ZUxpc3RQYWdlIiwiZW5kRGF0ZUxpc3RQYWdlIiwibGVzc29uRGF0ZSIsInBhcnNlRGF0ZXMiLCJlcnIiLCJsZXNzb25JZFdpdGhSZWZlcmVuY2UiLCJ0aXRsZUVsZW1lbnQiLCJmaW5kIiwibGFzdEluZGV4T2YiLCJ2YWx1ZU9mIiwiY29uc29sZSIsImVycm9yIiwibGVzc29uQ29udGVudEVsZW1lbnQiLCJsZXNzb25IVE1MIiwibGVzc29uQ29udGVudCIsInJlcGxhY2UiLCJhdHRhY2htZW50cyIsInBhcnNlQXR0YWNobWVudHNGcm9tTGVzc29uIiwiY29udGVudFRleHQiLCJyZWR1Y2UiLCJyZWR1Y2VyIiwiYXR0YWNobWVudCIsInR5cGUiLCJib2R5IiwibGVzc29uIiwiaW5zdGFuY2VJbmRlbnRpZmllciIsImZpbHRlciIsImxlc3NvbkF0dGFjaG1lbnRzIiwiYXR0YWNobWVudEVsZW1lbnRzIiwiYXR0YWNobWVudEVsZW1lbnQiLCJpY29uRWxlbWVudCIsImljb25TcmMiLCJ1bmRlZmluZWQiLCJhdHRhY2htZW50VGV4dCIsImluY2x1ZGVzIiwicXVpeiIsInBhcnNlQXR0YWNobWVudFF1aXoiLCJ2aWRlbyIsInBhcnNlQXR0YWNobWVudFZpZGVvIiwiaG9tZXdvcmsiLCJwYXJzZUF0dGFjaG1lbnRIb21ld29yayIsInN1cnZleSIsInBhcnNlQXR0YWNobWVudFN1cnZleSIsIndlYkNvbnRlbnRzIiwicGFyc2VBdHRhY2htZW50V2ViQ29udGVudCIsImdlbmVyaWNPcHRpb25zIiwicGFyc2VBdHRhY2htZW50R2VuZXJpYyIsImZvcnVtT3B0aW9ucyIsImZvcnVtc0lkSW5kZXgiLCJ0b1N0cmluZyIsImZvcnVtIiwiZm9ydW1zIiwibGluayIsInBhcnNlQXR0YWNobWVudExpbmsiLCJmaWxlIiwicGFyc2VBdHRhY2htZW50RmlsZSIsImh0bWxBdHRhY2htZW50IiwiZmlsZURhdGEiLCJmaWxlcyIsIndlYkNvbnRlbnRPcHRpb25zIiwiY2hpbGRyZW4iLCJmaXJzdCIsInRpdGxlT25DbGljayIsImZvcm0iLCJwYXJzZUpTRkNMSlMiLCJwb3N0VmFsdWVzIiwiZGVzY3JpcHRpb25FbGVtZW50IiwiZGVzY3JpcHRpb24iLCJzdXJ2ZXlPcHRpb25zIiwiZGF0ZXMiLCJob21ld29ya09wdGlvbnMiLCJocmVmIiwic3JjIiwic3JjSWZyYW1lIiwib25DbGljayIsInF1aXpPcHRpb25zIiwicXVpenplcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFpREE7QUFDQTtBQUNBO0FBQ08sTUFBTUEsaUJBQU4sQ0FBZ0Q7QUFDckRDLEVBQUFBLFdBQVcsQ0FDREMsTUFEQyxFQUVEQyxTQUZDLEVBR1Q7QUFBQSxTQUZRRCxNQUVSLEdBRlFB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LENBQXVCZ0UsV0FBdkIsRUFBb0MsQ0FBcEMsQ0FBZDtBQUNBLFVBQU1uRixTQUFTLEdBQUdxRixLQUFLLENBQUMsQ0FBRCxDQUF2QjtBQUNBLFVBQU1wRixPQUFPLEdBQUdvRixLQUFLLENBQUMsQ0FBRCxDQUFyQjtBQUVBLFVBQU1NLFdBQVcsR0FBRztBQUNsQjdGLE1BQUFBLEtBRGtCO0FBRWxCTSxNQUFBQSxFQUZrQjtBQUdsQnFDLE1BQUFBLG1CQUFtQixFQUFFckMsRUFISDtBQUlsQkosTUFBQUEsU0FKa0I7QUFLbEJDLE1BQUFBO0FBTGtCLEtBQXBCO0FBT0EsV0FBTyxLQUFLdkIsU0FBTCxDQUFla0gsT0FBZixDQUF1Qi9FLE1BQXZCLENBQThCOEUsV0FBOUIsQ0FBUDtBQUNEOztBQXpib0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlLCBTaWdhYUZvcm0gfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1wYWdlJztcbmltcG9ydCB7IExpbmtBdHRhY2htZW50IH0gZnJvbSAnQGF0dGFjaG1lbnRzL3NpZ2FhLWxpbmstc3R1ZGVudCc7XG5pbXBvcnQgeyBWaWRlb0F0dGFjaG1lbnQgfSBmcm9tICdAYXR0YWNobWVudHMvc2lnYWEtdmlkZW8tc3R1ZGVudCc7XG5pbXBvcnQgeyBQYXJzZXIgfSBmcm9tICdAaGVscGVycy9zaWdhYS1wYXJzZXInO1xuaW1wb3J0IHsgQXR0YWNobWVudCwgTGVzc29uRGF0YSB9IGZyb20gJ0Bjb3Vyc2VSZXNvdXJjZXMvc2lnYWEtbGVzc29uLXN0dWRlbnQnO1xuaW1wb3J0IHsgUXVpeiB9IGZyb20gJ0BhdHRhY2htZW50cy9zaWdhYS1xdWl6LXN0dWRlbnQnO1xuaW1wb3J0IHsgU3VydmV5IH0gZnJvbSAnQGF0dGFjaG1lbnRzL3NpZ2FhLXN1cnZleS1zdHVkZW50JztcbmltcG9ydCB7IEZvcnVtRGF0YSB9IGZyb20gJ0Bjb3Vyc2VSZXNvdXJjZXMvZm9ydW0vc2lnYWEtY291cnNlLWZvcnVtLXN0dWRlbnQnO1xuaW1wb3J0IHsgSG9tZXdvcmsgfSBmcm9tICdAYXR0YWNobWVudHMvc2lnYWEtaG9tZXdvcmstc3R1ZGVudCc7XG5cbmltcG9ydCB7IENvdXJzZVJlc291cmNlc01hbmFnZXIgfSBmcm9tICdAY291cnNlcy9zaWdhYS1jb3Vyc2UtcmVzb3VyY2VzLW1hbmFnZXInO1xuaW1wb3J0IHsgVXBkYXRhYmxlUmVzb3VyY2VEYXRhIH0gZnJvbSAnQHJlc291cmNlcy9zaWdhYS1yZXNvdXJjZS1tYW5hZ2VyJztcblxuLyoqXG4gKiBAY2F0ZWdvcnkgSW50ZXJuYWxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHZW5lcmljQXR0YWNobWVudERhdGEgZXh0ZW5kcyBVcGRhdGFibGVSZXNvdXJjZURhdGEge1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBmb3JtOiBTaWdhYUZvcm07XG4gIGlkOiBzdHJpbmc7XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IEludGVybmFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dEF0dGFjaG1lbnQge1xuICB0eXBlOiAndGV4dCc7XG4gIGJvZHk6IHN0cmluZztcbn1cblxuLyoqXG4gKiBAY2F0ZWdvcnkgSW50ZXJuYWxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMZXNzb25JZFdpdGhSZWZlcmVuY2Uge1xuICB0aXRsZTogc3RyaW5nO1xuICBpZDogc3RyaW5nO1xuICBzdGFydERhdGU6IERhdGU7XG4gIGluZGV4OiBudW1iZXI7XG4gIGVuZERhdGU6IERhdGU7XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IEludGVybmFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTGVzc29uUGFyc2VyIHtcbiAgcGFyc2VMZXNzb25QYWdlcyhwYWdlTGVzc29uc0xpc3Q6IFBhZ2UsIHBhZ2VMZXNzb25zUGFnZWQ6IFBhZ2UpOiB2b2lkO1xufVxuXG4vKipcbiAqIEBjYXRlZ29yeSBJbnRlcm5hbFxuICovXG5leHBvcnQgY2xhc3MgU2lnYWFMZXNzb25QYXJzZXIgaW1wbGVtZW50cyBMZXNzb25QYXJzZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBhcnNlcjogUGFyc2VyLFxuICAgIHByaXZhdGUgcmVzb3VyY2VzOiBDb3Vyc2VSZXNvdXJjZXNNYW5hZ2VyXG4gICkge31cblxuICBwcml2YXRlIGZvcnVtc0lkSW5kZXggPSAwO1xuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgcGFnZSBhbmQgcmV0cmlldmVzIHRoZSBIVE1MIGVsZW1lbnRzIHRoYXQgYXJlIHRoZSB0b3BpY3Mgb2YgdGhlIGxlc3NvblxuICAgKiBAcGFyYW0gcGFnZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFbGVtZW50cyhwYWdlOiBQYWdlKTogY2hlZXJpby5FbGVtZW50W10ge1xuICAgIHJldHVybiBwYWdlLiQoJyNjb250ZXVkbyAudG9waWNvLWF1bGEnKS50b0FycmF5KCk7XG4gIH1cblxuICBwYXJzZVBhZ2VkUGFnZShwYWdlOiBQYWdlKTogTGVzc29uSWRXaXRoUmVmZXJlbmNlW10ge1xuICAgIGNvbnN0IGxlc3Nvbk9wdGlvbkVsZW1lbnRzID0gcGFnZVxuICAgICAgLiQoJyNmb3JtQXZhXFxcXDplc2NvbGhlclRvcGljbyBvcHRpb24nKVxuICAgICAgLnRvQXJyYXkoKTtcblxuICAgIGNvbnN0IGxlc3Nvbklkc1dpdGhSZWZlcmVuY2VzOiBMZXNzb25JZFdpdGhSZWZlcmVuY2VbXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGxlc3Nvbk9wdGlvbkVsZW1lbnRzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3Qgb3B0aW9uRWxlbWVudCA9IHBhZ2UuJChsZXNzb25PcHRpb25FbGVtZW50c1tpbmRleF0pO1xuICAgICAgY29uc3QgbGVzc29uSWQgPSBvcHRpb25FbGVtZW50LmF0dHIoJ3ZhbHVlJyk7XG4gICAgICBpZiAoIWxlc3NvbklkKSB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBjYW5ub3QgZmluZCB0aGUgbGVzc29uIGlkLicpO1xuXG4gICAgICBjb25zdCB0aXRsZUZ1bGwgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChvcHRpb25FbGVtZW50Lmh0bWwoKSk7XG5cbiAgICAgIGNvbnN0IGxlc3NvbkRhdGVzU3RyaW5nID0gdGl0bGVGdWxsLnNsaWNlKFxuICAgICAgICB0aXRsZUZ1bGwuaW5kZXhPZignKCcpICsgMSxcbiAgICAgICAgdGl0bGVGdWxsLmluZGV4T2YoJyknKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHRpdGxlID0gdGl0bGVGdWxsLnNsaWNlKHRpdGxlRnVsbC5pbmRleE9mKCcpJykgKyAxKS50cmltKCk7XG5cbiAgICAgIGNvbnN0IFtzdGFydERhdGUsIGVuZERhdGVdID0gdGhpcy5wYXJzZXJEYXRlKGxlc3NvbkRhdGVzU3RyaW5nKTtcbiAgICAgIGxlc3Nvbklkc1dpdGhSZWZlcmVuY2VzLnB1c2goe1xuICAgICAgICB0aXRsZSxcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIGlkOiBsZXNzb25JZCxcbiAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICBlbmREYXRlXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGxlc3Nvbklkc1dpdGhSZWZlcmVuY2VzO1xuICB9XG5cbiAgcGFyc2VMZXNzb25QYWdlcyhwYWdlTGVzc29uc0xpc3Q6IFBhZ2UsIHBhZ2VMZXNzb25zUGFnZWQ6IFBhZ2UpOiB2b2lkIHtcbiAgICBjb25zdCBsZXNzb25zRWxlbWVudHMgPSB0aGlzLmdldEVsZW1lbnRzKHBhZ2VMZXNzb25zTGlzdCk7XG5cbiAgICBjb25zdCBsZXNzb25JZHNXaXRoUmVmZXJlbmNlcyA9IHRoaXMucGFyc2VQYWdlZFBhZ2UocGFnZUxlc3NvbnNQYWdlZCk7XG4gICAgdGhpcy5yZXNvdXJjZXMubGVzc29ucy5rZWVwT25seShcbiAgICAgIGxlc3NvbnNFbGVtZW50cy5tYXAoXG4gICAgICAgIChsZXNzb25FbGVtZW50LCBpbmRleCkgPT5cbiAgICAgICAgICB0aGlzLnJlc291cmNlcy5sZXNzb25zLnVwc2VydChcbiAgICAgICAgICAgIHRoaXMucGFyc2VMZXNzb24oXG4gICAgICAgICAgICAgIHBhZ2VMZXNzb25zTGlzdCxcbiAgICAgICAgICAgICAgbGVzc29uSWRzV2l0aFJlZmVyZW5jZXNbaW5kZXhdLFxuICAgICAgICAgICAgICBsZXNzb25FbGVtZW50XG4gICAgICAgICAgICApXG4gICAgICAgICAgKS5faW5zdGFuY2VJbmRlbnRpZmllclxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHBhcnNlckRhdGUobGVzc29uRGF0ZXNTdHJpbmc6IHN0cmluZyk6IFtEYXRlLCBEYXRlXSB7XG4gICAgbGV0IHN0YXJ0RGF0ZUxpc3RQYWdlLCBlbmREYXRlTGlzdFBhZ2U7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGxlc3NvbkRhdGUgPSB0aGlzLnBhcnNlci5wYXJzZURhdGVzKGxlc3NvbkRhdGVzU3RyaW5nLCAyKTtcbiAgICAgIHN0YXJ0RGF0ZUxpc3RQYWdlID0gbGVzc29uRGF0ZVswXTtcbiAgICAgIGVuZERhdGVMaXN0UGFnZSA9IGxlc3NvbkRhdGVbMV07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCBsZXNzb25EYXRlID0gdGhpcy5wYXJzZXIucGFyc2VEYXRlcyhsZXNzb25EYXRlc1N0cmluZywgMSk7XG4gICAgICBzdGFydERhdGVMaXN0UGFnZSA9IGxlc3NvbkRhdGVbMF07XG4gICAgICBlbmREYXRlTGlzdFBhZ2UgPSBsZXNzb25EYXRlWzBdO1xuICAgIH1cbiAgICByZXR1cm4gW3N0YXJ0RGF0ZUxpc3RQYWdlLCBlbmREYXRlTGlzdFBhZ2VdO1xuICB9XG4gIC8qKlxuICAgKiBQYXJzZSBlYWNoIGxlc3NvbiB0b3BpYyBIVE1MIGVsZW1lbnRcbiAgICovXG4gIHByaXZhdGUgcGFyc2VMZXNzb24oXG4gICAgcGFnZTogUGFnZSxcbiAgICBsZXNzb25JZFdpdGhSZWZlcmVuY2U6IExlc3NvbklkV2l0aFJlZmVyZW5jZSxcbiAgICBsZXNzb25FbGVtZW50OiBjaGVlcmlvLkVsZW1lbnRcbiAgKTogTGVzc29uRGF0YSB7XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gcGFnZS4kKGxlc3NvbkVsZW1lbnQpLmZpbmQoJy50aXR1bG8nKTtcbiAgICBjb25zdCB0aXRsZUZ1bGwgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbCh0aXRsZUVsZW1lbnQuaHRtbCgpKTtcblxuICAgIGNvbnN0IGxlc3NvbkRhdGVzU3RyaW5nID0gdGl0bGVGdWxsLnNsaWNlKFxuICAgICAgdGl0bGVGdWxsLmxhc3RJbmRleE9mKCcoJykgKyAxLFxuICAgICAgdGl0bGVGdWxsLmxhc3RJbmRleE9mKCcpJylcbiAgICApO1xuXG4gICAgY29uc3QgW3N0YXJ0RGF0ZSwgZW5kRGF0ZV0gPSB0aGlzLnBhcnNlckRhdGUobGVzc29uRGF0ZXNTdHJpbmcpO1xuXG4gICAgY29uc3QgdGl0bGUgPSB0aXRsZUZ1bGwuc2xpY2UoMCwgdGl0bGVGdWxsLmxhc3RJbmRleE9mKCcoJykpLnRyaW0oKTtcblxuICAgIGlmIChcbiAgICAgIGxlc3NvbklkV2l0aFJlZmVyZW5jZS5zdGFydERhdGUudmFsdWVPZigpICE9PSBzdGFydERhdGUudmFsdWVPZigpICYmXG4gICAgICBsZXNzb25JZFdpdGhSZWZlcmVuY2UuZW5kRGF0ZS52YWx1ZU9mKCkgIT09IGVuZERhdGUudmFsdWVPZigpICYmXG4gICAgICBsZXNzb25JZFdpdGhSZWZlcmVuY2UudGl0bGUgIT0gdGl0bGVcbiAgICApXG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBuZXcgRXJyb3IoXG4gICAgICAgICAgJ1NJR0FBOiBUaGUgcmVzdWx0IG9mIHRoZSBsZXNzb24gbGlzdCBwYXJzZXIgaXMgZGlmZmVyZW50IHRoYW4gZXhwZWN0ZWQgYmVjYXVzZSB0aGUgdGl0bGUgb3IgZGF0ZSBkb2VzIG5vdCBtYXRjaC4nXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICBjb25zdCBsZXNzb25Db250ZW50RWxlbWVudCA9IHBhZ2UuJChsZXNzb25FbGVtZW50KS5maW5kKCcuY29udGV1ZG90b3BpY28nKTtcblxuICAgIGNvbnN0IGlkID0gbGVzc29uSWRXaXRoUmVmZXJlbmNlLmlkO1xuXG4gICAgY29uc3QgbGVzc29uSFRNTCA9IGxlc3NvbkNvbnRlbnRFbGVtZW50Lmh0bWwoKTtcbiAgICBpZiAoIWxlc3NvbkhUTUwpIHRocm93IG5ldyBFcnJvcignU0lHQUE6IExlc3NvbiB3aXRob3V0IGNvbnRlbnQuJyk7XG5cbiAgICBjb25zdCBsZXNzb25Db250ZW50ID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwoXG4gICAgICBsZXNzb25IVE1MLnJlcGxhY2UoLzxkaXYoW1xcU1xcc10qPylkaXY+L2dtLCAnJylcbiAgICApO1xuXG4gICAgY29uc3QgYXR0YWNobWVudHMgPSB0aGlzLnBhcnNlQXR0YWNobWVudHNGcm9tTGVzc29uKFxuICAgICAgcGFnZSxcbiAgICAgIGxlc3NvbkNvbnRlbnRFbGVtZW50XG4gICAgKTtcbiAgICBjb25zdCBjb250ZW50VGV4dCA9IGF0dGFjaG1lbnRzLnJlZHVjZSgocmVkdWNlciwgYXR0YWNobWVudCkgPT4ge1xuICAgICAgaWYgKGF0dGFjaG1lbnQudHlwZSA9PT0gJ3RleHQnKSByZXR1cm4gYCR7cmVkdWNlcn1cXG4ke2F0dGFjaG1lbnQuYm9keX1gO1xuICAgICAgcmV0dXJuIHJlZHVjZXI7XG4gICAgfSwgbGVzc29uQ29udGVudCk7XG5cbiAgICBjb25zdCBsZXNzb246IExlc3NvbkRhdGEgPSB7XG4gICAgICB0aXRsZSxcbiAgICAgIGNvbnRlbnRUZXh0LFxuICAgICAgc3RhcnREYXRlOiBzdGFydERhdGUsXG4gICAgICBpZCxcbiAgICAgIGluc3RhbmNlSW5kZW50aWZpZXI6IGlkLFxuICAgICAgZW5kRGF0ZTogZW5kRGF0ZSxcbiAgICAgIGF0dGFjaG1lbnRzOiBhdHRhY2htZW50cy5maWx0ZXIoXG4gICAgICAgIChhdHRhY2htZW50KSA9PiBhdHRhY2htZW50LnR5cGUgIT09ICd0ZXh0J1xuICAgICAgKSBhcyBBdHRhY2htZW50W11cbiAgICB9O1xuXG4gICAgcmV0dXJuIGxlc3NvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNlaXZlIGVhY2ggY2xhc3MgdG9waWMgYW5kIHBhcnNlIGVhY2ggYXR0YWNobWVudCBpbiB0aGVtXG4gICAqIEBwYXJhbSBwYWdlXG4gICAqIEBwYXJhbSBsZXNzb25Db250ZW50RWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUF0dGFjaG1lbnRzRnJvbUxlc3NvbihcbiAgICBwYWdlOiBQYWdlLFxuICAgIGxlc3NvbkNvbnRlbnRFbGVtZW50OiBjaGVlcmlvLkNoZWVyaW9cbiAgKTogKEF0dGFjaG1lbnQgfCBUZXh0QXR0YWNobWVudClbXSB7XG4gICAgY29uc3QgbGVzc29uQXR0YWNobWVudHM6IChBdHRhY2htZW50IHwgVGV4dEF0dGFjaG1lbnQpW10gPSBbXTtcbiAgICBjb25zdCBhdHRhY2htZW50RWxlbWVudHMgPSBsZXNzb25Db250ZW50RWxlbWVudFxuICAgICAgLmZpbmQoJ3NwYW5baWRdID4gZGl2Lml0ZW0nKVxuICAgICAgLnRvQXJyYXkoKTtcbiAgICBpZiAoYXR0YWNobWVudEVsZW1lbnRzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgZm9yIChjb25zdCBhdHRhY2htZW50RWxlbWVudCBvZiBhdHRhY2htZW50RWxlbWVudHMpIHtcbiAgICAgICAgY29uc3QgaWNvbkVsZW1lbnQgPSBwYWdlLiQoYXR0YWNobWVudEVsZW1lbnQpLmZpbmQoJ2ltZycpO1xuICAgICAgICBjb25zdCBpY29uU3JjID0gaWNvbkVsZW1lbnQuYXR0cignc3JjJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKGljb25TcmMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudFRleHQ6IFRleHRBdHRhY2htZW50ID0ge1xuICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGJvZHk6IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKHBhZ2UuJChhdHRhY2htZW50RWxlbWVudCkuaHRtbCgpKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxlc3NvbkF0dGFjaG1lbnRzLnB1c2goYXR0YWNobWVudFRleHQpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvblNyYy5pbmNsdWRlcygncXVlc3Rpb25hcmlvLnBuZycpKSB7XG4gICAgICAgICAgICBjb25zdCBxdWl6ID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRRdWl6KHBhZ2UsIGF0dGFjaG1lbnRFbGVtZW50KTtcbiAgICAgICAgICAgIGxlc3NvbkF0dGFjaG1lbnRzLnB1c2gocXVpeik7XG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uU3JjLmluY2x1ZGVzKCd2aWRlby5wbmcnKSkge1xuICAgICAgICAgICAgY29uc3QgdmlkZW8gPSB0aGlzLnBhcnNlQXR0YWNobWVudFZpZGVvKHBhZ2UsIGF0dGFjaG1lbnRFbGVtZW50KTtcbiAgICAgICAgICAgIGxlc3NvbkF0dGFjaG1lbnRzLnB1c2godmlkZW8pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvblNyYy5pbmNsdWRlcygndGFyZWZhLnBuZycpKSB7XG4gICAgICAgICAgICBjb25zdCBob21ld29yayA9IHRoaXMucGFyc2VBdHRhY2htZW50SG9tZXdvcmsoXG4gICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRFbGVtZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbGVzc29uQXR0YWNobWVudHMucHVzaChob21ld29yayk7XG4gICAgICAgICAgfSBlbHNlIGlmIChpY29uU3JjLmluY2x1ZGVzKCdwZXNxdWlzYS5wbmcnKSkge1xuICAgICAgICAgICAgY29uc3Qgc3VydmV5ID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRTdXJ2ZXkocGFnZSwgYXR0YWNobWVudEVsZW1lbnQpO1xuICAgICAgICAgICAgbGVzc29uQXR0YWNobWVudHMucHVzaChzdXJ2ZXkpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvblNyYy5pbmNsdWRlcygnY29udGV1ZG8ucG5nJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHdlYkNvbnRlbnRzID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRXZWJDb250ZW50KFxuICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICBhdHRhY2htZW50RWxlbWVudFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGxlc3NvbkF0dGFjaG1lbnRzLnB1c2god2ViQ29udGVudHMpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWNvblNyYy5pbmNsdWRlcygnZm9ydW1hdmEucG5nJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyaWNPcHRpb25zID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRHZW5lcmljKFxuICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICBhdHRhY2htZW50RWxlbWVudFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGZvcnVtT3B0aW9uczogRm9ydW1EYXRhID0ge1xuICAgICAgICAgICAgICAuLi5nZW5lcmljT3B0aW9ucyxcbiAgICAgICAgICAgICAgaW5zdGFuY2VJbmRlbnRpZmllcjogdGhpcy5mb3J1bXNJZEluZGV4LnRvU3RyaW5nKClcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuZm9ydW1zSWRJbmRleCsrO1xuICAgICAgICAgICAgY29uc3QgZm9ydW0gPSB0aGlzLnJlc291cmNlcy5mb3J1bXMudXBzZXJ0KGZvcnVtT3B0aW9ucyk7XG4gICAgICAgICAgICBsZXNzb25BdHRhY2htZW50cy5wdXNoKGZvcnVtKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGljb25TcmMuaW5jbHVkZXMoJ3BvcnRhbF90dXJtYS9zaXRlX2FkZC5wbmcnKSkge1xuICAgICAgICAgICAgY29uc3QgbGluayA9IHRoaXMucGFyc2VBdHRhY2htZW50TGluayhwYWdlLCBhdHRhY2htZW50RWxlbWVudCk7XG4gICAgICAgICAgICBsZXNzb25BdHRhY2htZW50cy5wdXNoKGxpbmspO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRGaWxlKHBhZ2UsIGF0dGFjaG1lbnRFbGVtZW50KTtcbiAgICAgICAgICAgIGxlc3NvbkF0dGFjaG1lbnRzLnB1c2goZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGVycm9yLmljb25TcmMgPSBpY29uU3JjO1xuICAgICAgICAgIGVycm9yLmh0bWxBdHRhY2htZW50ID0gcGFnZS4kKGF0dGFjaG1lbnRFbGVtZW50KS5odG1sKCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxlc3NvbkF0dGFjaG1lbnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSBmaWxlIGF0dGFjaGVkIHRvIHRoZSBsZXNzb24gdG9waWNcbiAgICogQHBhcmFtIHBhZ2VcbiAgICogQHBhcmFtIGF0dGFjaG1lbnRFbGVtZW50XG4gICAqL1xuICBwcml2YXRlIHBhcnNlQXR0YWNobWVudEZpbGUocGFnZTogUGFnZSwgYXR0YWNobWVudEVsZW1lbnQ6IGNoZWVyaW8uRWxlbWVudCkge1xuICAgIGNvbnN0IGZpbGVEYXRhID0gdGhpcy5wYXJzZUF0dGFjaG1lbnRHZW5lcmljKHBhZ2UsIGF0dGFjaG1lbnRFbGVtZW50KTtcbiAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXMuZmlsZXMudXBzZXJ0KGZpbGVEYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgd2ViIGNvbnRlbnQgYXR0YWNoZWQgdG8gdGhlIGxlc3NvbiB0b3BpY1xuICAgKiBAcGFyYW0gcGFnZVxuICAgKiBAcGFyYW0gYXR0YWNobWVudEVsZW1lbnRcbiAgICovXG4gIHByaXZhdGUgcGFyc2VBdHRhY2htZW50V2ViQ29udGVudChcbiAgICBwYWdlOiBQYWdlLFxuICAgIGF0dGFjaG1lbnRFbGVtZW50OiBjaGVlcmlvLkVsZW1lbnRcbiAgKSB7XG4gICAgY29uc3Qgd2ViQ29udGVudE9wdGlvbnMgPSB0aGlzLnBhcnNlQXR0YWNobWVudEdlbmVyaWMoXG4gICAgICBwYWdlLFxuICAgICAgYXR0YWNobWVudEVsZW1lbnRcbiAgICApO1xuICAgIHJldHVybiB0aGlzLnJlc291cmNlcy53ZWJDb250ZW50cy51cHNlcnQod2ViQ29udGVudE9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIGEgZ2VuZXJpYyBhdHRhY2htZW50IChhIGxpbmspIGF0dGFjaGVkIHRvIHRoZSBsZXNzb24gdG9waWNcbiAgICogQHBhcmFtIHBhZ2VcbiAgICogQHBhcmFtIGF0dGFjaG1lbnRFbGVtZW50XG4gICAqL1xuICBwcml2YXRlIHBhcnNlQXR0YWNobWVudEdlbmVyaWMoXG4gICAgcGFnZTogUGFnZSxcbiAgICBhdHRhY2htZW50RWxlbWVudDogY2hlZXJpby5FbGVtZW50XG4gICk6IEdlbmVyaWNBdHRhY2htZW50RGF0YSB7XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gcGFnZVxuICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAuZmluZCgnc3BhbicpXG4gICAgICAuY2hpbGRyZW4oKVxuICAgICAgLmZpcnN0KCk7XG4gICAgY29uc3QgdGl0bGUgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbCh0aXRsZUVsZW1lbnQuaHRtbCgpKTtcbiAgICBjb25zdCB0aXRsZU9uQ2xpY2sgPSB0aXRsZUVsZW1lbnQuYXR0cignb25jbGljaycpO1xuICAgIGlmICghdGl0bGVPbkNsaWNrKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogQXR0YWNobWVudCB0aXRsZSB3aXRob3V0IG9uY2xpY2sgZXZlbnQuJyk7XG4gICAgY29uc3QgZm9ybSA9IHBhZ2UucGFyc2VKU0ZDTEpTKHRpdGxlT25DbGljayk7XG4gICAgY29uc3QgaWQgPSBmb3JtLnBvc3RWYWx1ZXMuaWQ7XG4gICAgY29uc3QgZGVzY3JpcHRpb25FbGVtZW50ID0gcGFnZVxuICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAuZmluZCgnZGl2LmRlc2NyaWNhby1pdGVtJyk7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChkZXNjcmlwdGlvbkVsZW1lbnQuaHRtbCgpKTtcbiAgICByZXR1cm4ge1xuICAgICAgdGl0bGUsXG4gICAgICBmb3JtLFxuICAgICAgaWQsXG4gICAgICBpbnN0YW5jZUluZGVudGlmaWVyOiBpZCxcbiAgICAgIGRlc2NyaXB0aW9uXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgc3VydmV5IChFbnF1ZXRlKSBhdHRhY2hlZCB0byB0aGUgbGVzc29uIHRvcGljXG4gICAqIEBwYXJhbSBwYWdlXG4gICAqIEBwYXJhbSBhdHRhY2htZW50RWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUF0dGFjaG1lbnRTdXJ2ZXkoXG4gICAgcGFnZTogUGFnZSxcbiAgICBhdHRhY2htZW50RWxlbWVudDogY2hlZXJpby5FbGVtZW50XG4gICk6IFN1cnZleSB7XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gcGFnZS4kKGF0dGFjaG1lbnRFbGVtZW50KS5maW5kKCdzcGFuID4gYScpO1xuICAgIGNvbnN0IHRpdGxlID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwodGl0bGVFbGVtZW50Lmh0bWwoKSk7XG4gICAgY29uc3QgdGl0bGVPbkNsaWNrID0gdGl0bGVFbGVtZW50LmF0dHIoJ29uY2xpY2snKTtcbiAgICBpZiAoIXRpdGxlT25DbGljaylcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFN1cnZleSB0aXRsZSB3aXRob3V0IG9uY2xpY2sgZXZlbnQuJyk7XG4gICAgY29uc3QgZm9ybSA9IHBhZ2UucGFyc2VKU0ZDTEpTKHRpdGxlT25DbGljayk7XG4gICAgY29uc3Qgc3VydmV5T3B0aW9ucyA9IHtcbiAgICAgIHRpdGxlLFxuICAgICAgZm9ybSxcbiAgICAgIGlkOiBmb3JtLnBvc3RWYWx1ZXMuaWQsXG4gICAgICBpbnN0YW5jZUluZGVudGlmaWVyOiBmb3JtLnBvc3RWYWx1ZXMuaWRcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLnJlc291cmNlcy5zdXJ2ZXkudXBzZXJ0KHN1cnZleU9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSBob21ld29yayBhdHRhY2hlZCB0byB0aGUgbGVzc29uIHRvcGljXG4gICAqIEBwYXJhbSBwYWdlXG4gICAqIEBwYXJhbSBhdHRhY2htZW50RWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUF0dGFjaG1lbnRIb21ld29yayhcbiAgICBwYWdlOiBQYWdlLFxuICAgIGF0dGFjaG1lbnRFbGVtZW50OiBjaGVlcmlvLkVsZW1lbnRcbiAgKTogSG9tZXdvcmsge1xuICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IHBhZ2UuJChhdHRhY2htZW50RWxlbWVudCkuZmluZCgnc3BhbiA+IGEnKTtcbiAgICBjb25zdCB0aXRsZU9uQ2xpY2sgPSB0aXRsZUVsZW1lbnQuYXR0cignb25jbGljaycpO1xuICAgIGlmICghdGl0bGVPbkNsaWNrKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogSG9tZXdvcmsgdGl0bGUgd2l0aG91dCBvbmNsaWNrIGV2ZW50LicpO1xuICAgIGNvbnN0IGZvcm0gPSBwYWdlLnBhcnNlSlNGQ0xKUyh0aXRsZU9uQ2xpY2spO1xuICAgIGNvbnN0IGlkID0gZm9ybS5wb3N0VmFsdWVzLmlkO1xuICAgIGNvbnN0IHRpdGxlID0gdGhpcy5wYXJzZXIucmVtb3ZlVGFnc0h0bWwodGl0bGVFbGVtZW50Lmh0bWwoKSk7XG4gICAgY29uc3QgZGVzY3JpcHRpb25FbGVtZW50ID0gcGFnZVxuICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAuZmluZCgnZGl2LmRlc2NyaWNhby1pdGVtJyk7XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbChkZXNjcmlwdGlvbkVsZW1lbnQuaHRtbCgpKTtcbiAgICBjb25zdCBkYXRlcyA9IHRoaXMucGFyc2VyLnBhcnNlRGF0ZXMoZGVzY3JpcHRpb24sIDIpO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IGRhdGVzWzBdO1xuICAgIGNvbnN0IGVuZERhdGUgPSBkYXRlc1sxXTtcbiAgICBjb25zdCBob21ld29ya09wdGlvbnMgPSB7XG4gICAgICBpZCxcbiAgICAgIHRpdGxlLFxuICAgICAgaW5zdGFuY2VJbmRlbnRpZmllcjogaWQsXG4gICAgICBzdGFydERhdGUsXG4gICAgICBlbmREYXRlXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLnJlc291cmNlcy5ob21ld29yay51cHNlcnQoaG9tZXdvcmtPcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgdmlkZW8gYXR0YWNoZWQgdG8gdGhlIGxlc3NvbiB0b3BpY1xuICAgKiBAcGFyYW0gcGFnZVxuICAgKiBAcGFyYW0gYXR0YWNobWVudEVsZW1lbnRcbiAgICovXG4gIHByaXZhdGUgcGFyc2VBdHRhY2htZW50VmlkZW8oXG4gICAgcGFnZTogUGFnZSxcbiAgICBhdHRhY2htZW50RWxlbWVudDogY2hlZXJpby5FbGVtZW50XG4gICk6IFZpZGVvQXR0YWNobWVudCB7XG4gICAgY29uc3QgdGl0bGVFbGVtZW50ID0gcGFnZVxuICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAuZmluZCgnc3BhbltpZF0gPiBzcGFuW2lkXSBhJyk7XG4gICAgY29uc3QgaHJlZiA9IHRpdGxlRWxlbWVudC5hdHRyKCdocmVmJyk7XG4gICAgY29uc3QgZGVzY3JpcHRpb25FbGVtZW50ID0gcGFnZVxuICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAuZmluZCgnZGl2LmRlc2NyaWNhby1pdGVtJyk7XG5cbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKGRlc2NyaXB0aW9uRWxlbWVudC5odG1sKCkpO1xuICAgIGxldCB0aXRsZSA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKHRpdGxlRWxlbWVudC5odG1sKCkpO1xuICAgIGxldCBzcmM6IHN0cmluZztcbiAgICBpZiAoaHJlZikge1xuICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKC9cXChMaW5rIEV4dGVybm9cXCkkL2csICcnKTtcbiAgICAgIHNyYyA9IGhyZWY7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IHBhZ2VcbiAgICAgICAgLiQoYXR0YWNobWVudEVsZW1lbnQpXG4gICAgICAgIC5maW5kKCdzcGFuW2lkXSA+IHNwYW5baWRdJyk7XG4gICAgICB0aXRsZSA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKHRpdGxlRWxlbWVudC5odG1sKCkpO1xuICAgICAgY29uc3Qgc3JjSWZyYW1lID0gcGFnZS4kKGF0dGFjaG1lbnRFbGVtZW50KS5maW5kKCdpZnJhbWUnKS5hdHRyKCdzcmMnKTtcbiAgICAgIGlmICghc3JjSWZyYW1lKSB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBWaWRlbyBpZnJhbWUgd2l0aG91dCB1cmwuJyk7XG4gICAgICBzcmMgPSBzcmNJZnJhbWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICd2aWRlbycsXG4gICAgICB0aXRsZSxcbiAgICAgIHNyYyxcbiAgICAgIGRlc2NyaXB0aW9uXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSB0aGUgZXh0ZXJuYWwgbGluayBhdHRhY2hlZCB0byB0aGUgbGVzc29uIHRvcGljXG4gICAqIEBwYXJhbSBwYWdlXG4gICAqIEBwYXJhbSBhdHRhY2htZW50RWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUF0dGFjaG1lbnRMaW5rKFxuICAgIHBhZ2U6IFBhZ2UsXG4gICAgYXR0YWNobWVudEVsZW1lbnQ6IGNoZWVyaW8uRWxlbWVudFxuICApOiBMaW5rQXR0YWNobWVudCB7XG4gICAgY29uc3QgdHlwZSA9ICdsaW5rJztcblxuICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IHBhZ2UuJChhdHRhY2htZW50RWxlbWVudCkuZmluZCgnc3BhbltpZF0gPiBhJyk7XG4gICAgY29uc3QgdGl0bGUgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbCh0aXRsZUVsZW1lbnQuaHRtbCgpKTtcbiAgICBjb25zdCBocmVmID0gdGl0bGVFbGVtZW50LmF0dHIoJ2hyZWYnKTtcbiAgICBpZiAoIWhyZWYpIHRocm93IG5ldyBFcnJvcignU0lHQUE6IExpbmsgYXR0YWNobWVudCBkb2VzIG5vdCBoYXZlIGhyZWYuJyk7XG5cbiAgICBjb25zdCBkZXNjcmlwdGlvbkVsZW1lbnQgPSBwYWdlXG4gICAgICAuJChhdHRhY2htZW50RWxlbWVudClcbiAgICAgIC5maW5kKCdkaXYuZGVzY3JpY2FvLWl0ZW0nKTtcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKGRlc2NyaXB0aW9uRWxlbWVudC5odG1sKCkpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlLFxuICAgICAgdGl0bGUsXG4gICAgICBocmVmLFxuICAgICAgZGVzY3JpcHRpb25cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHRoZSBxdWl6IChxdWVzdGlvbsOhcmlvKSBhdHRhY2hlZCB0byB0aGUgbGVzc29uIHRvcGljXG4gICAqIEBwYXJhbSBwYWdlXG4gICAqIEBwYXJhbSBhdHRhY2htZW50RWxlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBwYXJzZUF0dGFjaG1lbnRRdWl6KFxuICAgIHBhZ2U6IFBhZ2UsXG4gICAgYXR0YWNobWVudEVsZW1lbnQ6IGNoZWVyaW8uRWxlbWVudFxuICApOiBRdWl6IHtcbiAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBwYWdlLiQoYXR0YWNobWVudEVsZW1lbnQpLmZpbmQoJ3NwYW4gPiBhJyk7XG4gICAgY29uc3QgdGl0bGUgPSB0aGlzLnBhcnNlci5yZW1vdmVUYWdzSHRtbCh0aXRsZUVsZW1lbnQuaHRtbCgpKTtcbiAgICBjb25zdCBvbkNsaWNrID0gdGl0bGVFbGVtZW50LmF0dHIoJ29uY2xpY2snKTtcblxuICAgIGlmICghb25DbGljaylcbiAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFF1aXogYXR0YWNobWVudCB3aXRob3V0IG9uY2xpY2sgZXZlbnQuJyk7XG5cbiAgICBjb25zdCBmb3JtID0gcGFnZS5wYXJzZUpTRkNMSlMob25DbGljayk7XG4gICAgY29uc3QgaWQgPSBmb3JtLnBvc3RWYWx1ZXMuaWQ7XG4gICAgY29uc3QgZGVzY3JpcHRpb25FbGVtZW50ID0gcGFnZVxuXG4gICAgICAuJChhdHRhY2htZW50RWxlbWVudClcbiAgICAgIC5maW5kKCdkaXYuZGVzY3JpY2FvLWl0ZW0nKTtcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IHRoaXMucGFyc2VyLnJlbW92ZVRhZ3NIdG1sKGRlc2NyaXB0aW9uRWxlbWVudC5odG1sKCkpO1xuICAgIGNvbnN0IGRhdGVzID0gdGhpcy5wYXJzZXIucGFyc2VEYXRlcyhkZXNjcmlwdGlvbiwgMik7XG4gICAgY29uc3Qgc3RhcnREYXRlID0gZGF0ZXNbMF07XG4gICAgY29uc3QgZW5kRGF0ZSA9IGRhdGVzWzFdO1xuXG4gICAgY29uc3QgcXVpek9wdGlvbnMgPSB7XG4gICAgICB0aXRsZSxcbiAgICAgIGlkLFxuICAgICAgaW5zdGFuY2VJbmRlbnRpZmllcjogaWQsXG4gICAgICBzdGFydERhdGUsXG4gICAgICBlbmREYXRlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXMucXVpenplcy51cHNlcnQocXVpek9wdGlvbnMpO1xuICB9XG59XG4iXX0=