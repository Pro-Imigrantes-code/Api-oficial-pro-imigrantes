"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SigaaQuiz = void 0;

require("source-map-support/register");

var _updatableResource = require("../../../resources/updatable-resource");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * @category Internal
 */
class SigaaQuiz extends _updatableResource.AbstractUpdatableResource {
  constructor(http, options, updater) {
    super(options.instanceIndentifier, updater);
    this.http = http;

    _defineProperty(this, "type", 'quiz');

    _defineProperty(this, "errorDeadlineToReadClosed", 'SIGAA: Deadline to read as answer closed.');

    _defineProperty(this, "errorQuizYetNoSendAnswers", 'Sigaa: Quiz yet no sent answers.');

    _defineProperty(this, "_formViewAnswersSubmitted", void 0);

    _defineProperty(this, "_formSendAnswers", void 0);

    _defineProperty(this, "_startDate", void 0);

    _defineProperty(this, "_endDate", void 0);

    _defineProperty(this, "_title", void 0);

    _defineProperty(this, "_id", void 0);

    this.update(options);
  }

  update(options) {
    this._title = options.title;
    this._id = options.id;
    this._startDate = options.startDate;
    this._endDate = options.endDate;
    this._formSendAnswers = options.formSendAnswers;
    this._formViewAnswersSubmitted = options.formViewAnswersSubmitted;
    this.isClosed = false;
  }

  get title() {
    this.checkIfItWasClosed();
    return this._title;
  }

  get id() {
    this.checkIfItWasClosed();
    return this._id;
  }

  get endDate() {
    this.checkIfItWasClosed();
    return this._endDate;
  }

  get startDate() {
    this.checkIfItWasClosed();
    return this._startDate;
  }
  /**
   * TODO
   * @param retry
   */


  async getAnswersSubmitted(retry = true) {
    try {
      if (this._formViewAnswersSubmitted === undefined) throw new Error('SIGAA: Quiz form is undefined.');
      const page = await this.http.post(this._formViewAnswersSubmitted.action.href, this._formViewAnswersSubmitted.postValues);

      switch (page.statusCode) {
        case 200:
          if (page.bodyDecoded.includes('Acabou o prazo para visualizar as respostas.')) throw new Error(this.errorDeadlineToReadClosed);
          if (page.bodyDecoded.includes('Você ainda não enviou respostas para este questionário')) throw new Error(this.errorQuizYetNoSendAnswers);
          break;

        case 302:
          throw new Error('SIGAA: Quiz expired.');

        default:
          throw new Error('SIGAA: Quiz page status code unexpected.');
      }
    } catch (err) {
      if (err.message === this.errorDeadlineToReadClosed || err.message === this.errorQuizYetNoSendAnswers) {
        throw err;
      }

      if (retry) {
        await this.updateInstance();
        this.getAnswersSubmitted(false);
      } else {
        throw err;
      }
    }
  }

}

exports.SigaaQuiz = SigaaQuiz;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb3Vyc2VzL3Jlc291cmNlcy9hdHRhY2htZW50cy9zaWdhYS1xdWl6LXN0dWRlbnQudHMiXSwibmFtZXMiOlsiU2lnYWFRdWl6IiwiQWJzdHJhY3RVcGRhdGFibGVSZXNvdXJjZSIsImNvbnN0cnVjdG9yIiwiaHR0cCIsIm9wdGlvbnMiLCJ1cGRhdGVyIiwiaW5zdGFuY2VJbmRlbnRpZmllciIsInVwZGF0ZSIsIl90aXRsZSIsInRpdGxlIiwiX2lkIiwiaWQiLCJfc3RhcnREYXRlIiwic3RhcnREYXRlIiwiX2VuZERhdGUiLCJlbmREYXRlIiwiX2Zvcm1TZW5kQW5zd2VycyIsImZvcm1TZW5kQW5zd2VycyIsIl9mb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQiLCJmb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQiLCJpc0Nsb3NlZCIsImNoZWNrSWZJdFdhc0Nsb3NlZCIsImdldEFuc3dlcnNTdWJtaXR0ZWQiLCJyZXRyeSIsInVuZGVmaW5lZCIsIkVycm9yIiwicGFnZSIsInBvc3QiLCJhY3Rpb24iLCJocmVmIiwicG9zdFZhbHVlcyIsInN0YXR1c0NvZGUiLCJib2R5RGVjb2RlZCIsImluY2x1ZGVzIiwiZXJyb3JEZWFkbGluZVRvUmVhZENsb3NlZCIsImVycm9yUXVpellldE5vU2VuZEFuc3dlcnMiLCJlcnIiLCJtZXNzYWdlIiwidXBkYXRlSW5zdGFuY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBOzs7O0FBb0NBO0FBQ0E7QUFDQTtBQUNPLE1BQU1BLFNBQU4sU0FBd0JDLDRDQUF4QixDQUFrRTtBQWN2RUMsRUFBQUEsV0FBVyxDQUNEQyxJQURDLEVBRVRDLE9BRlMsRUFHVEMsT0FIUyxFQUlUO0FBQ0EsVUFBTUQsT0FBTyxDQUFDRSxtQkFBZCxFQUFtQ0QsT0FBbkM7QUFEQSxTQUhRRixJQUdSLEdBSFFBLElBR1I7O0FBQUEsa0NBakJjLE1BaUJkOztBQUFBLHVEQWRBLDJDQWNBOztBQUFBLHVEQWJtQyxrQ0FhbkM7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7O0FBRUEsU0FBS0ksTUFBTCxDQUFZSCxPQUFaO0FBQ0Q7O0FBRURHLEVBQUFBLE1BQU0sQ0FBQ0gsT0FBRCxFQUEwQjtBQUM5QixTQUFLSSxNQUFMLEdBQWNKLE9BQU8sQ0FBQ0ssS0FBdEI7QUFDQSxTQUFLQyxHQUFMLEdBQVdOLE9BQU8sQ0FBQ08sRUFBbkI7QUFDQSxTQUFLQyxVQUFMLEdBQWtCUixPQUFPLENBQUNTLFNBQTFCO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQlYsT0FBTyxDQUFDVyxPQUF4QjtBQUNBLFNBQUtDLGdCQUFMLEdBQXdCWixPQUFPLENBQUNhLGVBQWhDO0FBQ0EsU0FBS0MseUJBQUwsR0FBaUNkLE9BQU8sQ0FBQ2Usd0JBQXpDO0FBRUEsU0FBS0MsUUFBTCxHQUFnQixLQUFoQjtBQUNEOztBQUVRLE1BQUxYLEtBQUssR0FBVztBQUNsQixTQUFLWSxrQkFBTDtBQUNBLFdBQU8sS0FBS2IsTUFBWjtBQUNEOztBQUVLLE1BQUZHLEVBQUUsR0FBVztBQUNmLFNBQUtVLGtCQUFMO0FBQ0EsV0FBTyxLQUFLWCxHQUFaO0FBQ0Q7O0FBRVUsTUFBUEssT0FBTyxHQUFTO0FBQ2xCLFNBQUtNLGtCQUFMO0FBQ0EsV0FBTyxLQUFLUCxRQUFaO0FBQ0Q7O0FBRVksTUFBVEQsU0FBUyxHQUFTO0FBQ3BCLFNBQUtRLGtCQUFMO0FBQ0EsV0FBTyxLQUFLVCxVQUFaO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7QUFDQTs7O0FBQzJCLFFBQW5CVSxtQkFBbUIsQ0FBQ0MsS0FBSyxHQUFHLElBQVQsRUFBOEI7QUFDckQsUUFBSTtBQUNGLFVBQUksS0FBS0wseUJBQUwsS0FBbUNNLFNBQXZDLEVBQ0UsTUFBTSxJQUFJQyxLQUFKLENBQVUsZ0NBQVYsQ0FBTjtBQUVGLFlBQU1DLElBQUksR0FBRyxNQUFNLEtBQUt2QixJQUFMLENBQVV3QixJQUFWLENBQ2pCLEtBQUtULHlCQUFMLENBQStCVSxNQUEvQixDQUFzQ0MsSUFEckIsRUFFakIsS0FBS1gseUJBQUwsQ0FBK0JZLFVBRmQsQ0FBbkI7O0FBS0EsY0FBUUosSUFBSSxDQUFDSyxVQUFiO0FBQ0UsYUFBSyxHQUFMO0FBQ0UsY0FDRUwsSUFBSSxDQUFDTSxXQUFMLENBQWlCQyxRQUFqQixDQUNFLDhDQURGLENBREYsRUFLRSxNQUFNLElBQUlSLEtBQUosQ0FBVSxLQUFLUyx5QkFBZixDQUFOO0FBQ0YsY0FDRVIsSUFBSSxDQUFDTSxXQUFMLENBQWlCQyxRQUFqQixDQUNFLHdEQURGLENBREYsRUFLRSxNQUFNLElBQUlSLEtBQUosQ0FBVSxLQUFLVSx5QkFBZixDQUFOO0FBQ0Y7O0FBQ0YsYUFBSyxHQUFMO0FBQ0UsZ0JBQU0sSUFBSVYsS0FBSixDQUFVLHNCQUFWLENBQU47O0FBQ0Y7QUFDRSxnQkFBTSxJQUFJQSxLQUFKLENBQVUsMENBQVYsQ0FBTjtBQWxCSjtBQW9CRCxLQTdCRCxDQTZCRSxPQUFPVyxHQUFQLEVBQVk7QUFDWixVQUNFQSxHQUFHLENBQUNDLE9BQUosS0FBZ0IsS0FBS0gseUJBQXJCLElBQ0FFLEdBQUcsQ0FBQ0MsT0FBSixLQUFnQixLQUFLRix5QkFGdkIsRUFHRTtBQUNBLGNBQU1DLEdBQU47QUFDRDs7QUFDRCxVQUFJYixLQUFKLEVBQVc7QUFDVCxjQUFNLEtBQUtlLGNBQUwsRUFBTjtBQUNBLGFBQUtoQixtQkFBTCxDQUF5QixLQUF6QjtBQUNELE9BSEQsTUFHTztBQUNMLGNBQU1jLEdBQU47QUFDRDtBQUNGO0FBQ0Y7O0FBdEdzRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVwZGF0YWJsZVJlc291cmNlRGF0YSB9IGZyb20gJ0ByZXNvdXJjZXMvc2lnYWEtcmVzb3VyY2UtbWFuYWdlcic7XG5pbXBvcnQge1xuICBBYnN0cmFjdFVwZGF0YWJsZVJlc291cmNlLFxuICBVcGRhdGFibGVSZXNvdXJjZSxcbiAgVXBkYXRhYmxlUmVzb3VyY2VDYWxsYmFja1xufSBmcm9tICdAcmVzb3VyY2VzL3VwZGF0YWJsZS1yZXNvdXJjZSc7XG5pbXBvcnQgeyBIVFRQIH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtaHR0cCc7XG5pbXBvcnQgeyBTaWdhYUZvcm0gfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1wYWdlJztcblxuLyoqXG4gKiBAY2F0ZWdvcnkgSW50ZXJuYWxcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBRdWl6RGF0YSBleHRlbmRzIFVwZGF0YWJsZVJlc291cmNlRGF0YSB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGlkOiBzdHJpbmc7XG4gIHN0YXJ0RGF0ZTogRGF0ZTtcbiAgZW5kRGF0ZTogRGF0ZTtcbiAgZm9ybVNlbmRBbnN3ZXJzPzogU2lnYWFGb3JtO1xuICBmb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQ/OiBTaWdhYUZvcm07XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IFB1YmxpY1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFF1aXogZXh0ZW5kcyBVcGRhdGFibGVSZXNvdXJjZTxRdWl6RGF0YT4ge1xuICByZWFkb25seSB0aXRsZTogc3RyaW5nO1xuICByZWFkb25seSB0eXBlOiAncXVpeic7XG4gIHJlYWRvbmx5IGVuZERhdGU6IERhdGU7XG4gIHJlYWRvbmx5IHN0YXJ0RGF0ZTogRGF0ZTtcbiAgcmVhZG9ubHkgaWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRPRE9cbiAgICogQHBhcmFtIHJldHJ5XG4gICAqL1xuICBnZXRBbnN3ZXJzU3VibWl0dGVkKCk6IFByb21pc2U8dm9pZD47XG59XG5cbi8qKlxuICogQGNhdGVnb3J5IEludGVybmFsXG4gKi9cbmV4cG9ydCBjbGFzcyBTaWdhYVF1aXogZXh0ZW5kcyBBYnN0cmFjdFVwZGF0YWJsZVJlc291cmNlIGltcGxlbWVudHMgUXVpeiB7XG4gIHJlYWRvbmx5IHR5cGUgPSAncXVpeic7XG5cbiAgcmVhZG9ubHkgZXJyb3JEZWFkbGluZVRvUmVhZENsb3NlZCA9XG4gICAgJ1NJR0FBOiBEZWFkbGluZSB0byByZWFkIGFzIGFuc3dlciBjbG9zZWQuJztcbiAgcmVhZG9ubHkgZXJyb3JRdWl6WWV0Tm9TZW5kQW5zd2VycyA9ICdTaWdhYTogUXVpeiB5ZXQgbm8gc2VudCBhbnN3ZXJzLic7XG5cbiAgcHJpdmF0ZSBfZm9ybVZpZXdBbnN3ZXJzU3VibWl0dGVkPzogU2lnYWFGb3JtO1xuICBwcml2YXRlIF9mb3JtU2VuZEFuc3dlcnM/OiBTaWdhYUZvcm07XG4gIHByaXZhdGUgX3N0YXJ0RGF0ZSE6IERhdGU7XG4gIHByaXZhdGUgX2VuZERhdGUhOiBEYXRlO1xuICBwcml2YXRlIF90aXRsZSE6IHN0cmluZztcbiAgcHJpdmF0ZSBfaWQhOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBodHRwOiBIVFRQLFxuICAgIG9wdGlvbnM6IFF1aXpEYXRhLFxuICAgIHVwZGF0ZXI6IFVwZGF0YWJsZVJlc291cmNlQ2FsbGJhY2tcbiAgKSB7XG4gICAgc3VwZXIob3B0aW9ucy5pbnN0YW5jZUluZGVudGlmaWVyLCB1cGRhdGVyKTtcbiAgICB0aGlzLnVwZGF0ZShvcHRpb25zKTtcbiAgfVxuXG4gIHVwZGF0ZShvcHRpb25zOiBRdWl6RGF0YSk6IHZvaWQge1xuICAgIHRoaXMuX3RpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICB0aGlzLl9pZCA9IG9wdGlvbnMuaWQ7XG4gICAgdGhpcy5fc3RhcnREYXRlID0gb3B0aW9ucy5zdGFydERhdGU7XG4gICAgdGhpcy5fZW5kRGF0ZSA9IG9wdGlvbnMuZW5kRGF0ZTtcbiAgICB0aGlzLl9mb3JtU2VuZEFuc3dlcnMgPSBvcHRpb25zLmZvcm1TZW5kQW5zd2VycztcbiAgICB0aGlzLl9mb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQgPSBvcHRpb25zLmZvcm1WaWV3QW5zd2Vyc1N1Ym1pdHRlZDtcblxuICAgIHRoaXMuaXNDbG9zZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGdldCB0aXRsZSgpOiBzdHJpbmcge1xuICAgIHRoaXMuY2hlY2tJZkl0V2FzQ2xvc2VkKCk7XG4gICAgcmV0dXJuIHRoaXMuX3RpdGxlO1xuICB9XG5cbiAgZ2V0IGlkKCk6IHN0cmluZyB7XG4gICAgdGhpcy5jaGVja0lmSXRXYXNDbG9zZWQoKTtcbiAgICByZXR1cm4gdGhpcy5faWQ7XG4gIH1cblxuICBnZXQgZW5kRGF0ZSgpOiBEYXRlIHtcbiAgICB0aGlzLmNoZWNrSWZJdFdhc0Nsb3NlZCgpO1xuICAgIHJldHVybiB0aGlzLl9lbmREYXRlO1xuICB9XG5cbiAgZ2V0IHN0YXJ0RGF0ZSgpOiBEYXRlIHtcbiAgICB0aGlzLmNoZWNrSWZJdFdhc0Nsb3NlZCgpO1xuICAgIHJldHVybiB0aGlzLl9zdGFydERhdGU7XG4gIH1cblxuICAvKipcbiAgICogVE9ET1xuICAgKiBAcGFyYW0gcmV0cnlcbiAgICovXG4gIGFzeW5jIGdldEFuc3dlcnNTdWJtaXR0ZWQocmV0cnkgPSB0cnVlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLl9mb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogUXVpeiBmb3JtIGlzIHVuZGVmaW5lZC4nKTtcblxuICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuaHR0cC5wb3N0KFxuICAgICAgICB0aGlzLl9mb3JtVmlld0Fuc3dlcnNTdWJtaXR0ZWQuYWN0aW9uLmhyZWYsXG4gICAgICAgIHRoaXMuX2Zvcm1WaWV3QW5zd2Vyc1N1Ym1pdHRlZC5wb3N0VmFsdWVzXG4gICAgICApO1xuXG4gICAgICBzd2l0Y2ggKHBhZ2Uuc3RhdHVzQ29kZSkge1xuICAgICAgICBjYXNlIDIwMDpcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwYWdlLmJvZHlEZWNvZGVkLmluY2x1ZGVzKFxuICAgICAgICAgICAgICAnQWNhYm91IG8gcHJhem8gcGFyYSB2aXN1YWxpemFyIGFzIHJlc3Bvc3Rhcy4nXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMuZXJyb3JEZWFkbGluZVRvUmVhZENsb3NlZCk7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgcGFnZS5ib2R5RGVjb2RlZC5pbmNsdWRlcyhcbiAgICAgICAgICAgICAgJ1ZvY8OqIGFpbmRhIG7Do28gZW52aW91IHJlc3Bvc3RhcyBwYXJhIGVzdGUgcXVlc3Rpb27DoXJpbydcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodGhpcy5lcnJvclF1aXpZZXROb1NlbmRBbnN3ZXJzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzMDI6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogUXVpeiBleHBpcmVkLicpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU0lHQUE6IFF1aXogcGFnZSBzdGF0dXMgY29kZSB1bmV4cGVjdGVkLicpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKFxuICAgICAgICBlcnIubWVzc2FnZSA9PT0gdGhpcy5lcnJvckRlYWRsaW5lVG9SZWFkQ2xvc2VkIHx8XG4gICAgICAgIGVyci5tZXNzYWdlID09PSB0aGlzLmVycm9yUXVpellldE5vU2VuZEFuc3dlcnNcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBpZiAocmV0cnkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVJbnN0YW5jZSgpO1xuICAgICAgICB0aGlzLmdldEFuc3dlcnNTdWJtaXR0ZWQoZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19