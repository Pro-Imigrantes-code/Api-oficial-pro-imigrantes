"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SigaaParser = void 0;

require("source-map-support/register");

var _he = require("he");

/**
 * @category Internal
 */
class SigaaParser {
  toFullYear(year) {
    if (year.length !== 2) return year;
    const parsedYear = parseInt(year, 10);
    const now = new Date();
    const currentYear = now.getFullYear();
    const currentCentury = Math.trunc(currentYear / 100);

    if (currentYear + 10 > parsedYear) {
      return (parsedYear + currentCentury * 100).toString();
    }

    return (parsedYear + (currentCentury - 1) * 100).toString();
  }
  /**
   * @inheritdoc
   */


  createDateFromString(dataString, timeString = '00:00', year) {
    const dateSplited = dataString.match(/[0-9]+/g);
    const timeSplited = timeString.match(/[0-9]+/g);

    if (timeSplited && timeSplited.length >= 2 && dateSplited && dateSplited.length >= 2) {
      const dateYear = dateSplited[2] ? this.toFullYear(dateSplited[2]) : year || new Date().getFullYear();
      const month = dateSplited[1];
      const day = dateSplited[0];
      const hour = ('0' + timeSplited[0]).substr(-2);
      const minutes = ('0' + timeSplited[1]).substr(-2);
      const seconds = timeSplited[2] ? ('0' + timeSplited[2]).substr(-2) : '00';
      const date = new Date(`${dateYear}-${month}-${day}T${hour}:${minutes}:${seconds}.000`);
      if (isNaN(date.valueOf())) throw new Error('SIGAA: Invalid date.');
      return date;
    }

    throw new Error('SIGAA: Invalid date string.');
  }
  /**
   * Parse all dates in dateString in format dd/mm/yy, dd/mm/yy hh:mm, dd/mm/yy hh'h'mm
   * @param dateString String to parse
   * @return {Date[]} Dates found in string
   */


  parseDates(dateString, numberOfDates, year) {
    const dateStrings = dateString.match(/[\d]{2}\/[\d]{2}(\/[\d]{2}([\d]{2})?)?|[\d][\d]?[\s]*?([:h]|horas)[\s]*?[\d]{2}([\s]*?(:|min|mim)([\s]*?)[\d]{2})?/g) || [];
    const dates = [];
    let currentDate;

    for (let i = 0; i < dateStrings.length; i++) {
      if (dateStrings[i].includes('/')) {
        currentDate = dateStrings[i];

        if (dateStrings[i + 1] && (dateStrings[i + 1].includes(':') || dateStrings[i + 1].includes('h'))) {
          dates.push(this.createDateFromString(dateStrings[i], dateStrings[i + 1], year));
          i++;
          continue;
        } else {
          dates.push(this.createDateFromString(dateStrings[i], undefined, year));
          continue;
        }
      }

      if (currentDate && (dateStrings[i].includes(':') || dateStrings[i].includes('h'))) {
        dates.push(this.createDateFromString(currentDate, dateStrings[i], year));
      }
    }

    if (numberOfDates != dates.length) throw new Error('SIGAA: Number of dates is different than expected.');
    return dates;
  }
  /**
   * @inheritdoc
   */


  removeTagsHtml(html) {
    if (!html) return '';

    try {
      const removeTags = [{
        pattern: ['span', 'em', 'b', 'i', 'strong'],
        // remove without add space
        replacement: ''
      }];
      const replacesBeforeParseHTMLCharacters = [{
        pattern: /\n|\xA0|\t/g,
        // match tabs, break lines, etc
        replacement: ' '
      }, {
        pattern: /&middot;/g,
        // replace middle dot with \n and middle dot
        replacement: '\n&middot;'
      }, {
        pattern: /<\/li>|<\/p>|<br\/>|<br>|<br \/>/gm,
        //tags to replace with \n
        replacement: '\n'
      }];
      const replacesAfterParseHTMLCharacters = [{
        pattern: new RegExp(String.fromCharCode(160), 'g'),
        // replace NBSP with space
        replacement: ' '
      }, {
        pattern: / + /gm,
        //removes multiple whitespaces
        replacement: ' '
      }, {
        pattern: /^(\s)*|(\s)*$/g,
        //remove whitespace from beginning and end of text
        replacement: ''
      }, {
        pattern: /^([ \t])*|([ \t])*$/gm,
        //remove whitespace from beginning and end line by line
        replacement: ''
      }];
      let newText = html;

      for (const replace of removeTags) {
        for (const tag of replace.pattern) {
          newText = newText.replace(new RegExp(`<${tag}>|<${tag} [\\s\\S]*?>|</${tag}>`, 'g'), replace.replacement);
        }
      }

      for (const replace of replacesBeforeParseHTMLCharacters) {
        newText = newText.replace(replace.pattern, replace.replacement);
      }

      const tagRegex = /<script([\S\s]*?)>([\S\s]*?)<\/script>|<!--([\S\s]*?)-->|<style([\S\s]*?)style>|<[^>]+>|\t/gm;

      while (tagRegex.test(newText)) {
        newText = newText.replace(tagRegex, ' ');
      }

      newText = (0, _he.decode)(newText);

      for (const replace of replacesAfterParseHTMLCharacters) {
        newText = newText.replace(replace.pattern, replace.replacement);
      }

      const spaces = (newText.match(/\n+/g) || []).filter((item, index, array) => array.indexOf(item) == index).sort().filter((item, index) => item.length !== index + 1).reverse();

      for (let i = 0; i < spaces.length; i++) {
        const currentSpaces = spaces[i];
        const newSpacesCount = spaces.length - i;
        let newSpaces = '';

        for (let count = 0; count < newSpacesCount; count++) {
          newSpaces += '\n';
        }

        const regExCurrentSpaces = new RegExp(currentSpaces, 'g');
        newText = newText.replace(regExCurrentSpaces, newSpaces);
      }

      return newText.trim();
    } catch (err) {
      return '';
    }
  }
  /**
   * Fix encoding characters and clears text by removing all HTML tags except strong, em, b and i
   */


  removeTagsHtmlKeepingEmphasis(text) {
    if (!text) return '';

    try {
      const keepTags = ['b', 'i', 'strong', 'em', 'li', 'ul', 'ol'];
      let newText = text;

      for (const tag of keepTags) {
        const openTagReg = new RegExp(`<\\b${tag}\\b[\\s\\S]*?>+?`, 'g');
        const closeTagReg = new RegExp(`<\\/\\b${tag}\\b[\\s\\S]*?>+?`, 'g');
        newText = newText.replace(openTagReg, `&lt;${tag}&gt;`);
        newText = newText.replace(closeTagReg, `&lt;/${tag}&gt;`);
      }

      return this.removeTagsHtml(newText);
    } catch (err) {
      return '';
    }
  }

}

exports.SigaaParser = SigaaParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL3NpZ2FhLXBhcnNlci50cyJdLCJuYW1lcyI6WyJTaWdhYVBhcnNlciIsInRvRnVsbFllYXIiLCJ5ZWFyIiwibGVuZ3RoIiwicGFyc2VkWWVhciIsInBhcnNlSW50Iiwibm93IiwiRGF0ZSIsImN1cnJlbnRZZWFyIiwiZ2V0RnVsbFllYXIiLCJjdXJyZW50Q2VudHVyeSIsIk1hdGgiLCJ0cnVuYyIsInRvU3RyaW5nIiwiY3JlYXRlRGF0ZUZyb21TdHJpbmciLCJkYXRhU3RyaW5nIiwidGltZVN0cmluZyIsImRhdGVTcGxpdGVkIiwibWF0Y2giLCJ0aW1lU3BsaXRlZCIsImRhdGVZZWFyIiwibW9udGgiLCJkYXkiLCJob3VyIiwic3Vic3RyIiwibWludXRlcyIsInNlY29uZHMiLCJkYXRlIiwiaXNOYU4iLCJ2YWx1ZU9mIiwiRXJyb3IiLCJwYXJzZURhdGVzIiwiZGF0ZVN0cmluZyIsIm51bWJlck9mRGF0ZXMiLCJkYXRlU3RyaW5ncyIsImRhdGVzIiwiY3VycmVudERhdGUiLCJpIiwiaW5jbHVkZXMiLCJwdXNoIiwidW5kZWZpbmVkIiwicmVtb3ZlVGFnc0h0bWwiLCJodG1sIiwicmVtb3ZlVGFncyIsInBhdHRlcm4iLCJyZXBsYWNlbWVudCIsInJlcGxhY2VzQmVmb3JlUGFyc2VIVE1MQ2hhcmFjdGVycyIsInJlcGxhY2VzQWZ0ZXJQYXJzZUhUTUxDaGFyYWN0ZXJzIiwiUmVnRXhwIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwibmV3VGV4dCIsInJlcGxhY2UiLCJ0YWciLCJ0YWdSZWdleCIsInRlc3QiLCJzcGFjZXMiLCJmaWx0ZXIiLCJpdGVtIiwiaW5kZXgiLCJhcnJheSIsImluZGV4T2YiLCJzb3J0IiwicmV2ZXJzZSIsImN1cnJlbnRTcGFjZXMiLCJuZXdTcGFjZXNDb3VudCIsIm5ld1NwYWNlcyIsImNvdW50IiwicmVnRXhDdXJyZW50U3BhY2VzIiwidHJpbSIsImVyciIsInJlbW92ZVRhZ3NIdG1sS2VlcGluZ0Vt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QUFZO0FBQ1osYUFBTyxFQUFQO0FBQ0Q7QUFDRjtBQUVEO0FBQ0Y7QUFDQTs7O0FBQ0VDLEVBQUFBLDZCQUE2QixDQUFDQyxJQUFELEVBQStCO0FBQzFELFFBQUksQ0FBQ0EsSUFBTCxFQUFXLE9BQU8sRUFBUDs7QUFDWCxRQUFJO0FBQ0YsWUFBTUMsUUFBUSxHQUFHLENBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxRQUFYLEVBQXFCLElBQXJCLEVBQTJCLElBQTNCLEVBQWlDLElBQWpDLEVBQXVDLElBQXZDLENBQWpCO0FBQ0EsVUFBSXRCLE9BQU8sR0FBR3FCLElBQWQ7O0FBQ0EsV0FBSyxNQUFNbkIsR0FBWCxJQUFrQm9CLFFBQWxCLEVBQTRCO0FBQzFCLGNBQU1DLFVBQVUsR0FBRyxJQUFJMUIsTUFBSixDQUFZLE9BQU1LLEdBQUksa0JBQXRCLEVBQXlDLEdBQXpDLENBQW5CO0FBQ0EsY0FBTXNCLFdBQVcsR0FBRyxJQUFJM0IsTUFBSixDQUFZLFVBQVNLLEdBQUksa0JBQXpCLEVBQTRDLEdBQTVDLENBQXBCO0FBQ0FGLFFBQUFBLE9BQU8sR0FBR0EsT0FBTyxDQUFDQyxPQUFSLENBQWdCc0IsVUFBaEIsRUFBNkIsT0FBTXJCLEdBQUksTUFBdkMsQ0FBVjtBQUNBRixRQUFBQSxPQUFPLEdBQUdBLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQnVCLFdBQWhCLEVBQThCLFFBQU90QixHQUFJLE1BQXpDLENBQVY7QUFDRDs7QUFDRCxhQUFPLEtBQUtaLGNBQUwsQ0FBb0JVLE9BQXBCLENBQVA7QUFDRCxLQVZELENBVUUsT0FBT21CLEdBQVAsRUFBWTtBQUNaLGFBQU8sRUFBUDtBQUNEO0FBQ0Y7O0FBMU13QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlY29kZSBhcyBodG1sRW50aXRpZXNEZWNvZGUgfSBmcm9tICdoZSc7XG5cbi8qKlxuICogVGV4dCBzYW5pdGl6ZXIgYW5kIGRhdGUgcGFyc2VyLlxuICogQGNhdGVnb3J5IEludGVybmFsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGFyc2VyIHtcbiAgLyoqXG4gICAqIFJldHVybiBhbGwgZGF0ZXMgaW4gc3RyaW5nc1xuICAgKi9cbiAgcGFyc2VEYXRlcyhzdHJpbmc6IHN0cmluZywgbnVtYmVyT2ZEYXRlczogbnVtYmVyLCB5ZWFyPzogbnVtYmVyKTogRGF0ZVtdO1xuICAvKipcbiAgICogUmVtb3ZlICpBTEwqIGh0bWwgdGFnc1xuICAgKiBDbGVhcnMgdGV4dCBieSByZW1vdmluZyBhbGwgSFRNTCB0YWdzIGFuZCBmaXggZW5jb2RpbmcgY2hhcmFjdGVyc1xuICAgKi9cbiAgcmVtb3ZlVGFnc0h0bWwoaHRtbD86IHN0cmluZyB8IG51bGwpOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEtlZXAgdGFncyBzYWZlIG9ubHlcbiAgICovXG4gIHJlbW92ZVRhZ3NIdG1sS2VlcGluZ0VtcGhhc2lzKGh0bWw/OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEBjYXRlZ29yeSBJbnRlcm5hbFxuICovXG5leHBvcnQgY2xhc3MgU2lnYWFQYXJzZXIgaW1wbGVtZW50cyBQYXJzZXIge1xuICBwcml2YXRlIHRvRnVsbFllYXIoeWVhcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoeWVhci5sZW5ndGggIT09IDIpIHJldHVybiB5ZWFyO1xuICAgIGNvbnN0IHBhcnNlZFllYXIgPSBwYXJzZUludCh5ZWFyLCAxMCk7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBjdXJyZW50WWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgIGNvbnN0IGN1cnJlbnRDZW50dXJ5ID0gTWF0aC50cnVuYyhjdXJyZW50WWVhciAvIDEwMCk7XG4gICAgaWYgKGN1cnJlbnRZZWFyICsgMTAgPiBwYXJzZWRZZWFyKSB7XG4gICAgICByZXR1cm4gKHBhcnNlZFllYXIgKyBjdXJyZW50Q2VudHVyeSAqIDEwMCkudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIChwYXJzZWRZZWFyICsgKGN1cnJlbnRDZW50dXJ5IC0gMSkgKiAxMDApLnRvU3RyaW5nKCk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRGF0ZUZyb21TdHJpbmcoXG4gICAgZGF0YVN0cmluZzogc3RyaW5nLFxuICAgIHRpbWVTdHJpbmcgPSAnMDA6MDAnLFxuICAgIHllYXI/OiBudW1iZXJcbiAgKTogRGF0ZSB7XG4gICAgY29uc3QgZGF0ZVNwbGl0ZWQgPSBkYXRhU3RyaW5nLm1hdGNoKC9bMC05XSsvZyk7XG4gICAgY29uc3QgdGltZVNwbGl0ZWQgPSB0aW1lU3RyaW5nLm1hdGNoKC9bMC05XSsvZyk7XG4gICAgaWYgKFxuICAgICAgdGltZVNwbGl0ZWQgJiZcbiAgICAgIHRpbWVTcGxpdGVkLmxlbmd0aCA+PSAyICYmXG4gICAgICBkYXRlU3BsaXRlZCAmJlxuICAgICAgZGF0ZVNwbGl0ZWQubGVuZ3RoID49IDJcbiAgICApIHtcbiAgICAgIGNvbnN0IGRhdGVZZWFyID0gZGF0ZVNwbGl0ZWRbMl1cbiAgICAgICAgPyB0aGlzLnRvRnVsbFllYXIoZGF0ZVNwbGl0ZWRbMl0pXG4gICAgICAgIDogeWVhciB8fCBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XG4gICAgICBjb25zdCBtb250aCA9IGRhdGVTcGxpdGVkWzFdO1xuICAgICAgY29uc3QgZGF5ID0gZGF0ZVNwbGl0ZWRbMF07XG4gICAgICBjb25zdCBob3VyID0gKCcwJyArIHRpbWVTcGxpdGVkWzBdKS5zdWJzdHIoLTIpO1xuICAgICAgY29uc3QgbWludXRlcyA9ICgnMCcgKyB0aW1lU3BsaXRlZFsxXSkuc3Vic3RyKC0yKTtcbiAgICAgIGNvbnN0IHNlY29uZHMgPSB0aW1lU3BsaXRlZFsyXSA/ICgnMCcgKyB0aW1lU3BsaXRlZFsyXSkuc3Vic3RyKC0yKSA6ICcwMCc7XG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoXG4gICAgICAgIGAke2RhdGVZZWFyfS0ke21vbnRofS0ke2RheX1UJHtob3VyfToke21pbnV0ZXN9OiR7c2Vjb25kc30uMDAwYFxuICAgICAgKTtcbiAgICAgIGlmIChpc05hTihkYXRlLnZhbHVlT2YoKSkpIHRocm93IG5ldyBFcnJvcignU0lHQUE6IEludmFsaWQgZGF0ZS4nKTtcbiAgICAgIHJldHVybiBkYXRlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1NJR0FBOiBJbnZhbGlkIGRhdGUgc3RyaW5nLicpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIGFsbCBkYXRlcyBpbiBkYXRlU3RyaW5nIGluIGZvcm1hdCBkZC9tbS95eSwgZGQvbW0veXkgaGg6bW0sIGRkL21tL3l5IGhoJ2gnbW1cbiAgICogQHBhcmFtIGRhdGVTdHJpbmcgU3RyaW5nIHRvIHBhcnNlXG4gICAqIEByZXR1cm4ge0RhdGVbXX0gRGF0ZXMgZm91bmQgaW4gc3RyaW5nXG4gICAqL1xuICBwYXJzZURhdGVzKGRhdGVTdHJpbmc6IHN0cmluZywgbnVtYmVyT2ZEYXRlczogbnVtYmVyLCB5ZWFyPzogbnVtYmVyKTogRGF0ZVtdIHtcbiAgICBjb25zdCBkYXRlU3RyaW5ncyA9XG4gICAgICBkYXRlU3RyaW5nLm1hdGNoKFxuICAgICAgICAvW1xcZF17Mn1cXC9bXFxkXXsyfShcXC9bXFxkXXsyfShbXFxkXXsyfSk/KT98W1xcZF1bXFxkXT9bXFxzXSo/KFs6aF18aG9yYXMpW1xcc10qP1tcXGRdezJ9KFtcXHNdKj8oOnxtaW58bWltKShbXFxzXSo/KVtcXGRdezJ9KT8vZ1xuICAgICAgKSB8fCBbXTtcbiAgICBjb25zdCBkYXRlczogRGF0ZVtdID0gW107XG4gICAgbGV0IGN1cnJlbnREYXRlO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0ZVN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChkYXRlU3RyaW5nc1tpXS5pbmNsdWRlcygnLycpKSB7XG4gICAgICAgIGN1cnJlbnREYXRlID0gZGF0ZVN0cmluZ3NbaV07XG4gICAgICAgIGlmIChcbiAgICAgICAgICBkYXRlU3RyaW5nc1tpICsgMV0gJiZcbiAgICAgICAgICAoZGF0ZVN0cmluZ3NbaSArIDFdLmluY2x1ZGVzKCc6JykgfHwgZGF0ZVN0cmluZ3NbaSArIDFdLmluY2x1ZGVzKCdoJykpXG4gICAgICAgICkge1xuICAgICAgICAgIGRhdGVzLnB1c2goXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZURhdGVGcm9tU3RyaW5nKGRhdGVTdHJpbmdzW2ldLCBkYXRlU3RyaW5nc1tpICsgMV0sIHllYXIpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpKys7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0ZXMucHVzaChcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlRGF0ZUZyb21TdHJpbmcoZGF0ZVN0cmluZ3NbaV0sIHVuZGVmaW5lZCwgeWVhcilcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIGN1cnJlbnREYXRlICYmXG4gICAgICAgIChkYXRlU3RyaW5nc1tpXS5pbmNsdWRlcygnOicpIHx8IGRhdGVTdHJpbmdzW2ldLmluY2x1ZGVzKCdoJykpXG4gICAgICApIHtcbiAgICAgICAgZGF0ZXMucHVzaChcbiAgICAgICAgICB0aGlzLmNyZWF0ZURhdGVGcm9tU3RyaW5nKGN1cnJlbnREYXRlLCBkYXRlU3RyaW5nc1tpXSwgeWVhcilcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG51bWJlck9mRGF0ZXMgIT0gZGF0ZXMubGVuZ3RoKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogTnVtYmVyIG9mIGRhdGVzIGlzIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkLicpO1xuXG4gICAgcmV0dXJuIGRhdGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICByZW1vdmVUYWdzSHRtbChodG1sPzogc3RyaW5nIHwgbnVsbCk6IHN0cmluZyB7XG4gICAgaWYgKCFodG1sKSByZXR1cm4gJyc7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlbW92ZVRhZ3MgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBwYXR0ZXJuOiBbJ3NwYW4nLCAnZW0nLCAnYicsICdpJywgJ3N0cm9uZyddLCAvLyByZW1vdmUgd2l0aG91dCBhZGQgc3BhY2VcbiAgICAgICAgICByZXBsYWNlbWVudDogJydcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIGNvbnN0IHJlcGxhY2VzQmVmb3JlUGFyc2VIVE1MQ2hhcmFjdGVycyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IC9cXG58XFx4QTB8XFx0L2csIC8vIG1hdGNoIHRhYnMsIGJyZWFrIGxpbmVzLCBldGNcbiAgICAgICAgICByZXBsYWNlbWVudDogJyAnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXR0ZXJuOiAvJm1pZGRvdDsvZywgLy8gcmVwbGFjZSBtaWRkbGUgZG90IHdpdGggXFxuIGFuZCBtaWRkbGUgZG90XG4gICAgICAgICAgcmVwbGFjZW1lbnQ6ICdcXG4mbWlkZG90OydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IC88XFwvbGk+fDxcXC9wPnw8YnJcXC8+fDxicj58PGJyIFxcLz4vZ20sIC8vdGFncyB0byByZXBsYWNlIHdpdGggXFxuXG4gICAgICAgICAgcmVwbGFjZW1lbnQ6ICdcXG4nXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICBjb25zdCByZXBsYWNlc0FmdGVyUGFyc2VIVE1MQ2hhcmFjdGVycyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IG5ldyBSZWdFeHAoU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApLCAnZycpLCAvLyByZXBsYWNlIE5CU1Agd2l0aCBzcGFjZVxuICAgICAgICAgIHJlcGxhY2VtZW50OiAnICdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IC8gKyAvZ20sIC8vcmVtb3ZlcyBtdWx0aXBsZSB3aGl0ZXNwYWNlc1xuICAgICAgICAgIHJlcGxhY2VtZW50OiAnICdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IC9eKFxccykqfChcXHMpKiQvZywgLy9yZW1vdmUgd2hpdGVzcGFjZSBmcm9tIGJlZ2lubmluZyBhbmQgZW5kIG9mIHRleHRcbiAgICAgICAgICByZXBsYWNlbWVudDogJydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHBhdHRlcm46IC9eKFsgXFx0XSkqfChbIFxcdF0pKiQvZ20sIC8vcmVtb3ZlIHdoaXRlc3BhY2UgZnJvbSBiZWdpbm5pbmcgYW5kIGVuZCBsaW5lIGJ5IGxpbmVcbiAgICAgICAgICByZXBsYWNlbWVudDogJydcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgbGV0IG5ld1RleHQgPSBodG1sO1xuICAgICAgZm9yIChjb25zdCByZXBsYWNlIG9mIHJlbW92ZVRhZ3MpIHtcbiAgICAgICAgZm9yIChjb25zdCB0YWcgb2YgcmVwbGFjZS5wYXR0ZXJuKSB7XG4gICAgICAgICAgbmV3VGV4dCA9IG5ld1RleHQucmVwbGFjZShcbiAgICAgICAgICAgIG5ldyBSZWdFeHAoYDwke3RhZ30+fDwke3RhZ30gW1xcXFxzXFxcXFNdKj8+fDwvJHt0YWd9PmAsICdnJyksXG4gICAgICAgICAgICByZXBsYWNlLnJlcGxhY2VtZW50XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChjb25zdCByZXBsYWNlIG9mIHJlcGxhY2VzQmVmb3JlUGFyc2VIVE1MQ2hhcmFjdGVycykge1xuICAgICAgICBuZXdUZXh0ID0gbmV3VGV4dC5yZXBsYWNlKHJlcGxhY2UucGF0dGVybiwgcmVwbGFjZS5yZXBsYWNlbWVudCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRhZ1JlZ2V4ID1cbiAgICAgICAgLzxzY3JpcHQoW1xcU1xcc10qPyk+KFtcXFNcXHNdKj8pPFxcL3NjcmlwdD58PCEtLShbXFxTXFxzXSo/KS0tPnw8c3R5bGUoW1xcU1xcc10qPylzdHlsZT58PFtePl0rPnxcXHQvZ207XG4gICAgICB3aGlsZSAodGFnUmVnZXgudGVzdChuZXdUZXh0KSkge1xuICAgICAgICBuZXdUZXh0ID0gbmV3VGV4dC5yZXBsYWNlKHRhZ1JlZ2V4LCAnICcpO1xuICAgICAgfVxuXG4gICAgICBuZXdUZXh0ID0gaHRtbEVudGl0aWVzRGVjb2RlKG5ld1RleHQpO1xuXG4gICAgICBmb3IgKGNvbnN0IHJlcGxhY2Ugb2YgcmVwbGFjZXNBZnRlclBhcnNlSFRNTENoYXJhY3RlcnMpIHtcbiAgICAgICAgbmV3VGV4dCA9IG5ld1RleHQucmVwbGFjZShyZXBsYWNlLnBhdHRlcm4sIHJlcGxhY2UucmVwbGFjZW1lbnQpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3BhY2VzID0gKG5ld1RleHQubWF0Y2goL1xcbisvZykgfHwgW10pXG4gICAgICAgIC5maWx0ZXIoKGl0ZW0sIGluZGV4LCBhcnJheSkgPT4gYXJyYXkuaW5kZXhPZihpdGVtKSA9PSBpbmRleClcbiAgICAgICAgLnNvcnQoKVxuICAgICAgICAuZmlsdGVyKChpdGVtLCBpbmRleCkgPT4gaXRlbS5sZW5ndGggIT09IGluZGV4ICsgMSlcbiAgICAgICAgLnJldmVyc2UoKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcGFjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgY3VycmVudFNwYWNlcyA9IHNwYWNlc1tpXTtcbiAgICAgICAgY29uc3QgbmV3U3BhY2VzQ291bnQgPSBzcGFjZXMubGVuZ3RoIC0gaTtcbiAgICAgICAgbGV0IG5ld1NwYWNlcyA9ICcnO1xuICAgICAgICBmb3IgKGxldCBjb3VudCA9IDA7IGNvdW50IDwgbmV3U3BhY2VzQ291bnQ7IGNvdW50KyspIHtcbiAgICAgICAgICBuZXdTcGFjZXMgKz0gJ1xcbic7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVnRXhDdXJyZW50U3BhY2VzID0gbmV3IFJlZ0V4cChjdXJyZW50U3BhY2VzLCAnZycpO1xuICAgICAgICBuZXdUZXh0ID0gbmV3VGV4dC5yZXBsYWNlKHJlZ0V4Q3VycmVudFNwYWNlcywgbmV3U3BhY2VzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ld1RleHQudHJpbSgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaXggZW5jb2RpbmcgY2hhcmFjdGVycyBhbmQgY2xlYXJzIHRleHQgYnkgcmVtb3ZpbmcgYWxsIEhUTUwgdGFncyBleGNlcHQgc3Ryb25nLCBlbSwgYiBhbmQgaVxuICAgKi9cbiAgcmVtb3ZlVGFnc0h0bWxLZWVwaW5nRW1waGFzaXModGV4dD86IHN0cmluZyB8IG51bGwpOiBzdHJpbmcge1xuICAgIGlmICghdGV4dCkgcmV0dXJuICcnO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZWVwVGFncyA9IFsnYicsICdpJywgJ3N0cm9uZycsICdlbScsICdsaScsICd1bCcsICdvbCddO1xuICAgICAgbGV0IG5ld1RleHQgPSB0ZXh0O1xuICAgICAgZm9yIChjb25zdCB0YWcgb2Yga2VlcFRhZ3MpIHtcbiAgICAgICAgY29uc3Qgb3BlblRhZ1JlZyA9IG5ldyBSZWdFeHAoYDxcXFxcYiR7dGFnfVxcXFxiW1xcXFxzXFxcXFNdKj8+Kz9gLCAnZycpO1xuICAgICAgICBjb25zdCBjbG9zZVRhZ1JlZyA9IG5ldyBSZWdFeHAoYDxcXFxcL1xcXFxiJHt0YWd9XFxcXGJbXFxcXHNcXFxcU10qPz4rP2AsICdnJyk7XG4gICAgICAgIG5ld1RleHQgPSBuZXdUZXh0LnJlcGxhY2Uob3BlblRhZ1JlZywgYCZsdDske3RhZ30mZ3Q7YCk7XG4gICAgICAgIG5ld1RleHQgPSBuZXdUZXh0LnJlcGxhY2UoY2xvc2VUYWdSZWcsIGAmbHQ7LyR7dGFnfSZndDtgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZVRhZ3NIdG1sKG5ld1RleHQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfVxufVxuIl19