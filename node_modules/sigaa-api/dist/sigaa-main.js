"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Sigaa = void 0;

require("source-map-support/register");

var _sigaaBondFactory = require("./bonds/sigaa-bond-factory");

var _sigaaParser = require("./helpers/sigaa-parser");

var _sigaaFile = require("./resources/sigaa-file");

var _sigaaSearch = require("./search/sigaa-search");

var _sigaaHttpSession = require("./session/sigaa-http-session");

var _sigaaHttpFactory = require("./session/sigaa-http-factory");

var _sigaaLoginIfsc = require("./session/login/sigaa-login-ifsc");

var _sigaaLoginUfpb = require("./session/login/sigaa-login-ufpb");

var _sigaaLoginUffs = require("./session/login/sigaa-login-uffs");

var _sigaaSession = require("./session/sigaa-session");

var _sigaaCookiesController = require("./session/sigaa-cookies-controller");

var _sigaaPageCacheWithBond = require("./session/sigaa-page-cache-with-bond");

var _sigaaPageCacheFactory = require("./session/sigaa-page-cache-factory");

var _sigaaAccountFactory = require("./account/sigaa-account-factory");

var _sigaaBondController = require("./session/sigaa-bond-controller");

var _sigaaCourseStudentFactory = require("./courses/sigaa-course-student-factory");

var _sigaaCourseResourcesManagerFactory = require("./courses/sigaa-course-resources-manager-factory");

var _sigaaCourseResourcesFactory = require("./courses/sigaa-course-resources-factory");

var _sigaaLessonParserFactory = require("./courses/sigaa-lesson-parser-factory");

var _sigaaRequestStack = require("./helpers/sigaa-request-stack");

var _sigaaLoginUnb = require("./session/login/sigaa-login-unb");

var _sigaaInstitutionController = require("./session/sigaa-institution-controller");

var _sigaaActivityFactory = require("./activity/sigaa-activity-factory");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Main class, used to instantiate other classes in standard use.
 * @category Public
 */
class Sigaa {
  /**
   * Instance of login class.
   */

  /**
   * Instance of http factory.
   */

  /**
   * Instance of parser.
   */

  /**
   * Instance of session.
   */

  /**
   * Instance of account factory.
   */

  /**
   * Instance of http session.
   */

  /**
   * Instance of http.
   */
  constructor(options) {
    _defineProperty(this, "loginInstance", void 0);

    _defineProperty(this, "httpFactory", void 0);

    _defineProperty(this, "parser", void 0);

    _defineProperty(this, "session", void 0);

    _defineProperty(this, "accountFactory", void 0);

    _defineProperty(this, "httpSession", void 0);

    _defineProperty(this, "http", void 0);

    const pageCacheFactory = new _sigaaPageCacheFactory.SigaaPageCacheFactory();
    const pageCache = new _sigaaPageCacheWithBond.SigaaPageCacheWithBond(pageCacheFactory);

    if ('parser' in options && options.parser) {
      this.parser = options.parser;
    } else {
      this.parser = new _sigaaParser.SigaaParser();
    }

    if ('session' in options && options.session) {
      this.session = options.session;
    } else {
      this.session = new _sigaaSession.SigaaSession(options.institution);
    }

    if ('url' in options && options.url && 'institution' in options && options.institution) {
      let cookiesController;

      if ('cookiesController' in options && options.cookiesController) {
        cookiesController = options.cookiesController;
      } else {
        cookiesController = new _sigaaCookiesController.SigaaCookiesController();
      }

      let requestStackController;

      if ('requestStackController' in options && options.requestStackController) {
        requestStackController = options.requestStackController;
      } else {
        requestStackController = new _sigaaRequestStack.SigaaRequestStack();
      }

      const institutionController = new _sigaaInstitutionController.SigaaInstitutionController(options.institution, options.url);
      this.httpSession = new _sigaaHttpSession.SigaaHTTPSession(institutionController, cookiesController, pageCache, requestStackController);
      const bondController = options.bondController || new _sigaaBondController.SigaaBondController();
      this.httpFactory = new _sigaaHttpFactory.SigaaHTTPFactory(this.httpSession, pageCache, bondController);
    } else {
      if ('institution' in options && options.institution) {
        throw new Error('SIGAA: Institution must be informed.');
      }

      if ('httpFactory' in options && options.httpFactory) {
        this.httpFactory = options.httpFactory;
      } else {
        throw new Error('SIGAA: Invalid httpFactory. It may be that you have forgotten the URL');
      }

      if ('httpSession' in options && options.httpSession) {
        this.httpSession = options.httpSession;
      } else {
        throw new Error('SIGAA: Invalid httpSession.');
      }
    }

    this.http = this.httpFactory.createHttp();

    if ('accountFactory' in options && options.accountFactory) {
      this.accountFactory = options.accountFactory;
    } else {
      let bondFactory;

      if ('bondFactory' in options && options.bondFactory) {
        bondFactory = options.bondFactory;
      } else {
        let activityFactory;

        if ('activityFactory' in options && options.activityFactory) {
          activityFactory = options.activityFactory;
        } else {
          activityFactory = new _sigaaActivityFactory.SigaaActivityFactory();
        }

        let courseFactory;

        if ('courseFactory' in options && options.courseFactory) {
          courseFactory = options.courseFactory;
        } else {
          let courseResourcesManagerFactory;

          if ('courseResourcesManagerFactory' in options && options.courseResourcesManagerFactory) {
            courseResourcesManagerFactory = options.courseResourcesManagerFactory;
          } else {
            let courseResourcesFactory;

            if ('courseResourcesFactory' in options && options.courseResourcesFactory) {
              courseResourcesFactory = options.courseResourcesFactory;
            } else {
              courseResourcesFactory = new _sigaaCourseResourcesFactory.SigaaCourseResourcesFactory(this.parser);
            }

            courseResourcesManagerFactory = new _sigaaCourseResourcesManagerFactory.SigaaCourseResourceManagerFactory(courseResourcesFactory);
          }

          let lessonParserFactory;

          if ('lessonParserFactory' in options && options.lessonParserFactory) {
            lessonParserFactory = options.lessonParserFactory;
          } else {
            lessonParserFactory = new _sigaaLessonParserFactory.SigaaLessonParserFactory(this.parser);
          }

          courseFactory = new _sigaaCourseStudentFactory.SigaaCourseFactory(this.http, this.parser, courseResourcesManagerFactory, lessonParserFactory);
        }

        bondFactory = new _sigaaBondFactory.SigaaBondFactory(this.httpFactory, this.parser, courseFactory, activityFactory);
      }

      this.accountFactory = new _sigaaAccountFactory.SigaaAccountFactory(this.http, this.parser, this.session, bondFactory);
    }

    const SigaaLoginInstitution = {
      IFSC: _sigaaLoginIfsc.SigaaLoginIFSC,
      UFPB: _sigaaLoginUfpb.SigaaLoginUFPB,
      UNB: _sigaaLoginUnb.SigaaLoginUNB,
      UFFS: _sigaaLoginUffs.SigaaLoginUFFS
    };
    const institution = options.institution ?? 'IFSC';
    this.loginInstance = new SigaaLoginInstitution[institution](this.http, this.session);
  }
  /**
   * User authentication.
   * @param username
   * @param password
   */


  async login(username, password) {
    const page = await this.loginInstance.login(username, password);

    try {
      return await this.accountFactory.getAccount(page);
    } catch (err) {
      const retryPage = await this.http.followAllRedirect(await this.http.get(page.url.href, {
        noCache: true
      }), {
        noCache: true
      });
      return this.accountFactory.getAccount(retryPage);
    }
  }
  /**
   * Load file to download.
   * @param options
   * @param options.id file id
   * @param options.key file key
   */


  loadFile(options) {
    return new _sigaaFile.SigaaFile(this.http, options);
  }
  /**
   * Returns instance of SigaaSearch.
   */


  get search() {
    return new _sigaaSearch.SigaaSearch(this.http, this.parser);
  }
  /**
   * Close the instance, it just clears the session data, if you want to log off the system you must use Account.logoff().
   */


  close() {
    this.httpSession.close();
  }

}

exports.Sigaa = Sigaa;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zaWdhYS1tYWluLnRzIl0sIm5hbWVzIjpbIlNpZ2FhIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwicGFnZUNhY2hlRmFjdG9yeSIsIlNpZ2FhUGFnZUNhY2hlRmFjdG9yeSIsInBhZ2VDYWNoZSIsIlNpZ2FhUGFnZUNhY2hlV2l0aEJvbmQiLCJwYXJzZXIiLCJTaWdhYVBhcnNlciIsInNlc3Npb24iLCJTaWdhYVNlc3Npb24iLCJpbnN0aXR1dGlvbiIsInVybCIsImNvb2tpZXNDb250cm9sbGVyIiwiU2lnYWFDb29raWVzQ29udHJvbGxlciIsInJlcXVlc3RTdGFja0NvbnRyb2xsZXIiLCJTaWdhYVJlcXVlc3RTdGFjayIsImluc3RpdHV0aW9uQ29udHJvbGxlciIsIlNpZ2FhSW5zdGl0dXRpb25Db250cm9sbGVyIiwiaHR0cFNlc3Npb24iLCJTaWdhYUhUVFBTZXNzaW9uIiwiYm9uZENvbnRyb2xsZXIiLCJTaWdhYUJvbmRDb250cm9sbGVyIiwiaHR0cEZhY3RvcnkiLCJTaWdhYUhUVFBGYWN0b3J5IiwiRXJyb3IiLCJodHRwIiwiY3JlYXRlSHR0cCIsImFjY291bnRGYWN0b3J5IiwiYm9uZEZhY3RvcnkiLCJhY3Rpdml0eUZhY3RvcnkiLCJTaWdhYUFjdGl2aXR5RmFjdG9yeSIsImNvdXJzZUZhY3RvcnkiLCJjb3Vyc2VSZXNvdXJjZXNNYW5hZ2VyRmFjdG9yeSIsImNvdXJzZVJlc291cmNlc0ZhY3RvcnkiLCJTaWdhYUNvdXJzZVJlc291cmNlc0ZhY3RvcnkiLCJTaWdhYUNvdXJzZVJlc291cmNlTWFuYWdlckZhY3RvcnkiLCJsZXNzb25QYXJzZXJGYWN0b3J5IiwiU2lnYWFMZXNzb25QYXJzZXJGYWN0b3J5IiwiU2lnYWFDb3Vyc2VGYWN0b3J5IiwiU2lnYWFCb25kRmFjdG9yeSIsIlNpZ2FhQWNjb3VudEZhY3RvcnkiLCJTaWdhYUxvZ2luSW5zdGl0dXRpb24iLCJJRlNDIiwiU2lnYWFMb2dpbklGU0MiLCJVRlBCIiwiU2lnYWFMb2dpblVGUEIiLCJVTkIiLCJTaWdhYUxvZ2luVU5CIiwiVUZGUyIsIlNpZ2FhTG9naW5VRkZTIiwibG9naW5JbnN0YW5jZSIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInBhZ2UiLCJnZXRBY2NvdW50IiwiZXJyIiwicmV0cnlQYWdlIiwiZm9sbG93QWxsUmVkaXJlY3QiLCJnZXQiLCJocmVmIiwibm9DYWNoZSIsImxvYWRGaWxlIiwiU2lnYWFGaWxlIiwic2VhcmNoIiwiU2lnYWFTZWFyY2giLCJjbG9zZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBSUE7O0FBSUE7O0FBSUE7O0FBSUE7O0FBSUE7O0FBUUE7O0FBQ0E7O0FBQ0E7O0FBS0E7Ozs7QUFxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDTyxNQUFNQSxLQUFOLENBQVk7QUFDakI7QUFDRjtBQUNBOztBQUdFO0FBQ0Y7QUFDQTs7QUFHRTtBQUNGO0FBQ0E7O0FBR0U7QUFDRjtBQUNBOztBQUdFO0FBQ0Y7QUFDQTs7QUFHRTtBQUNGO0FBQ0E7O0FBR0U7QUFDRjtBQUNBO0FBR0VDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBRCxFQUFtQztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUFBOztBQUM1QyxVQUFNQyxnQkFBZ0IsR0FBRyxJQUFJQyw0Q0FBSixFQUF6QjtBQUNBLFVBQU1DLFNBQVMsR0FBRyxJQUFJQyw4Q0FBSixDQUEyQkgsZ0JBQTNCLENBQWxCOztBQUVBLFFBQUksWUFBWUQsT0FBWixJQUF1QkEsT0FBTyxDQUFDSyxNQUFuQyxFQUEyQztBQUN6QyxXQUFLQSxNQUFMLEdBQWNMLE9BQU8sQ0FBQ0ssTUFBdEI7QUFDRCxLQUZELE1BRU87QUFDTCxXQUFLQSxNQUFMLEdBQWMsSUFBSUMsd0JBQUosRUFBZDtBQUNEOztBQUVELFFBQUksYUFBYU4sT0FBYixJQUF3QkEs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QTdCLENBRGdCLEVBRXRCO0FBQUVBLFFBQUFBLE9BQU8sRUFBRTtBQUFYLE9BRnNCLENBQXhCO0FBSUEsYUFBTyxLQUFLbEMsY0FBTCxDQUFvQjRCLFVBQXBCLENBQStCRSxTQUEvQixDQUFQO0FBQ0Q7QUFDRjtBQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0VLLEVBQUFBLFFBQVEsQ0FBQzdELE9BQUQsRUFBK0I7QUFDckMsV0FBTyxJQUFJOEQsb0JBQUosQ0FBYyxLQUFLdEMsSUFBbkIsRUFBeUJ4QixPQUF6QixDQUFQO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7OztBQUNZLE1BQU4rRCxNQUFNLEdBQWdCO0FBQ3hCLFdBQU8sSUFBSUMsd0JBQUosQ0FBZ0IsS0FBS3hDLElBQXJCLEVBQTJCLEtBQUtuQixNQUFoQyxDQUFQO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7OztBQUNFNEQsRUFBQUEsS0FBSyxHQUFTO0FBQ1osU0FBS2hELFdBQUwsQ0FBaUJnRCxLQUFqQjtBQUNEOztBQXBQZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY2NvdW50IH0gZnJvbSAnQGFjY291bnQvc2lnYWEtYWNjb3VudCc7XG5pbXBvcnQgeyBCb25kRmFjdG9yeSwgU2lnYWFCb25kRmFjdG9yeSB9IGZyb20gJ0Bib25kcy9zaWdhYS1ib25kLWZhY3RvcnknO1xuaW1wb3J0IHsgUGFyc2VyLCBTaWdhYVBhcnNlciB9IGZyb20gJ0BoZWxwZXJzL3NpZ2FhLXBhcnNlcic7XG5pbXBvcnQgeyBGaWxlRGF0YSwgU2lnYWFGaWxlIH0gZnJvbSAnQHJlc291cmNlcy9zaWdhYS1maWxlJztcbmltcG9ydCB7IFNpZ2FhU2VhcmNoIH0gZnJvbSAnQHNlYXJjaC9zaWdhYS1zZWFyY2gnO1xuaW1wb3J0IHsgSFRUUFNlc3Npb24sIFNpZ2FhSFRUUFNlc3Npb24gfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1odHRwLXNlc3Npb24nO1xuaW1wb3J0IHsgSFRUUCB9IGZyb20gJ0BzZXNzaW9uL3NpZ2FhLWh0dHAnO1xuaW1wb3J0IHsgSFRUUEZhY3RvcnksIFNpZ2FhSFRUUEZhY3RvcnkgfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1odHRwLWZhY3RvcnknO1xuaW1wb3J0IHsgTG9naW4gfSBmcm9tICdAc2Vzc2lvbi9sb2dpbi9zaWdhYS1sb2dpbic7XG5pbXBvcnQgeyBTaWdhYUxvZ2luSUZTQyB9IGZyb20gJ0BzZXNzaW9uL2xvZ2luL3NpZ2FhLWxvZ2luLWlmc2MnO1xuaW1wb3J0IHsgU2lnYWFMb2dpblVGUEIgfSBmcm9tICdAc2Vzc2lvbi9sb2dpbi9zaWdhYS1sb2dpbi11ZnBiJztcbmltcG9ydCB7IFNpZ2FhTG9naW5VRkZTIH0gZnJvbSAnQHNlc3Npb24vbG9naW4vc2lnYWEtbG9naW4tdWZmcyc7XG5pbXBvcnQgeyBTZXNzaW9uLCBTaWdhYVNlc3Npb24gfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1zZXNzaW9uJztcbmltcG9ydCB7IFNpZ2FhQ29va2llc0NvbnRyb2xsZXIgfSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1jb29raWVzLWNvbnRyb2xsZXInO1xuaW1wb3J0IHsgU2lnYWFQYWdlQ2FjaGVXaXRoQm9uZCB9IGZyb20gJ0BzZXNzaW9uL3NpZ2FhLXBhZ2UtY2FjaGUtd2l0aC1ib25kJztcbmltcG9ydCB7IFNpZ2FhUGFnZUNhY2hlRmFjdG9yeSB9IGZyb20gJ0BzZXNzaW9uL3NpZ2FhLXBhZ2UtY2FjaGUtZmFjdG9yeSc7XG5cbmltcG9ydCB7XG4gIEFjY291bnRGYWN0b3J5LFxuICBTaWdhYUFjY291bnRGYWN0b3J5XG59IGZyb20gJ0BhY2NvdW50L3NpZ2FhLWFjY291bnQtZmFjdG9yeSc7XG5pbXBvcnQge1xuICBCb25kQ29udHJvbGxlcixcbiAgU2lnYWFCb25kQ29udHJvbGxlclxufSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1ib25kLWNvbnRyb2xsZXInO1xuaW1wb3J0IHtcbiAgQ291cnNlRmFjdG9yeSxcbiAgU2lnYWFDb3Vyc2VGYWN0b3J5XG59IGZyb20gJ0Bjb3Vyc2VzL3NpZ2FhLWNvdXJzZS1zdHVkZW50LWZhY3RvcnknO1xuaW1wb3J0IHtcbiAgQ291cnNlUmVzb3VyY2VzTWFuYWdlckZhY3RvcnksXG4gIFNpZ2FhQ291cnNlUmVzb3VyY2VNYW5hZ2VyRmFjdG9yeVxufSBmcm9tICdAY291cnNlcy9zaWdhYS1jb3Vyc2UtcmVzb3VyY2VzLW1hbmFnZXItZmFjdG9yeSc7XG5pbXBvcnQge1xuICBDb3Vyc2VSZXNvdXJjZXNGYWN0b3J5LFxuICBTaWdhYUNvdXJzZVJlc291cmNlc0ZhY3Rvcnlcbn0gZnJvbSAnQGNvdXJzZXMvc2lnYWEtY291cnNlLXJlc291cmNlcy1mYWN0b3J5JztcbmltcG9ydCB7XG4gIExlc3NvblBhcnNlckZhY3RvcnksXG4gIFNpZ2FhTGVzc29uUGFyc2VyRmFjdG9yeVxufSBmcm9tICdAY291cnNlcy9zaWdhYS1sZXNzb24tcGFyc2VyLWZhY3RvcnknO1xuaW1wb3J0IHsgWE9SIH0gZnJvbSAnLi9zaWdhYS10eXBlcyc7XG5pbXBvcnQgeyBSZXF1ZXN0U3RhY2tDb250cm9sbGVyIH0gZnJvbSAnQGhlbHBlcnMvc2lnYWEtcmVxdWVzdC1zdGFjayc7XG5pbXBvcnQgeyBSZXF1ZXN0IH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtaHR0cC1zZXNzaW9uJztcbmltcG9ydCB7IENvb2tpZXNDb250cm9sbGVyIH0gZnJvbSAnQHNlc3Npb24vc2lnYWEtY29va2llcy1jb250cm9sbGVyJztcbmltcG9ydCB7IFNpZ2FhUmVxdWVzdFN0YWNrIH0gZnJvbSAnQGhlbHBlcnMvc2lnYWEtcmVxdWVzdC1zdGFjayc7XG5pbXBvcnQgeyBTaWdhYUxvZ2luVU5CIH0gZnJvbSAnQHNlc3Npb24vbG9naW4vc2lnYWEtbG9naW4tdW5iJztcbmltcG9ydCB7XG4gIEluc3RpdHV0aW9uVHlwZSxcbiAgU2lnYWFJbnN0aXR1dGlvbkNvbnRyb2xsZXIsXG4gIFNpZ2FhTG9naW5JbnN0aXR1dGlvbk1hcFxufSBmcm9tICdAc2Vzc2lvbi9zaWdhYS1pbnN0aXR1dGlvbi1jb250cm9sbGVyJztcbmltcG9ydCB7XG4gIEFjdGl2aXR5RmFjdG9yeSxcbiAgU2lnYWFBY3Rpdml0eUZhY3Rvcnlcbn0gZnJvbSAnQGFjdGl2aXR5L3NpZ2FhLWFjdGl2aXR5LWZhY3RvcnknO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ0BzZXNzaW9uL3NpZ2FhLXBhZ2UnO1xuXG4vKipcbiAqIEBjYXRlZ29yeSBJbnRlcm5hbFxuICovXG5pbnRlcmZhY2UgU2lnYWFDb21tb25Db25zdHJ1Y3Rvck9wdGlvbnMge1xuICBsb2dpbj86IExvZ2luO1xuICBwYXJzZXI/OiBQYXJzZXI7XG4gIHNlc3Npb24/OiBTZXNzaW9uO1xufVxuaW50ZXJmYWNlIFNpZ2FhQ29uc3RydWN0b3JVUkwge1xuICB1cmw6IHN0cmluZztcbiAgYm9uZENvbnRyb2xsZXI/OiBCb25kQ29udHJvbGxlcjtcbiAgY29va2llc0NvbnRyb2xsZXI/OiBDb29raWVzQ29udHJvbGxlcjtcbiAgcmVxdWVzdFN0YWNrQ29udHJvbGxlcj86IFJlcXVlc3RTdGFja0NvbnRyb2xsZXI8UmVxdWVzdCwgUGFnZT47XG59XG5cbmludGVyZmFjZSBXaXRoQWNjb3VudEZhY3Rvcnkge1xuICBhY2NvdW50RmFjdG9yeT86IEFjY291bnRGYWN0b3J5O1xufVxuXG5pbnRlcmZhY2UgV2l0aEJvbmRGYWN0b3J5IHtcbiAgYm9uZEZhY3Rvcnk6IEJvbmRGYWN0b3J5O1xufVxuXG5pbnRlcmZhY2UgV2l0aENvdXJzZUZhY3Rvcnkge1xuICBjb3Vyc2VGYWN0b3J5OiBDb3Vyc2VGYWN0b3J5O1xufVxuXG5pbnRlcmZhY2UgV2l0aEFjdGl2aXR5RmFjdG9yeSB7XG4gIGFjdGl2aXR5RmFjdG9yeT86IEFjdGl2aXR5RmFjdG9yeTtcbn1cblxudHlwZSBXaXRob3V0Q291cnNlRmFjdG9yeSA9IHtcbiAgbGVzc29uUGFyc2VyRmFjdG9yeT86IExlc3NvblBhcnNlckZhY3Rvcnk7XG59ICYgWE9SPFxuICB7IGNvdXJzZVJlc291cmNlc01hbmFnZXJGYWN0b3J5PzogQ291cnNlUmVzb3VyY2VzTWFuYWdlckZhY3RvcnkgfSxcbiAgeyBjb3Vyc2VSZXNvdXJjZXNGYWN0b3J5PzogQ291cnNlUmVzb3VyY2VzRmFjdG9yeSB9XG4+O1xuXG4vKipcbiAqIEBjYXRlZ29yeSBJbnRlcm5hbFxuICovXG5pbnRlcmZhY2UgU2lnYWFDb25zdHJ1Y3RvckhUVFAge1xuICBodHRwRmFjdG9yeTogSFRUUEZhY3Rvcnk7XG4gIGh0dHBTZXNzaW9uOiBIVFRQU2Vzc2lvbjtcbn1cblxuLyoqXG4gKiBAY2F0ZWdvcnkgUHVibGljXG4gKi9cbmV4cG9ydCB0eXBlIFNpZ2FhT3B0aW9uc0NvbnN0cnVjdG9yID0gU2lnYWFDb21tb25Db25zdHJ1Y3Rvck9wdGlvbnMgJlxuICBYT1I8XG4gICAgeyBpbnN0aXR1dGlvbjogSW5zdGl0dXRpb25UeXBlOyB1cmw6IHN0cmluZyB9LFxuICAgIHsgc2Vzc2lvbjogU2Vzc2lvbjsgaHR0cFNlc3Npb246IEhUVFBTZXNzaW9uIH1cbiAgPiAmXG4gIFhPUjxTaWdhYUNvbnN0cnVjdG9yVVJMLCBTaWdhYUNvbnN0cnVjdG9ySFRUUD4gJlxuICBYT1I8XG4gICAgV2l0aEFjY291bnRGYWN0b3J5LFxuICAgIFhPUjxcbiAgICAgIFdpdGhCb25kRmFjdG9yeSxcbiAgICAgIFdpdGhBY3Rpdml0eUZhY3RvcnkgJiBYT1I8V2l0aENvdXJzZUZhY3RvcnksIFdpdGhvdXRDb3Vyc2VGYWN0b3J5PlxuICAgID5cbiAgPjtcblxuLyoqXG4gKiBNYWluIGNsYXNzLCB1c2VkIHRvIGluc3RhbnRpYXRlIG90aGVyIGNsYXNzZXMgaW4gc3RhbmRhcmQgdXNlLlxuICogQGNhdGVnb3J5IFB1YmxpY1xuICovXG5leHBvcnQgY2xhc3MgU2lnYWEge1xuICAvKipcbiAgICogSW5zdGFuY2Ugb2YgbG9naW4gY2xhc3MuXG4gICAqL1xuICByZWFkb25seSBsb2dpbkluc3RhbmNlOiBMb2dpbjtcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2YgaHR0cCBmYWN0b3J5LlxuICAgKi9cbiAgcmVhZG9ubHkgaHR0cEZhY3Rvcnk6IEhUVFBGYWN0b3J5O1xuXG4gIC8qKlxuICAgKiBJbnN0YW5jZSBvZiBwYXJzZXIuXG4gICAqL1xuICByZWFkb25seSBwYXJzZXI6IFBhcnNlcjtcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2Ygc2Vzc2lvbi5cbiAgICovXG4gIHJlYWRvbmx5IHNlc3Npb246IFNlc3Npb247XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIGFjY291bnQgZmFjdG9yeS5cbiAgICovXG4gIHJlYWRvbmx5IGFjY291bnRGYWN0b3J5OiBBY2NvdW50RmFjdG9yeTtcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2YgaHR0cCBzZXNzaW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgaHR0cFNlc3Npb246IEhUVFBTZXNzaW9uO1xuXG4gIC8qKlxuICAgKiBJbnN0YW5jZSBvZiBodHRwLlxuICAgKi9cbiAgcHJpdmF0ZSBodHRwOiBIVFRQO1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IFNpZ2FhT3B0aW9uc0NvbnN0cnVjdG9yKSB7XG4gICAgY29uc3QgcGFnZUNhY2hlRmFjdG9yeSA9IG5ldyBTaWdhYVBhZ2VDYWNoZUZhY3RvcnkoKTtcbiAgICBjb25zdCBwYWdlQ2FjaGUgPSBuZXcgU2lnYWFQYWdlQ2FjaGVXaXRoQm9uZChwYWdlQ2FjaGVGYWN0b3J5KTtcblxuICAgIGlmICgncGFyc2VyJyBpbiBvcHRpb25zICYmIG9wdGlvbnMucGFyc2VyKSB7XG4gICAgICB0aGlzLnBhcnNlciA9IG9wdGlvbnMucGFyc2VyO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBhcnNlciA9IG5ldyBTaWdhYVBhcnNlcigpO1xuICAgIH1cblxuICAgIGlmICgnc2Vzc2lvbicgaW4gb3B0aW9ucyAmJiBvcHRpb25zLnNlc3Npb24pIHtcbiAgICAgIHRoaXMuc2Vzc2lvbiA9IG9wdGlvbnMuc2Vzc2lvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXNzaW9uID0gbmV3IFNpZ2FhU2Vzc2lvbihvcHRpb25zLmluc3RpdHV0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAndXJsJyBpbiBvcHRpb25zICYmXG4gICAgICBvcHRpb25zLnVybCAmJlxuICAgICAgJ2luc3RpdHV0aW9uJyBpbiBvcHRpb25zICYmXG4gICAgICBvcHRpb25zLmluc3RpdHV0aW9uXG4gICAgKSB7XG4gICAgICBsZXQgY29va2llc0NvbnRyb2xsZXI6IENvb2tpZXNDb250cm9sbGVyO1xuXG4gICAgICBpZiAoJ2Nvb2tpZXNDb250cm9sbGVyJyBpbiBvcHRpb25zICYmIG9wdGlvbnMuY29va2llc0NvbnRyb2xsZXIpIHtcbiAgICAgICAgY29va2llc0NvbnRyb2xsZXIgPSBvcHRpb25zLmNvb2tpZXNDb250cm9sbGVyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29va2llc0NvbnRyb2xsZXIgPSBuZXcgU2lnYWFDb29raWVzQ29udHJvbGxlcigpO1xuICAgICAgfVxuXG4gICAgICBsZXQgcmVxdWVzdFN0YWNrQ29udHJvbGxlcjogUmVxdWVzdFN0YWNrQ29udHJvbGxlcjxSZXF1ZXN0LCBQYWdlPjtcblxuICAgICAgaWYgKFxuICAgICAgICAncmVxdWVzdFN0YWNrQ29udHJvbGxlcicgaW4gb3B0aW9ucyAmJlxuICAgICAgICBvcHRpb25zLnJlcXVlc3RTdGFja0NvbnRyb2xsZXJcbiAgICAgICkge1xuICAgICAgICByZXF1ZXN0U3RhY2tDb250cm9sbGVyID0gb3B0aW9ucy5yZXF1ZXN0U3RhY2tDb250cm9sbGVyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxdWVzdFN0YWNrQ29udHJvbGxlciA9IG5ldyBTaWdhYVJlcXVlc3RTdGFjazxSZXF1ZXN0LCBQYWdlPigpO1xuICAgICAgfVxuICAgICAgY29uc3QgaW5zdGl0dXRpb25Db250cm9sbGVyID0gbmV3IFNpZ2FhSW5zdGl0dXRpb25Db250cm9sbGVyKFxuICAgICAgICBvcHRpb25zLmluc3RpdHV0aW9uLFxuICAgICAgICBvcHRpb25zLnVybFxuICAgICAgKTtcbiAgICAgIHRoaXMuaHR0cFNlc3Npb24gPSBuZXcgU2lnYWFIVFRQU2Vzc2lvbihcbiAgICAgICAgaW5zdGl0dXRpb25Db250cm9sbGVyLFxuICAgICAgICBjb29raWVzQ29udHJvbGxlcixcbiAgICAgICAgcGFnZUNhY2hlLFxuICAgICAgICByZXF1ZXN0U3RhY2tDb250cm9sbGVyXG4gICAgICApO1xuXG4gICAgICBjb25zdCBib25kQ29udHJvbGxlciA9XG4gICAgICAgIG9wdGlvbnMuYm9uZENvbnRyb2xsZXIgfHwgbmV3IFNpZ2FhQm9uZENvbnRyb2xsZXIoKTtcblxuICAgICAgdGhpcy5odHRwRmFjdG9yeSA9IG5ldyBTaWdhYUhUVFBGYWN0b3J5KFxuICAgICAgICB0aGlzLmh0dHBTZXNzaW9uLFxuICAgICAgICBwYWdlQ2FjaGUsXG4gICAgICAgIGJvbmRDb250cm9sbGVyXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJ2luc3RpdHV0aW9uJyBpbiBvcHRpb25zICYmIG9wdGlvbnMuaW5zdGl0dXRpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogSW5zdGl0dXRpb24gbXVzdCBiZSBpbmZvcm1lZC4nKTtcbiAgICAgIH1cbiAgICAgIGlmICgnaHR0cEZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5odHRwRmFjdG9yeSkge1xuICAgICAgICB0aGlzLmh0dHBGYWN0b3J5ID0gb3B0aW9ucy5odHRwRmFjdG9yeTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnU0lHQUE6IEludmFsaWQgaHR0cEZhY3RvcnkuIEl0IG1heSBiZSB0aGF0IHlvdSBoYXZlIGZvcmdvdHRlbiB0aGUgVVJMJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKCdodHRwU2Vzc2lvbicgaW4gb3B0aW9ucyAmJiBvcHRpb25zLmh0dHBTZXNzaW9uKSB7XG4gICAgICAgIHRoaXMuaHR0cFNlc3Npb24gPSBvcHRpb25zLmh0dHBTZXNzaW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTSUdBQTogSW52YWxpZCBodHRwU2Vzc2lvbi4nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmh0dHAgPSB0aGlzLmh0dHBGYWN0b3J5LmNyZWF0ZUh0dHAoKTtcblxuICAgIGlmICgnYWNjb3VudEZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5hY2NvdW50RmFjdG9yeSkge1xuICAgICAgdGhpcy5hY2NvdW50RmFjdG9yeSA9IG9wdGlvbnMuYWNjb3VudEZhY3Rvcnk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBib25kRmFjdG9yeTogQm9uZEZhY3Rvcnk7XG5cbiAgICAgIGlmICgnYm9uZEZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5ib25kRmFjdG9yeSkge1xuICAgICAgICBib25kRmFjdG9yeSA9IG9wdGlvbnMuYm9uZEZhY3Rvcnk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgYWN0aXZpdHlGYWN0b3J5OiBBY3Rpdml0eUZhY3Rvcnk7XG5cbiAgICAgICAgaWYgKCdhY3Rpdml0eUZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5hY3Rpdml0eUZhY3RvcnkpIHtcbiAgICAgICAgICBhY3Rpdml0eUZhY3RvcnkgPSBvcHRpb25zLmFjdGl2aXR5RmFjdG9yeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhY3Rpdml0eUZhY3RvcnkgPSBuZXcgU2lnYWFBY3Rpdml0eUZhY3RvcnkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb3Vyc2VGYWN0b3J5OiBDb3Vyc2VGYWN0b3J5O1xuICAgICAgICBpZiAoJ2NvdXJzZUZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5jb3Vyc2VGYWN0b3J5KSB7XG4gICAgICAgICAgY291cnNlRmFjdG9yeSA9IG9wdGlvbnMuY291cnNlRmFjdG9yeTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgY291cnNlUmVzb3VyY2VzTWFuYWdlckZhY3Rvcnk6IENvdXJzZVJlc291cmNlc01hbmFnZXJGYWN0b3J5O1xuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgJ2NvdXJzZVJlc291cmNlc01hbmFnZXJGYWN0b3J5JyBpbiBvcHRpb25zICYmXG4gICAgICAgICAgICBvcHRpb25zLmNvdXJzZVJlc291cmNlc01hbmFnZXJGYWN0b3J5XG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjb3Vyc2VSZXNvdXJjZXNNYW5hZ2VyRmFjdG9yeSA9XG4gICAgICAgICAgICAgIG9wdGlvbnMuY291cnNlUmVzb3VyY2VzTWFuYWdlckZhY3Rvcnk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBjb3Vyc2VSZXNvdXJjZXNGYWN0b3J5OiBDb3Vyc2VSZXNvdXJjZXNGYWN0b3J5O1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICdjb3Vyc2VSZXNvdXJjZXNGYWN0b3J5JyBpbiBvcHRpb25zICYmXG4gICAgICAgICAgICAgIG9wdGlvbnMuY291cnNlUmVzb3VyY2VzRmFjdG9yeVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGNvdXJzZVJlc291cmNlc0ZhY3RvcnkgPSBvcHRpb25zLmNvdXJzZVJlc291cmNlc0ZhY3Rvcnk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb3Vyc2VSZXNvdXJjZXNGYWN0b3J5ID0gbmV3IFNpZ2FhQ291cnNlUmVzb3VyY2VzRmFjdG9yeShcbiAgICAgICAgICAgICAgICB0aGlzLnBhcnNlclxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb3Vyc2VSZXNvdXJjZXNNYW5hZ2VyRmFjdG9yeSA9XG4gICAgICAgICAgICAgIG5ldyBTaWdhYUNvdXJzZVJlc291cmNlTWFuYWdlckZhY3RvcnkoY291cnNlUmVzb3VyY2VzRmFjdG9yeSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IGxlc3NvblBhcnNlckZhY3Rvcnk6IExlc3NvblBhcnNlckZhY3Rvcnk7XG5cbiAgICAgICAgICBpZiAoJ2xlc3NvblBhcnNlckZhY3RvcnknIGluIG9wdGlvbnMgJiYgb3B0aW9ucy5sZXNzb25QYXJzZXJGYWN0b3J5KSB7XG4gICAgICAgICAgICBsZXNzb25QYXJzZXJGYWN0b3J5ID0gb3B0aW9ucy5sZXNzb25QYXJzZXJGYWN0b3J5O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXNzb25QYXJzZXJGYWN0b3J5ID0gbmV3IFNpZ2FhTGVzc29uUGFyc2VyRmFjdG9yeSh0aGlzLnBhcnNlcik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY291cnNlRmFjdG9yeSA9IG5ldyBTaWdhYUNvdXJzZUZhY3RvcnkoXG4gICAgICAgICAgICB0aGlzLmh0dHAsXG4gICAgICAgICAgICB0aGlzLnBhcnNlcixcbiAgICAgICAgICAgIGNvdXJzZVJlc291cmNlc01hbmFnZXJGYWN0b3J5LFxuICAgICAgICAgICAgbGVzc29uUGFyc2VyRmFjdG9yeVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBib25kRmFjdG9yeSA9IG5ldyBTaWdhYUJvbmRGYWN0b3J5KFxuICAgICAgICAgIHRoaXMuaHR0cEZhY3RvcnksXG4gICAgICAgICAgdGhpcy5wYXJzZXIsXG4gICAgICAgICAgY291cnNlRmFjdG9yeSxcbiAgICAgICAgICBhY3Rpdml0eUZhY3RvcnlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWNjb3VudEZhY3RvcnkgPSBuZXcgU2lnYWFBY2NvdW50RmFjdG9yeShcbiAgICAgICAgdGhpcy5odHRwLFxuICAgICAgICB0aGlzLnBhcnNlcixcbiAgICAgICAgdGhpcy5zZXNzaW9uLFxuICAgICAgICBib25kRmFjdG9yeVxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgU2lnYWFMb2dpbkluc3RpdHV0aW9uOiBTaWdhYUxvZ2luSW5zdGl0dXRpb25NYXAgPSB7XG4gICAgICBJRlNDOiBTaWdhYUxvZ2luSUZTQyxcbiAgICAgIFVGUEI6IFNpZ2FhTG9naW5VRlBCLFxuICAgICAgVU5COiBTaWdhYUxvZ2luVU5CLFxuICAgICAgVUZGUzogU2lnYWFMb2dpblVGRlNcbiAgICB9O1xuICAgIGNvbnN0IGluc3RpdHV0aW9uID0gb3B0aW9ucy5pbnN0aXR1dGlvbiA/PyAnSUZTQyc7XG4gICAgdGhpcy5sb2dpbkluc3RhbmNlID0gbmV3IFNpZ2FhTG9naW5JbnN0aXR1dGlvbltpbnN0aXR1dGlvbl0oXG4gICAgICB0aGlzLmh0dHAsXG4gICAgICB0aGlzLnNlc3Npb25cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZXIgYXV0aGVudGljYXRpb24uXG4gICAqIEBwYXJhbSB1c2VybmFtZVxuICAgKiBAcGFyYW0gcGFzc3dvcmRcbiAgICovXG4gIGFzeW5jIGxvZ2luKHVzZXJuYW1lOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPEFjY291bnQ+IHtcbiAgICBjb25zdCBwYWdlID0gYXdhaXQgdGhpcy5sb2dpbkluc3RhbmNlLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCk7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmFjY291bnRGYWN0b3J5LmdldEFjY291bnQocGFnZSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zdCByZXRyeVBhZ2UgPSBhd2FpdCB0aGlzLmh0dHAuZm9sbG93QWxsUmVkaXJlY3QoXG4gICAgICAgIGF3YWl0IHRoaXMuaHR0cC5nZXQocGFnZS51cmwuaHJlZiwgeyBub0NhY2hlOiB0cnVlIH0pLFxuICAgICAgICB7IG5vQ2FjaGU6IHRydWUgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB0aGlzLmFjY291bnRGYWN0b3J5LmdldEFjY291bnQocmV0cnlQYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBmaWxlIHRvIGRvd25sb2FkLlxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKiBAcGFyYW0gb3B0aW9ucy5pZCBmaWxlIGlkXG4gICAqIEBwYXJhbSBvcHRpb25zLmtleSBmaWxlIGtleVxuICAgKi9cbiAgbG9hZEZpbGUob3B0aW9uczogRmlsZURhdGEpOiBTaWdhYUZpbGUge1xuICAgIHJldHVybiBuZXcgU2lnYWFGaWxlKHRoaXMuaHR0cCwgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBpbnN0YW5jZSBvZiBTaWdhYVNlYXJjaC5cbiAgICovXG4gIGdldCBzZWFyY2goKTogU2lnYWFTZWFyY2gge1xuICAgIHJldHVybiBuZXcgU2lnYWFTZWFyY2godGhpcy5odHRwLCB0aGlzLnBhcnNlcik7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2UgdGhlIGluc3RhbmNlLCBpdCBqdXN0IGNsZWFycyB0aGUgc2Vzc2lvbiBkYXRhLCBpZiB5b3Ugd2FudCB0byBsb2cgb2ZmIHRoZSBzeXN0ZW0geW91IG11c3QgdXNlIEFjY291bnQubG9nb2ZmKCkuXG4gICAqL1xuICBjbG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLmh0dHBTZXNzaW9uLmNsb3NlKCk7XG4gIH1cbn1cbiJdfQ==